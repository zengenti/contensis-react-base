{"version":3,"file":"client.js","sources":["../src/client/client.tsx"],"sourcesContent":["import 'isomorphic-fetch';\r\nimport React from 'react';\r\nimport { render, hydrate } from 'react-dom';\r\nimport { AppContainer } from 'react-hot-loader';\r\nimport { Provider as ReduxProvider } from 'react-redux';\r\nimport { unstable_HistoryRouter as HistoryRouter } from 'react-router-dom';\r\nimport { loadableReady } from '@loadable/component';\r\nimport * as queryString from 'query-string';\r\nimport { CookiesProvider } from 'react-cookie';\r\n\r\nimport { setVersionStatus } from '~/redux/actions/version';\r\nimport rootSaga from '~/redux/sagas';\r\nimport { browserHistory as history } from '~/redux/store/history';\r\nimport createStore from '~/redux/store/store';\r\n\r\nimport { setCurrentProject } from '~/routing/redux/actions';\r\n\r\nimport { deliveryApi } from '~/util/ContensisDeliveryApi';\r\nimport pickProject from '~/util/pickProject';\r\n\r\nimport { AppConfig } from '~/config';\r\n\r\ndeclare let window: typeof globalThis & {\r\n  isDynamic;\r\n  REDUX_DATA;\r\n};\r\n\r\ntype ReactAppProps = { routes: any; withEvents: any };\r\n\r\nclass ClientApp {\r\n  constructor(ReactApp: React.ComponentType<ReactAppProps>, config: AppConfig) {\r\n    const documentRoot = document.getElementById('root');\r\n\r\n    const {\r\n      stateType = 'immutable',\r\n      routes,\r\n      withReducers,\r\n      withSagas,\r\n      withEvents,\r\n    } = config;\r\n\r\n    const GetClientJSX = store => {\r\n      const ClientJsx = (\r\n        <AppContainer>\r\n          <CookiesProvider>\r\n            <ReduxProvider store={store}>\r\n              <HistoryRouter history={history}>\r\n                <ReactApp routes={routes} withEvents={withEvents} />\r\n              </HistoryRouter>\r\n            </ReduxProvider>\r\n          </CookiesProvider>\r\n        </AppContainer>\r\n      );\r\n      return ClientJsx;\r\n    };\r\n\r\n    const isProduction = !(process.env.NODE_ENV !== 'production');\r\n\r\n    /**\r\n     * Webpack HMR Setup.\r\n     */\r\n    const HMRRenderer = Component => {\r\n      if (isProduction)\r\n        loadableReady(\r\n          () => {\r\n            hydrate(Component, documentRoot);\r\n          },\r\n          { namespace: 'modern' }\r\n        );\r\n      else render(Component, documentRoot);\r\n    };\r\n\r\n    const hmr = store => {\r\n      // webpack Hot Module Replacement API\r\n      if (module.hot) {\r\n        module.hot.accept(ReactApp as unknown as string, () => {\r\n          // if you are using harmony modules ({modules:false})\r\n          HMRRenderer(GetClientJSX(store));\r\n        });\r\n      }\r\n    };\r\n\r\n    const qs = queryString.parse(window.location.search);\r\n    const versionStatusFromHostname = deliveryApi.getClientSideVersionStatus();\r\n\r\n    if (\r\n      window.isDynamic ||\r\n      window.REDUX_DATA ||\r\n      process.env.NODE_ENV !== 'production'\r\n    ) {\r\n      createStore(withReducers, window.REDUX_DATA, history, stateType).then(\r\n        store => {\r\n          store.dispatch(\r\n            setVersionStatus(qs.versionStatus || versionStatusFromHostname)\r\n          );\r\n\r\n          /* eslint-disable no-console */\r\n          console.log('Hydrating from inline Redux');\r\n          /* eslint-enable no-console */\r\n          store.runSaga(rootSaga(withSagas));\r\n          store.dispatch(\r\n            setCurrentProject(\r\n              pickProject(window.location.hostname, qs),\r\n              [],\r\n              window.location.hostname\r\n            )\r\n          );\r\n\r\n          delete window.REDUX_DATA;\r\n          HMRRenderer(GetClientJSX(store));\r\n\r\n          hmr(store);\r\n        }\r\n      );\r\n    } else {\r\n      fetch(`${window.location.pathname}?redux=true`)\r\n        .then(response => response.json())\r\n        .then(data => {\r\n          const ssRedux = JSON.parse(data);\r\n          createStore(withReducers, ssRedux, history, stateType).then(store => {\r\n            store.dispatch(\r\n              setVersionStatus(qs.versionStatus || versionStatusFromHostname)\r\n            );\r\n\r\n            store.runSaga(rootSaga(withSagas));\r\n            store.dispatch(\r\n              setCurrentProject(\r\n                pickProject(\r\n                  window.location.hostname,\r\n                  queryString.parse(window.location.search)\r\n                ),\r\n                [],\r\n                window.location.hostname\r\n              )\r\n            );\r\n\r\n            HMRRenderer(GetClientJSX(store));\r\n\r\n            hmr(store);\r\n          });\r\n        });\r\n    }\r\n  }\r\n}\r\n\r\nexport default ClientApp;\r\n"],"names":["ClientApp","constructor","ReactApp","config","documentRoot","document","getElementById","stateType","routes","withReducers","withSagas","withEvents","GetClientJSX","store","ClientJsx","React","AppContainer","CookiesProvider","ReduxProvider","HistoryRouter","history","isProduction","process","env","NODE_ENV","HMRRenderer","Component","loadableReady","hydrate","namespace","render","hmr","module","hot","accept","qs","queryString","parse","window","location","search","versionStatusFromHostname","deliveryApi","getClientSideVersionStatus","isDynamic","REDUX_DATA","createStore","then","dispatch","setVersionStatus","versionStatus","console","log","runSaga","rootSaga","setCurrentProject","pickProject","hostname","fetch","pathname","response","json","data","ssRedux","JSON"],"mappings":"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"}