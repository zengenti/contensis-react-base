{"version":3,"file":"client.js","sources":["../src/client/client.tsx"],"sourcesContent":["import 'isomorphic-fetch';\r\nimport React from 'react';\r\nimport { render, hydrate } from 'react-dom';\r\nimport { AppContainer } from 'react-hot-loader';\r\nimport { Provider as ReduxProvider } from 'react-redux';\r\nimport { Router } from 'react-router-dom';\r\nimport { loadableReady } from '@loadable/component';\r\nimport { parse } from 'query-string';\r\nimport { CookiesProvider } from 'react-cookie';\r\n\r\nimport { selectVersionStatus } from '~/redux/selectors/version';\r\nimport { setVersionStatus } from '~/redux/actions/version';\r\nimport rootSaga from '~/redux/sagas';\r\nimport { browserHistory as history } from '~/redux/store/history';\r\nimport createStore from '~/redux/store/store';\r\n\r\nimport { setCurrentProject } from '~/routing/redux/actions';\r\n\r\nimport { deliveryApi } from '~/util/ContensisDeliveryApi';\r\nimport pickProject from '~/util/pickProject';\r\n\r\nimport { AppConfig } from '~/config';\r\n\r\ndeclare let window: typeof globalThis & {\r\n  isDynamic;\r\n  REDUX_DATA;\r\n};\r\n\r\ntype ReactAppProps = { routes: any; withEvents: any };\r\n\r\n// Fix TS2769 error No overload matches this call\r\nconst Container = AppContainer as any; // as typeof AppContainer;\r\n\r\nclass ClientApp {\r\n  constructor(ReactApp: React.ComponentType<ReactAppProps>, config: AppConfig) {\r\n    const documentRoot = document.getElementById('root');\r\n\r\n    const {\r\n      stateType = 'immutable',\r\n      routes,\r\n      withReducers,\r\n      withSagas,\r\n      withEvents,\r\n    } = config;\r\n\r\n    const GetClientJSX = store => {\r\n      const ClientJsx = (\r\n        <Container>\r\n          <CookiesProvider>\r\n            <ReduxProvider store={store}>\r\n              <Router history={history}>\r\n                <ReactApp routes={routes} withEvents={withEvents} />\r\n              </Router>\r\n            </ReduxProvider>\r\n          </CookiesProvider>\r\n        </Container>\r\n      );\r\n      return ClientJsx;\r\n    };\r\n\r\n    const isProduction = !(process.env.NODE_ENV !== 'production');\r\n\r\n    /**\r\n     * Webpack HMR Setup.\r\n     */\r\n    const HMRRenderer = Component => {\r\n      if (isProduction)\r\n        loadableReady(\r\n          () => {\r\n            hydrate(Component, documentRoot);\r\n          },\r\n          { namespace: 'modern' }\r\n        );\r\n      else render(Component, documentRoot);\r\n    };\r\n\r\n    const hmr = store => {\r\n      // webpack Hot Module Replacement API\r\n      if (module.hot) {\r\n        module.hot.accept(ReactApp as unknown as string, () => {\r\n          // if you are using harmony modules ({modules:false})\r\n          HMRRenderer(GetClientJSX(store));\r\n        });\r\n      }\r\n    };\r\n\r\n    const qs = parse(window.location.search);\r\n    const versionStatus = deliveryApi.getClientSideVersionStatus();\r\n\r\n    if (\r\n      window.isDynamic ||\r\n      window.REDUX_DATA ||\r\n      process.env.NODE_ENV !== 'production'\r\n    ) {\r\n      createStore(withReducers, window.REDUX_DATA, history, stateType).then(\r\n        store => {\r\n          const state = store.getState();\r\n          const ssrVersionStatus = selectVersionStatus(state);\r\n          if (!ssrVersionStatus)\r\n            store.dispatch(setVersionStatus(versionStatus));\r\n\r\n          /* eslint-disable no-console */\r\n          console.log('Hydrating from inline Redux');\r\n          /* eslint-enable no-console */\r\n          store.runSaga(rootSaga(withSagas));\r\n          store.dispatch(\r\n            setCurrentProject(\r\n              pickProject(window.location.hostname, qs),\r\n              [],\r\n              window.location.hostname\r\n            )\r\n          );\r\n\r\n          delete window.REDUX_DATA;\r\n          HMRRenderer(GetClientJSX(store));\r\n\r\n          hmr(store);\r\n        }\r\n      );\r\n    } else {\r\n      fetch(`${window.location.pathname}?redux=true`)\r\n        .then(response => response.json())\r\n        .then(data => {\r\n          const ssRedux = JSON.parse(data);\r\n          createStore(withReducers, ssRedux, history, stateType).then(store => {\r\n            store.dispatch(setVersionStatus(versionStatus));\r\n\r\n            store.runSaga(rootSaga(withSagas));\r\n            store.dispatch(\r\n              setCurrentProject(\r\n                pickProject(window.location.hostname, qs),\r\n                [],\r\n                window.location.hostname\r\n              )\r\n            );\r\n\r\n            HMRRenderer(GetClientJSX(store));\r\n\r\n            hmr(store);\r\n          });\r\n        });\r\n    }\r\n  }\r\n}\r\n\r\nexport default ClientApp;\r\n"],"names":["Container","AppContainer","ClientApp","constructor","ReactApp","config","documentRoot","document","getElementById","stateType","routes","withReducers","withSagas","withEvents","GetClientJSX","store","ClientJsx","React","createElement","CookiesProvider","ReduxProvider","Router","history","isProduction","process","env","NODE_ENV","HMRRenderer","Component","loadableReady","hydrate","namespace","render","hmr","module","hot","accept","qs","parse","window","location","search","versionStatus","deliveryApi","getClientSideVersionStatus","isDynamic","REDUX_DATA","createStore","then","state","getState","ssrVersionStatus","selectVersionStatus","dispatch","setVersionStatus","console","log","runSaga","rootSaga","setCurrentProject","pickProject","hostname","fetch","pathname","response","json","data","ssRedux","JSON"],"mappings":"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"}