{"version":3,"file":"contensis-react-base.js","sources":["../src/server/features/linkdepth-api/util.ts","../src/server/features/linkdepth-api/search.ts","../src/server/features/linkdepth-api/QueryLevelResults.ts","../src/server/features/linkdepth-api/LinkDepthSearchService.ts","../src/server/features/linkdepth-api/api.ts","../src/server/features/reverse-proxy/index.ts","../src/server/features/caching/cacheDuration.schema.ts","../src/server/util/staticPaths.ts","../src/server/middleware/bundleManipulation.ts","../src/server/middleware/resolveStartup.ts","../src/server/features/static-assets/index.ts","../src/server/util/displayStartupConfiguration.ts","../src/server/util/stringifyAttributes.ts","../src/server/features/response-handler/index.ts","../src/server/util/bundles.ts","../src/server/util/headers.ts","../src/server/util/getVersionInfo.ts","../src/server/util/handleExceptions.ts","../src/server/webApp.tsx","../src/server/internalServer.ts"],"sourcesContent":["import { Entry } from 'contensis-delivery-api/lib/models';\nimport { PagedList } from 'contensis-core-api';\n/**\n * Util class holds our search results helper boilerplate methods\n */\nexport class Util {\n  static GetIds(entries: Entry[], fieldId?: string) {\n    if (fieldId) {\n      return entries\n        ?.map(e =>\n          Array.isArray(e?.[fieldId])\n            ? e?.[fieldId]?.map((f: Entry) => f?.sys?.id)\n            : e?.[fieldId]?.sys?.id || ''\n        )\n        .flat();\n    }\n    return entries?.map(e => e?.sys?.id || '');\n  }\n\n  static GetItems(result: PagedList<Entry>) {\n    return this.GetResults(result) ? result.items : [];\n  }\n\n  static GetResults(result: PagedList<Entry>) {\n    if (result?.items) {\n      return result;\n    } else {\n      return null;\n    }\n  }\n}\n\nexport const mergeResults = (\n  results: Entry[],\n  parentResults: Entry[],\n  replaceContentTypeIds: string[],\n  linkFieldId: string\n) =>\n  results\n    .map(r => {\n      if (replaceContentTypeIds.some(c => c === r.sys.contentTypeId)) {\n        const resolvedParent = parentResults?.find(e =>\n          e[linkFieldId]?.some((l: Entry) => l.sys?.id === r.sys.id)\n        );\n        if (resolvedParent)\n          return {\n            ...resolvedParent,\n            ...r,\n            entryTitle: resolvedParent.entryTitle,\n            entryDescription: resolvedParent.entryDescription,\n            sys: resolvedParent.sys,\n            originalSys: r.sys,\n          };\n        else return r;\n      }\n      return r;\n    })\n    .filter(r => r) as Entry[];\n","import {\n  expressions as exp,\n  FieldOperators,\n  FilterExpression,\n  LogicOperators,\n  SearchQueryOptions,\n} from '~/search';\nimport { Op, Query } from 'contensis-core-api';\nimport { Entry } from 'contensis-delivery-api/lib/models';\nimport { cachedSearch } from '~/util/ContensisDeliveryApi';\nimport { LinkDepthApiFilters } from './api.d';\nimport { mergeResults, Util } from './util';\n\ntype WithOptional<T, K extends keyof T> = Omit<T, K> & Partial<Pick<T, K>>;\n\ntype SearchQueryArgs = WithOptional<\n  SearchQueryOptions & {\n    idFilters?: SearchQueryOptions['filters'];\n    sharedFilters?: SearchQueryOptions['filters'];\n  },\n  | 'aggregations'\n  | 'assetTypes'\n  | 'customWhere'\n  | 'dynamicOrderBy'\n  | 'excludeIds'\n  | 'featuredResults'\n  | 'fieldLinkDepths'\n  | 'fields'\n  | 'includeInSearchFields'\n  | 'languages'\n  | 'omitDefaultSearchFields'\n  | 'orderBy'\n  | 'pageIndex'\n  | 'searchTerm'\n  | 'webpageTemplates'\n  | 'weightedSearchFields'\n>;\n/**\n * Builds our complete Delivery API Query object from a set of provided arguments\n * @param queryParams\n * @returns Delivery API Query\n */\nexport const searchQuery = ({\n  assetTypes,\n  contentTypeIds,\n  customWhere,\n  fields,\n  filters,\n  idFilters = [],\n  sharedFilters = [],\n  pageSize,\n  pageIndex = 0,\n  orderBy,\n  searchTerm,\n  versionStatus = 'published',\n  webpageTemplates,\n  weightedSearchFields,\n}: SearchQueryArgs) => {\n  const expressions = [\n    ...exp.defaultExpressions(versionStatus),\n    ...exp.contentTypeIdExpression(\n      contentTypeIds,\n      webpageTemplates,\n      assetTypes\n    ),\n    ...exp.customWhereExpressions(customWhere),\n    ...exp.filterExpressions(filters),\n    ...exp.filterExpressions(idFilters),\n    ...(sharedFilters?.length > 0\n      ? [Op.or(...exp.filterExpressions(sharedFilters, true))]\n      : []),\n    ...exp.termExpressions(searchTerm || '', weightedSearchFields || []),\n  ];\n\n  const query = new Query(...expressions);\n\n  query.orderBy = exp.orderByExpression(orderBy || []);\n\n  if (fields && fields.length > 0) {\n    (query as any).fields = fields;\n  }\n\n  // (query as any).includeArchived = true;\n  // (query as any).includeDeleted = true;\n  query.pageIndex = pageIndex;\n  query.pageSize = pageSize;\n  return query;\n};\n\nexport const appendSearchQueryFilters = (\n  query: Query,\n  idFilters: FilterExpression[]\n) => {\n  query.where.addRange(exp.filterExpressions(idFilters));\n};\n\nexport const finalQuery = (\n  {\n    assetTypes,\n    contentTypeIds,\n    fields,\n    filters,\n    idFilters,\n    sharedFilters,\n    pageSize,\n    pageIndex,\n    orderBy,\n    searchTerm,\n    versionStatus = 'published',\n    webpageTemplates,\n    weightedSearchFields,\n  }: SearchQueryArgs,\n  children: Omit<SearchQueryArgs, 'pageSize' | 'pageIndex' | 'versionStatus'>[]\n) => {\n  const expressions = [\n    ...exp.defaultExpressions(versionStatus),\n    Op.or(\n      Op.and(\n        ...exp.contentTypeIdExpression(\n          contentTypeIds,\n          webpageTemplates,\n          assetTypes\n        ),\n        ...exp.filterExpressions(filters),\n        ...exp.filterExpressions(idFilters || []),\n\n        ...(sharedFilters?.length\n          ? [\n            Op.or(\n              ...exp.filterExpressions(sharedFilters || [])\n              // Op.and(\n              //   ...sharedFilters.map(sf =>\n              //     Op.not(exp.fieldExpression(sf.key, true, 'exists')[0])\n              //   ),\n              //   ...exp.filterExpressions(idFilters)\n              // )\n            ),\n          ]\n          : [])\n      ),\n      ...children.map(child =>\n        Op.and(\n          ...exp.contentTypeIdExpression(\n            child.contentTypeIds,\n            child.webpageTemplates,\n            child.assetTypes\n          ),\n          ...exp.filterExpressions(child.sharedFilters || []),\n          ...exp.filterExpressions(child.idFilters || [])\n        )\n      )\n    ),\n    ...exp.termExpressions(searchTerm || '', weightedSearchFields || []),\n  ];\n\n  const query = new Query(...expressions);\n\n  query.orderBy = exp.orderByExpression(orderBy || []);\n\n  if (fields && fields.length > 0) {\n    (query as any).fields = fields;\n  }\n\n  // (query as any).includeArchived = true;\n  // (query as any).includeDeleted = true;\n  query.pageIndex = pageIndex || 0;\n  query.pageSize = pageSize;\n  return query;\n};\n\n/**\n * Create a filter expression from a provided filters configuration object\n * and populate them based on the presence of that key in params, filter\n * out any filter keys that do not have a value set in params\n * @param f filters configuration from any level\n * @param params request.query object from Express middleware\n * @returns FilterExpression[] we can use to use with searchQuery function\n */\nexport const makeFilterExpressions = (\n  f: LinkDepthApiFilters,\n  params: { [param: string]: string | undefined }\n): FilterExpression[] => {\n  const expressions: FilterExpression[] = [];\n  for (const [paramKey, filterConfig] of Object.entries(f)) {\n    const filterValues = params[paramKey]?.split(',');\n    if (typeof filterValues !== 'undefined')\n      expressions.push({\n        key:\n          typeof filterConfig === 'object'\n            ? filterConfig.fieldId\n            : filterConfig,\n        values: filterValues,\n        fieldOperator:\n          typeof filterConfig === 'object' && filterConfig.fieldOperator\n            ? (filterConfig.fieldOperator as FieldOperators)\n            : 'equalTo',\n        logicOperator:\n          typeof filterConfig === 'object' && filterConfig.logicOperator\n            ? (filterConfig.logicOperator as LogicOperators)\n            : 'or',\n      });\n  }\n  return expressions;\n};\n\nexport const makeDerivedIdsFilterExpression = (\n  prevFieldId: string,\n  entries: Entry[],\n  ownIds = false,\n  alwaysApplyFilter = false\n) => {\n  const previouslyDerivedIdsFilter = [] as FilterExpression[];\n  const prevResultIds = Util.GetIds(entries);\n\n  if (prevFieldId && prevResultIds?.length > 0)\n    previouslyDerivedIdsFilter.push({\n      key: ownIds ? 'sys.id' : `${prevFieldId}.sys.id`,\n      values: prevResultIds,\n      fieldOperator: 'in',\n      logicOperator: 'or',\n    });\n  else if (alwaysApplyFilter)\n    previouslyDerivedIdsFilter.push({\n      key: 'intended-dud',\n      values: ['1'],\n      fieldOperator: 'in',\n      logicOperator: 'or',\n    });\n  return previouslyDerivedIdsFilter;\n};\n\nexport const resolveParentEntries = async (\n  parentContentTypeIds: string[],\n  replaceContentTypeIds: string[],\n  parentFieldId: string,\n  results: Entry[],\n  params: any,\n  debug: boolean\n) => {\n  // Build variables from query config to use in our Delivery API Query\n  const previousIdsFilter = makeDerivedIdsFilterExpression(\n    parentFieldId,\n    results\n  ) as any;\n\n  const query = searchQuery({\n    contentTypeIds: parentContentTypeIds,\n    idFilters: previousIdsFilter,\n  } as any);\n  query.fields = params.fields\n    ? [...(JSON.parse(params.fields) as unknown as string[]), parentFieldId]\n    : [];\n\n  if (debug)\n    console.log(\n      `\\nResolve parent entries query: \\n${JSON.stringify(\n        query.toJSON()\n      ).substring(0, 1000)}`\n    );\n\n  const parentResults = await cachedSearch.searchUsingPost(\n    query,\n    Number(params.linkDepth || 0),\n    params.projectId\n  );\n\n  return mergeResults(\n    results,\n    Util.GetItems(parentResults),\n    replaceContentTypeIds,\n    parentFieldId\n  );\n};\n","/* eslint-disable no-console */\nimport { PagedList } from 'contensis-core-api';\nimport { Query } from 'contensis-delivery-api';\nimport { Entry } from 'contensis-delivery-api/lib/models';\nimport { cachedSearch } from '~/util/ContensisDeliveryApi';\nimport {\n  appendSearchQueryFilters,\n  makeFilterExpressions,\n  searchQuery,\n} from './search';\nimport { LinkDepthApiFilters, LinkFields } from './api.d';\nimport { Util } from './util';\n\nclass QueryLevelResults {\n  level: number;\n  contentTypeIds: string[];\n  linkFieldIds: string[];\n  linkFields: LinkFields;\n  filters: LinkDepthApiFilters;\n  sharedFilters: LinkDepthApiFilters;\n  returnEntries: boolean;\n  resolveFirstParent: boolean;\n\n  validatedLinks: {\n    contentTypeId: string;\n    linkFieldId: string;\n    entryIds: string[];\n  }[] = [];\n\n  parent: QueryLevelResults | undefined;\n  children: QueryLevelResults[] = [];\n  runFirstQuery: boolean;\n  runFinalQuery: boolean;\n\n  private params: { [key: string]: string | undefined } = {};\n  private debug: boolean;\n\n  private firstQuery: Query = new Query();\n  private firstResults: PagedList<Entry> = {} as PagedList<Entry>;\n\n  private finalQuery: Query = new Query();\n  private finalResults: PagedList<Entry> = {} as PagedList<Entry>;\n\n  constructor({\n    level,\n    contentTypeIds,\n    linkFields,\n    filters,\n    sharedFilters,\n    returnEntries,\n    resolveFirstParent,\n    params = {},\n    parent,\n    debug = false,\n  }: {\n    level: number;\n    contentTypeIds: string[];\n    linkFields: LinkFields;\n    filters: LinkDepthApiFilters;\n    sharedFilters: LinkDepthApiFilters;\n    returnEntries?: boolean;\n    resolveFirstParent?: boolean;\n    params: { [key: string]: string | undefined };\n    parent?: QueryLevelResults;\n    debug?: boolean;\n  }) {\n    this.level = level;\n    this.contentTypeIds = contentTypeIds;\n    this.linkFields = linkFields;\n    this.linkFieldIds = Object.keys(linkFields).map(fId => fId);\n    this.filters = filters;\n    this.sharedFilters = sharedFilters;\n    this.returnEntries =\n      typeof returnEntries === 'undefined' ? level === 0 : returnEntries;\n    this.resolveFirstParent = resolveFirstParent || false;\n    this.params = params;\n    this.parent = parent;\n    this.debug = debug;\n\n    this.runFirstQuery = Object.keys(params).some(\n      p =>\n        Object.keys(filters).includes(p) ||\n        Object.keys(sharedFilters).includes(p)\n    );\n    this.runFinalQuery = Object.keys(params).some(\n      p =>\n        Object.keys(filters).includes(p) ||\n        Object.keys(sharedFilters).includes(p)\n    );\n\n    this.firstQuery = searchQuery({\n      contentTypeIds,\n      filters: makeFilterExpressions(filters, params),\n      sharedFilters: makeFilterExpressions(sharedFilters, params),\n      // idFilters: parent?.validatedLinks\n      //   ? makeFilterExpressions(parent.validatedLinks, params)\n      //   : [], // these dont exist yet\n      fields: ['sys.id', ...this.linkFieldIds],\n      pageSize: 2000,\n      searchTerm: params.term,\n      versionStatus: params.versionStatus as any,\n    });\n\n    this.finalQuery = searchQuery({\n      contentTypeIds,\n      filters: makeFilterExpressions(filters, params),\n      sharedFilters: makeFilterExpressions(sharedFilters, params),\n      fields: JSON.parse(params.fields || '[]'),\n      pageIndex: level === 0 ? Number(params.pageIndex) : 0,\n      pageSize: level === 0 ? Number(params.pageSize) : 2000,\n      searchTerm: params.term,\n      versionStatus: params.versionStatus as any,\n    });\n  }\n\n  AddChild = ({ child }: { child: QueryLevelResults }) => {\n    this.children.push(child);\n  };\n\n  RunFirstQuery = async () => {\n    const { firstQuery: query, params, parent, runFirstQuery } = this;\n\n    if (parent?.validatedLinks.length) {\n      // add any idFilters derived from parent query results\n      appendSearchQueryFilters(\n        query,\n        makeFilterExpressions(\n          Object.fromEntries(\n            parent.validatedLinks.map(vl => [\n              vl.linkFieldId,\n              { fieldId: `sys.id` },\n            ])\n          ),\n          Object.fromEntries(\n            parent.validatedLinks.map(vl => [\n              vl.linkFieldId,\n              vl.entryIds.join(',') || `no ids from parent ${parent.level}`,\n            ])\n          )\n        )\n      );\n    }\n\n    if (runFirstQuery) {\n      if (this.debug)\n        console.log(\n          `\\nLevel ${this.level} - First query: \\n${JSON.stringify(\n            query.toJSON()\n          ).substring(0, 1000)}`\n        );\n\n      this.firstResults = await cachedSearch.searchUsingPost(\n        query,\n        0,\n        params.projectId\n      );\n\n      // mapResultsToValidatedLinks\n      for (const linkFieldId of this.linkFieldIds) {\n        this.validatedLinks.push({\n          contentTypeId: this.linkFields[linkFieldId].contentTypeId || '',\n          linkFieldId,\n          entryIds: Util.GetIds(this.firstResults.items, linkFieldId),\n        });\n      }\n    }\n  };\n\n  RunFinalQuery = async () => {\n    const { level, children, finalQuery: query, params, runFinalQuery } = this;\n\n    if (!children.some(c => c.returnEntries)) {\n      const firstChild = children?.[0];\n      // add any idFilters derived from child query results\n      if (firstChild)\n        appendSearchQueryFilters(\n          query,\n          makeFilterExpressions(\n            Object.fromEntries(\n              firstChild.validatedLinks.map(vl => [\n                vl.linkFieldId,\n                { fieldId: `${vl.linkFieldId}.sys.id` },\n              ])\n            ),\n            Object.fromEntries(\n              firstChild.validatedLinks.map(vl => [\n                vl.linkFieldId,\n                vl.entryIds.join(',') ||\n                  `no ids from child ${firstChild.level}`,\n              ])\n            )\n          )\n        );\n    }\n\n    if (level === 0 && this.returnEntries) {\n      // This is the final query to be run and response returned to the caller\n      // Only this bit cares about linkDepth, fields and pagination parameters\n      query.fields = JSON.parse(params.fields || '[]') as unknown as string[];\n      query.pageSize = params.pageSize as unknown as number;\n      query.pageIndex = params.pageIndex as unknown as number;\n      // query.orderBy = params.orderBy;\n    }\n\n    if (runFinalQuery) {\n      if (this.debug)\n        console.log(\n          `\\nLevel ${this.level} - Final query: \\n${JSON.stringify(\n            query.toJSON()\n          ).substring(0, 1000)}`\n        );\n      this.finalResults = await cachedSearch.searchUsingPost(\n        query,\n        Number(params.linkDepth) || 0,\n        params.projectId\n      );\n      if (this.parent) this.parent.runFinalQuery = true;\n\n      // mapResultsToValidatedLinks\n      for (const linkFieldId of this.parent?.linkFieldIds || []) {\n        this.validatedLinks.push({\n          contentTypeId:\n            this.parent?.linkFields[linkFieldId].contentTypeId || '',\n          linkFieldId,\n          entryIds: Util.GetIds(this.finalResults.items),\n        });\n      }\n    }\n  };\n\n  GetResultsEntries = () => {\n    const { finalResults, firstResults } = this;\n    return finalResults?.items?.length\n      ? finalResults.items\n      : firstResults.items;\n  };\n\n  GetResults = () => {\n    const { finalResults, firstResults } = this;\n    return typeof finalResults?.totalCount !== 'undefined'\n      ? finalResults\n      : firstResults;\n  };\n}\n\nexport default QueryLevelResults;\n","/* eslint-disable no-console */\nimport { cachedSearch } from '~/util/ContensisDeliveryApi';\nimport { LinkDepthApiConfig, LinkDepthApiFilters, LinkFields } from './api.d';\nimport QueryLevelResults from './QueryLevelResults';\nimport {\n  finalQuery,\n  makeDerivedIdsFilterExpression,\n  makeFilterExpressions,\n  resolveParentEntries,\n} from './search';\n\nexport type LinkDepthSearchServiceConstuctorArgs =\n  Partial<LinkDepthApiConfig> & {\n    params: { [key: string]: string | undefined };\n    debug?: boolean;\n  };\n\nclass LinkDepthSearchService {\n  contentTypeIds: string[];\n  filters: LinkDepthApiFilters;\n  sharedFilters: LinkDepthApiFilters;\n  linkFields: LinkFields;\n  params: { [key: string]: string | undefined };\n  debug: boolean;\n\n  queryLevels: QueryLevelResults[];\n\n  constructor({\n    contentTypeId = '',\n    filters = {},\n    sharedFilters = {},\n    linkFields = {},\n    params,\n    debug = false,\n  }: LinkDepthSearchServiceConstuctorArgs) {\n    this.contentTypeIds = Array.isArray(contentTypeId)\n      ? contentTypeId\n      : [contentTypeId];\n    this.filters = filters;\n    this.sharedFilters = sharedFilters;\n    this.linkFields = linkFields;\n    this.params = params;\n    this.debug = debug;\n\n    this.queryLevels = this.InitQueryLevels();\n  }\n\n  DoSearch = async () => {\n    // Run queries \"top-down\" through each level of `linkField`\n    for (const queryLevel of this.queryLevels) {\n      await queryLevel.RunFirstQuery();\n    }\n\n    // Run queries \"bottom-up\" through each level of `linkField`\n    for (const queryLevel of [...this.queryLevels].reverse()) {\n      await queryLevel.RunFinalQuery();\n    }\n\n    // Run a final query that will aggregate the results from all levels\n    // adding all levels to the query that have `returnEntries` set true\n    return await this.RunFinalQueries();\n  };\n\n  RunFinalQueries = async () => {\n    const finalQueryLevels = this.queryLevels.filter(\n      ql =>\n        (ql.level > 0 && ql.returnEntries) ||\n        (ql.level === 0 && ql.returnEntries !== false)\n    );\n\n    // Decide if we need a further final query if any child level(s) have had `returnEntries` set to true\n    if (\n      finalQueryLevels.length > 1 ||\n      (finalQueryLevels.length === 1 && finalQueryLevels[0].level !== 0)\n    ) {\n      // Build final query\n      const { contentTypeIds, filters, sharedFilters, params } = this;\n      const derivedIds =\n        finalQueryLevels[0].children\n          .filter(ql => !ql.returnEntries)\n          .map(ql => ql.validatedLinks)\n          .flat() || [];\n      const derivedIdFilters =\n        derivedIds\n          .map(vl =>\n            makeFilterExpressions(\n              {\n                [vl.linkFieldId]: {\n                  fieldId: `${vl.linkFieldId}.sys.id`,\n                },\n              },\n              {\n                [vl.linkFieldId]:\n                  vl.entryIds.join(',') || 'no results for filter',\n              }\n            )\n          )\n          .flat() || [];\n      // This is the final query to be run and response returned to the caller\n      // Only this bit cares about linkDepth, fields and pagination parameters\n      const query = finalQuery(\n        {\n          contentTypeIds,\n          filters: makeFilterExpressions(filters, params),\n          sharedFilters: makeFilterExpressions(sharedFilters, params),\n          idFilters: derivedIdFilters,\n          fields: params.fields\n            ? [\n                ...JSON.parse(params.fields),\n                ...finalQueryLevels\n                  .map(l => l.parent?.linkFieldIds || [])\n                  .flat(),\n              ]\n            : [],\n          orderBy: params.orderBy?.split(','),\n          pageIndex: Number(params.pageIndex) || 0,\n          pageSize:\n            typeof Number(params.pageSize) === 'number'\n              ? Number(params.pageSize)\n              : 25,\n          searchTerm: params.term,\n          versionStatus: params.versionStatus as any,\n        },\n        finalQueryLevels?.[0].children\n          .filter(ql => ql.returnEntries)\n          .map(ql => {\n            const entriesAtLevel =\n              ql.GetResultsEntries() || ql.parent?.GetResultsEntries();\n            const previousIdsFilter =\n              ql.returnEntries || !!ql.children.some(qc => qc.returnEntries)\n                ? ql.parent?.linkFieldIds\n                    .map(fieldId =>\n                      makeDerivedIdsFilterExpression(\n                        fieldId,\n                        entriesAtLevel,\n                        true,\n                        ql.runFinalQuery\n                      )\n                    )\n                    .flat()\n                : [];\n            return {\n              contentTypeIds: ql.contentTypeIds,\n              filters: makeFilterExpressions(ql.filters, params),\n              sharedFilters: makeFilterExpressions(ql.sharedFilters, params),\n              idFilters: previousIdsFilter,\n            };\n          }) || []\n      );\n      if (this.debug)\n        console.log(\n          `\\nFinal query: ${derivedIds.reduce(\n            (accumulator, object) => accumulator + object.entryIds.length,\n            0\n          )} derived ids \\n${JSON.stringify(query.toJSON()).substring(0, 1000)}`\n        );\n\n      const finalQueryResult = await cachedSearch.searchUsingPost(\n        query,\n        Number(params.linkDepth) || 0,\n        params.projectId\n      );\n\n      // Resolve any parent entries\n\n      const resolveParentLevels = finalQueryLevels.filter(\n        ql => ql.resolveFirstParent\n      );\n\n      let entries = finalQueryResult.items;\n\n      for (const resolveParents of resolveParentLevels) {\n        entries = await resolveParentEntries(\n          resolveParents.parent?.contentTypeIds || [],\n          resolveParents.contentTypeIds,\n          resolveParents.parent?.linkFieldIds[0] || 'unknown',\n          finalQueryResult.items, // or entries?\n          this.params,\n          this.debug\n        );\n      }\n\n      return { ...finalQueryResult, items: entries };\n    } else {\n      if (this.debug) console.log(`\\nNo further queries required\\n`);\n      return this.queryLevels.find(ql => ql.level === 0)?.GetResults();\n    }\n  };\n\n  private InitQueryLevels = () => {\n    const createChildQueryLevels = (\n      linkFields: LinkFields,\n      parentQueryLevel: QueryLevelResults,\n      level = 1\n    ): QueryLevelResults[] => {\n      return Object.entries(linkFields)\n        .map(\n          ([\n            ,\n            {\n              contentTypeId = '',\n              filters = {},\n              linkFields = {},\n              resolveFirstParent,\n              returnEntries,\n              sharedFilters = {},\n            },\n          ]) => {\n            const thisLevel = new QueryLevelResults({\n              level,\n              contentTypeIds: Array.isArray(contentTypeId)\n                ? contentTypeId\n                : [contentTypeId],\n              filters: Object.fromEntries(\n                Object.entries(filters).map(([fKey, fVal]) => [\n                  fKey,\n                  typeof fVal === 'string' ? { fieldId: fVal } : fVal,\n                ])\n              ),\n              sharedFilters: Object.fromEntries(\n                Object.entries(sharedFilters).map(([fKey, fVal]) => [\n                  fKey,\n                  typeof fVal === 'string' ? { fieldId: fVal } : fVal,\n                ])\n              ),\n              linkFields,\n              parent: parentQueryLevel,\n              params,\n              resolveFirstParent,\n              returnEntries,\n              debug: this.debug,\n            });\n\n            parentQueryLevel.AddChild({ child: thisLevel });\n\n            return [\n              thisLevel,\n              ...createChildQueryLevels(linkFields, thisLevel, level + 1),\n            ];\n          }\n        )\n        .flat();\n    };\n    const { contentTypeIds, filters, sharedFilters, linkFields, params } = this;\n\n    const firstLevel = new QueryLevelResults({\n      level: 0,\n      contentTypeIds,\n      filters: Object.fromEntries(\n        Object.entries(filters).map(([fKey, fVal]) => [\n          fKey,\n          typeof fVal === 'string' ? { fieldId: fVal } : fVal,\n        ])\n      ),\n      sharedFilters: Object.fromEntries(\n        Object.entries(sharedFilters).map(([fKey, fVal]) => [\n          fKey,\n          typeof fVal === 'string' ? { fieldId: fVal } : fVal,\n        ])\n      ),\n      linkFields,\n      params,\n      debug: this.debug,\n    });\n\n    const queryLevels = [\n      firstLevel,\n      ...createChildQueryLevels(linkFields, firstLevel),\n    ];\n    // return queryLevels;\n\n    // If we are only returning entries from level 0\n    // we can skip running the first query and finalQuery will suffice\n    if (queryLevels.find(ql => ql.returnEntries && ql.level !== 0))\n      return queryLevels;\n    else\n      return queryLevels.map(ql => {\n        ql.runFirstQuery = false;\n        // ql.runFinalQuery = false;\n        return ql;\n      });\n  };\n}\n\nexport default LinkDepthSearchService;\n","import { Express, RequestHandler } from 'express';\nimport LinkDepthSearchService from './LinkDepthSearchService';\nimport setCachingHeaders from '../caching/setCachingHeaders';\nimport { LinkDepthApiConfig } from './api.d';\n\n/**\n * Make a LinkDepth api at the uri specified in middlewareConfig.\n * The api supports a GET request and specified filters are supplied as query-string parameters.\n * The response should be a normal Delivery API response.\n * @param app Express app instance\n * @param middlewareConfig Middleware configuration that represents the content types we want to search within, any filters that are required and any linkFields we wish to search within to derive a set of search results from the entries that contain the linkFields. Each key inside of linkFields represents another \"linkDepth\" of entries and we can specify all the same contentTypeId, filters, and linkFields of their own. There is no currently no limit on how deep these linkFields can go\n * @returns Returns nothing if uri, contentTypeId or linkFields is not set in middlewareConfig\n */\nconst makeLinkDepthApi = (\n  app: Express,\n  middlewareConfig: LinkDepthApiConfig\n) => {\n  const { uri, contentTypeId, linkFields } = middlewareConfig;\n  if (!contentTypeId || !linkFields || !uri) return;\n\n  app.get(uri, makeLinkDepthMiddleware(middlewareConfig));\n};\n\n/** Create a content type hierarchy from supplied config and produces\n * a RequestHandler function to serve our Express middleware */\nconst makeLinkDepthMiddleware = ({\n  contentTypeId,\n  filters = {},\n  sharedFilters = {},\n  linkFields,\n  debug,\n}: LinkDepthApiConfig) => {\n  try {\n    // The runtime express request handler\n    const linkDepthMiddleware: RequestHandler = async (req, res) => {\n      try {\n        // Short cache duration copied from canterbury project\n        setCachingHeaders(res, {\n          cacheControl: 'private',\n          surrogateControl: '10',\n        });\n\n        // Gather all params from the request, we will use them at the right query levels later\n        const params = Object.fromEntries(\n          [...Object.entries(req.params), ...Object.entries(req.query)].map(\n            ([k, v]) => [k, v?.toString()]\n          )\n        );\n\n        const result = await new LinkDepthSearchService({\n          contentTypeId,\n          linkFields,\n          filters,\n          sharedFilters,\n          params,\n          debug,\n        }).DoSearch();\n\n        res.json(result);\n      } catch (error) {\n        // This is a runtime error encountered when processing a given request\n        console.error(error);\n        res.statusCode = 500;\n        res.json(error);\n      }\n    };\n\n    return linkDepthMiddleware;\n  } catch (error) {\n    // This will be an error building the middleware\n    // we can only serve what the error was as the request handler instead\n    console.error(error);\n    const errorMiddleware: RequestHandler = async (req, res) => {\n      res.statusCode = 500;\n      res.json(JSON.stringify(error));\n    };\n    return errorMiddleware;\n  }\n};\n\nexport default makeLinkDepthApi;\n","import { Express } from 'express';\nimport httpProxy from 'http-proxy';\nimport url from '~/util/urls';\n\nconst servers = SERVERS; /* global SERVERS */\nconst project = PROJECT; /* global PROJECT */\nconst alias = ALIAS; /* global ALIAS */\nconst deliveryApiHostname = url(alias, project).api;\n\nexport const assetProxy = httpProxy.createProxyServer();\nexport const deliveryProxy = httpProxy.createProxyServer();\n\nconst reverseProxies = (app: Express, reverseProxyPaths: string[] = []) => {\n  deliveryApiProxy(deliveryProxy, app);\n\n  app.all(reverseProxyPaths, (req, res) => {\n    const target =\n      req.hostname.indexOf('preview-') ||\n      req.hostname.indexOf('preview.') ||\n      req.hostname === 'localhost'\n        ? servers.previewIis || servers.iis\n        : servers.iis;\n\n    assetProxy.web(req, res, { target, changeOrigin: true });\n    assetProxy.on('error', e => {\n      /* eslint-disable no-console */\n      console.log(\n        `Proxy Request for ${req.path} HostName:${req.hostname} failed with ${e}`\n      );\n      /* eslint-enable no-console */\n    });\n  });\n};\n\nconst deliveryApiProxy = (apiProxy, app) => {\n  // This is just here to stop cors requests on localhost. In Production this is mapped using varnish.\n  app.all(\n    ['/api/delivery/*', '/api/forms/*', '/api/image/*', '/authenticate/*'],\n    (req, res) => {\n      /* eslint-disable no-console */\n      console.log(`Proxying api request to ${servers.alias}`);\n      apiProxy.web(req, res, {\n        target: deliveryApiHostname,\n        changeOrigin: true,\n      });\n      apiProxy.on('error', e => {\n        /* eslint-disable no-console */\n        console.log(\n          `Proxy request for ${req.path} HostName:${req.hostname} failed with ${e}`\n        );\n        /* eslint-enable no-console */\n      });\n    }\n  );\n};\n\nexport default reverseProxies;\n","export const CacheDuration = {\n  200: '3600',\n  404: '5',\n  static: '31536000', // Believe it or not these two max ages are the same in runtime\n  expressStatic: '31557600h', // Believe it or not these two max ages are the same in runtime\n};\n\nexport const getCacheDuration = (status = 200) => {\n  if (status >= 400) return CacheDuration[404];\n  return CacheDuration[200];\n};\n\nconst alias = ALIAS; /* global ALIAS */\n\nexport const anyUpdateHeader = `${alias}_any-update`;\n","export const replaceStaticPath = (str: string, staticFolderPath = 'static') =>\n  str.replace(/static\\//g, `${staticFolderPath}/`);\n","import { RequestHandler } from 'express';\nimport fs from 'fs';\nimport path from 'path';\nimport { replaceStaticPath } from '../util/staticPaths';\n\nexport const bundleManipulationMiddleware =\n  ({\n    appRootPath,\n    maxage,\n    staticFolderPath,\n    staticRoutePath,\n  }: {\n    appRootPath: string;\n    maxage: string;\n    staticFolderPath: string;\n    staticRoutePath: string;\n  }): RequestHandler =>\n  (req, res, next) => {\n    const filename = path.basename(encodeURI(req.path));\n    const modernBundle = filename.endsWith('.mjs');\n    const legacyBundle = filename.endsWith('.js');\n    if ((legacyBundle || modernBundle) && filename.startsWith('runtime.')) {\n      const jsRuntimeLocation = path.resolve(\n        appRootPath,\n        `dist/${staticFolderPath}/${\n          modernBundle ? 'modern/js' : 'legacy/js'\n        }/${filename}`\n      );\n      try {\n        const jsRuntimeBundle = fs.readFileSync(jsRuntimeLocation, 'utf8');\n        const modifiedBundle = replaceStaticPath(\n          jsRuntimeBundle,\n          staticRoutePath\n        );\n        if (maxage) res.set('Cache-Control', `public, max-age=${maxage}`);\n        res.type('.js').send(modifiedBundle);\n        return;\n      } catch (readError) {\n        console.log(\n          `Unable to find js runtime bundle at '${jsRuntimeLocation}'`,\n          readError\n        );\n        next();\n      }\n    } else {\n      next();\n    }\n  };\n","import { RequestHandler } from 'express';\nimport fs from 'fs';\nimport path from 'path';\n\n/**\n *\n * @param { appRootPath: string; maxage: number; staticFolderPath: string, startupScriptFilename: string } args\n * @returns Response | next()\n * A middleware function to resolve /dist/static/startup.js under a supplied startupScriptFilename variable\n */\nexport const resolveStartupMiddleware =\n  ({\n    appRootPath,\n    maxage,\n    staticFolderPath,\n    startupScriptFilename,\n  }: {\n    appRootPath: string;\n    maxage: string;\n    staticFolderPath: string;\n    startupScriptFilename: string;\n  }): RequestHandler =>\n  async (req, res, next) => {\n    if (\n      startupScriptFilename !== 'startup.js' &&\n      req.path === `/${startupScriptFilename}`\n    ) {\n      let startupFileLocation = '';\n      try {\n        const startupFilePaths = [\n          `dist/static/startup.js`,\n          `dist/${staticFolderPath}/startup.js`,\n        ];\n        let startupFilePath = '';\n        startupFilePaths.forEach(async testPath => {\n          try {\n            fs.accessSync(testPath);\n            startupFilePath = testPath;\n          } catch (ex) {\n            // Do nothing\n          }\n        });\n        startupFileLocation = path.resolve(appRootPath, startupFilePath);\n\n        if (maxage) res.set('Cache-Control', `public, max-age=${maxage}`);\n\n        res.sendFile(startupFileLocation);\n      } catch (sendFileError) {\n        // eslint-disable-next-line no-console\n        console.log(\n          `Unable to send file startup.js at '${startupFileLocation}'`,\n          sendFileError\n        );\n        next();\n      }\n    } else {\n      next();\n    }\n  };\n","import express from 'express';\nimport { CacheDuration } from '~/server/features/caching/cacheDuration.schema';\nimport { bundleManipulationMiddleware } from '~/server/middleware/bundleManipulation';\nimport { resolveStartupMiddleware } from '~/server/middleware/resolveStartup';\n\nimport { path as appPath } from 'app-root-path';\nimport { ServerConfig } from '~/models';\n// Serving static assets\nconst staticAssets = (\n  app,\n  {\n    appRootPath = appPath,\n    scripts = {} as NonNullable<ServerConfig['scripts']>,\n    startupScriptFilename = 'startup.js',\n    staticFolderPath = 'static',\n    staticRoutePath = 'static',\n    staticRoutePaths = [] as string[],\n  }\n) => {\n  app.use(\n    [\n      `/${staticRoutePath}`,\n      ...staticRoutePaths.map(p => `/${p}`),\n      `/${staticFolderPath}`,\n    ],\n    bundleManipulationMiddleware({\n      appRootPath,\n      // these maxage values are different in config but the same in runtime,\n      // this one is the true value in seconds\n      maxage: CacheDuration.static,\n      staticFolderPath,\n      staticRoutePath,\n    }),\n    resolveStartupMiddleware({\n      appRootPath,\n      maxage: CacheDuration.static,\n      startupScriptFilename: scripts.startup || startupScriptFilename,\n      staticFolderPath,\n    }),\n    // eslint-disable-next-line import/no-named-as-default-member\n    express.static(`dist/${staticFolderPath}`, {\n      // these maxage values are different in config but the same in runtime,\n      // this one is somehow converted and should end up being the same as CacheDuration.static\n      maxAge: CacheDuration.expressStatic,\n    })\n  );\n};\n\nexport default staticAssets;\n","const servers = SERVERS; /* global SERVERS */\nconst projects = PROJECTS; /* global PROJECTS */\n\nconst DisplayStartupConfiguration = config => {\n  /* eslint-disable no-console */\n  console.log();\n  console.log(\n    `Configured servers:\n`,\n    JSON.stringify(servers, null, 2)\n  );\n  console.log();\n  console.log(\n    `Configured projects:\n`,\n    JSON.stringify(projects, null, 2)\n  );\n  console.log();\n  console.log(\n    'Reverse proxy paths: ',\n    JSON.stringify(config.reverseProxyPaths, null, 2)\n  );\n  console.log();\n  if (config.staticFolderPath)\n    console.log(\n      `Serving static assets from: \"/dist/${config.staticFolderPath}/\"`\n    );\n  /* eslint-enable no-console */\n};\n\nexport default DisplayStartupConfiguration;\n","export default (attributes = {}) =>\n  Object.entries(attributes)\n    .map(\n      ([key, value], idx) =>\n        `${idx !== 0 ? ' ' : ''}${key}${value ? `=\"${value}\"` : ''}`\n    )\n    .join(' ');\n","/* eslint-disable no-console */\nimport { Request, Response } from 'express';\nimport { ResponseMethod } from './types';\n\n/**\n * Web Application Response handler, sends a prepared express js response\n * with the supplied content sending in the specified manner\n * @param {response} request express js request object\n * @param {response} response express js response object\n * @param {string | object} content the content to send in the response body\n * @param {\"send\" | \"json\" | \"end\"} send the response function to call e.g res.send() res.json() res.end()\n */\nconst handleResponse = (\n  request: Request,\n  response: Response,\n  content: any,\n  send: keyof typeof ResponseMethod = 'send'\n) => {\n  // console.log('---', response.statusCode, '---');\n  response[send](content);\n};\n\nexport default handleResponse;\n","import fs from 'fs';\nimport path from 'path';\nimport { ChunkExtractor } from '@loadable/server';\nimport { replaceStaticPath } from './staticPaths';\nimport { ServerConfig } from '~/models';\nimport stringifyAttributes from './stringifyAttributes';\n\nconst readFileSync = (path: string) => fs.readFileSync(path, 'utf8');\n\nexport const loadableBundleData = (\n  { stats, templates }: ServerConfig,\n  staticRoutePath: string,\n  build?: string\n) => {\n  const bundle: {\n    stats?: string | null;\n    templates?: {\n      templateHTML: string;\n      templateHTMLStatic: string;\n      templateHTMLFragment: string;\n    } | null;\n  } = {};\n  try {\n    bundle.stats = stats\n      ? JSON.parse(\n          readFileSync(stats.replace('/target', build ? `/${build}` : ''))\n        )\n      : null;\n  } catch (ex) {\n    // console.info(ex);\n    bundle.stats = null;\n  }\n  try {\n    bundle.templates = {\n      templateHTML: replaceStaticPath(\n        readFileSync(\n          templates.html.replace('/target', build ? `/${build}` : '')\n        ),\n        staticRoutePath\n      ),\n      templateHTMLStatic: replaceStaticPath(\n        readFileSync(\n          templates.static.replace('/target', build ? `/${build}` : '')\n        ),\n        staticRoutePath\n      ),\n      templateHTMLFragment: replaceStaticPath(\n        readFileSync(\n          templates.fragment.replace('/target', build ? `/${build}` : '')\n        ),\n        staticRoutePath\n      ),\n    };\n  } catch (ex) {\n    // console.info(ex);\n    bundle.templates = null;\n  }\n  return bundle;\n};\n\ntype LoadableChunkExtractors = {\n  legacy?: ChunkExtractor;\n  modern?: ChunkExtractor;\n  commonLoadableExtractor: ChunkExtractor;\n};\n\nexport const loadableChunkExtractors = () => {\n  const commonLoadableExtractor = new ChunkExtractor({ stats: {} });\n  try {\n    let modern: ChunkExtractor | undefined;\n    let legacy: ChunkExtractor | undefined;\n    try {\n      modern = new ChunkExtractor({\n        entrypoints: ['app'],\n        namespace: 'modern',\n        statsFile: path.resolve('dist/modern/loadable-stats.json'),\n      });\n    } catch (e) {\n      console.info('@loadable/server modern ChunkExtractor not available');\n    }\n    try {\n      legacy = new ChunkExtractor({\n        entrypoints: ['app'],\n        namespace: 'legacy',\n        statsFile: path.resolve('dist/legacy/loadable-stats.json'),\n      });\n    } catch (e) {\n      console.info('@loadable/server legacy ChunkExtractor not available');\n    }\n\n    (commonLoadableExtractor as any).addChunk = (chunk: any) => {\n      (modern as any)?.addChunk(chunk);\n      if (\n        typeof (legacy as any)?.stats.assetsByChunkName[chunk] !== 'undefined'\n      )\n        (legacy as any)?.addChunk(chunk);\n    };\n\n    return {\n      commonLoadableExtractor,\n      modern,\n      legacy,\n    } as LoadableChunkExtractors;\n  } catch (e) {\n    console.info('@loadable/server no ChunkExtractor available');\n    return { commonLoadableExtractor };\n  }\n};\n\nexport const getBundleData = (\n  config: ServerConfig,\n  staticRoutePath: string\n) => {\n  const bundleData = {\n    default: loadableBundleData(config, staticRoutePath),\n    legacy: loadableBundleData(config, staticRoutePath, 'legacy'),\n    modern: loadableBundleData(config, staticRoutePath, 'modern'),\n  };\n  if (!bundleData.default || Object.keys(bundleData.default || {}).length === 0)\n    bundleData.default = bundleData.legacy || bundleData.modern;\n  return bundleData;\n};\n\n// export const buildBundleTags = (\n//   bundles,\n//   differentialBundles = false,\n//   staticRoutePath = 'static',\n//   attributes = ''\n// ) => {\n//   // Take the bundles returned from Loadable.Capture\n//   const bundleTags = bundles\n//     .filter(b => b)\n//     .map(bundle => {\n//       if (bundle.publicPath.includes('/modern/'))\n//         return differentialBundles\n//           ? `<script ${attributes} type=\"module\" src=\"${replaceStaticPath(\n//               bundle.publicPath,\n//               staticRoutePath\n//             )}\"></script>`\n//           : null;\n//       return `<script ${attributes}${\n//         differentialBundles ? ' nomodule' : ''\n//       } src=\"${replaceStaticPath(\n//         bundle.publicPath,\n//         staticRoutePath\n//       )}\"></script>`;\n//     })\n//     .filter(f => f);\n\n//   return bundleTags;\n// };\n\nexport const getBundleTags = (\n  loadableExtractor: LoadableChunkExtractors,\n  scripts: ServerConfig['scripts'],\n  staticRoutePath = 'static'\n) => {\n  let startupTag = '';\n  // Add the static startup script to the bundleTags\n  if (scripts?.startup)\n    startupTag = `<script ${stringifyAttributes(\n      scripts.attributes\n    )} src=\"/${staticRoutePath}/${scripts.startup}\"></script>`;\n\n  // Get the script tags from their respective extractor instances\n  if (loadableExtractor) {\n    const legacyScriptTags = loadableExtractor.legacy?.getScriptTags({\n      nomodule: 'nomodule',\n    });\n    const modernScriptTags = loadableExtractor.modern?.getScriptTags({\n      type: 'module',\n    });\n    const scriptTags = `${startupTag}${legacyScriptTags || ''}${\n      modernScriptTags || ''\n    }`.replace(/\"\\/static\\//g, `\"/${staticRoutePath}/`);\n    return scriptTags;\n  }\n  return startupTag;\n};\n","import { Response } from 'express';\nimport {\n  selectCurrentProject,\n  selectRouteEntry,\n  selectSsrApiCalls,\n  selectSurrogateKeys,\n} from '~/routing/redux/selectors';\nimport { getImmutableOrJS as getIn } from '~/redux/util';\n\nimport {\n  anyUpdateHeader,\n  getCacheDuration,\n} from '../features/caching/cacheDuration.schema';\nimport { AppState } from '~/models';\n\nexport const addStandardHeaders = (\n  state: AppState,\n  response: Response,\n  packagejson: any,\n  groups: { globalGroups?: any[]; allowedGroups?: any[] }\n) => {\n  if (state) {\n    try {\n      const routingSurrogateKeys = selectSurrogateKeys(state);\n      const apiCalls = selectSsrApiCalls(state);\n      const anyApiError = !!apiCalls.find(([status]) => status >= 400);\n\n      // Check length of surrogate keys and prevent potential header overflow errors in prod\n      // Check for any error set in the page response\n      // And check if we have seen any error in any of the Delivery API calls\n      // - add `any-update` header that will indiscriminately\n      //   invalidate the SSR page cache when any content is updated\n      const addAnyUpdateHeader =\n        routingSurrogateKeys.length >= 2000 ||\n        response.statusCode >= 400 ||\n        anyApiError;\n\n      console.info(\n        `[addStandardHeaders] ${\n          addAnyUpdateHeader ? anyUpdateHeader : routingSurrogateKeys.length\n        } surrogate keys for ${response.req.url}`\n      );\n\n      const surrogateKeys = addAnyUpdateHeader\n        ? anyUpdateHeader\n        : routingSurrogateKeys.join(' ');\n\n      const surrogateKeyHeader = `${packagejson.name}-app ${surrogateKeys}`;\n\n      response.setHeader('surrogate-key', surrogateKeyHeader);\n\n      addVarnishAuthenticationHeaders(state, response, groups);\n\n      response.setHeader(\n        'surrogate-control',\n        `max-age=${getCacheDuration(response.statusCode)}`\n      );\n    } catch (e: any) {\n      console.info('[addStandardHeaders] Error adding headers', e.message);\n    }\n  }\n};\n\nexport const addVarnishAuthenticationHeaders = (\n  state: AppState,\n  response: Response,\n  groups: { globalGroups?: any[]; allowedGroups?: any[] } = {}\n) => {\n  if (state) {\n    try {\n      const stateEntry = selectRouteEntry(state);\n      const project = selectCurrentProject(state);\n      const { globalGroups, allowedGroups } = groups;\n      // console.info(globalGroups, allowedGroups);\n      let allGroups = Array.from((globalGroups && globalGroups[project]) || {});\n      if (\n        stateEntry &&\n        getIn(stateEntry, ['authentication', 'isLoginRequired']) &&\n        allowedGroups &&\n        allowedGroups[project]\n      ) {\n        allGroups = [...allGroups, ...allowedGroups[project]];\n      }\n      response.header('x-contensis-viewer-groups', allGroups.join('|'));\n    } catch (e) {\n      console.info('Error adding authentication header', e);\n    }\n  }\n};\n","import fs from 'fs';\n\nexport const getVersionInfo = (staticFolderPath: string) => {\n  try {\n    const versionData = fs.readFileSync(\n      `dist/${staticFolderPath}/version.json`,\n      'utf8'\n    );\n    const versionInfo = JSON.parse(versionData);\n    return versionInfo;\n  } catch (ex) {\n    console.error(`Unable to read from \"version.json\"`, ex);\n    return {};\n  }\n};\n","/* eslint-disable no-console */\nimport chalk from 'chalk';\n\n// Default exception types to add event listeners for\nconst handleDefaultEvents = ['uncaughtException', 'unhandledRejection'];\n\nexport const unhandledExceptionHandler = (\n  handleExceptions: boolean | string[] = handleDefaultEvents\n) => {\n  const exceptionTypes = Array.isArray(handleExceptions)\n    ? handleExceptions\n    : handleExceptions === false\n    ? []\n    : handleDefaultEvents;\n\n  for (const type of exceptionTypes) {\n    process.on(type, (err: Error) => {\n      if (err && err instanceof Error) {\n        // Print a message to inform admins and developers the error should not be ignored\n        console.log(\n          `${`[contensis-react-base] ‚ùå ${chalk.red.bold(\n            `${type} - ${err.message}`\n          )}`}`\n        );\n        console.log(\n          chalk.gray` - you are seeing this because we have tried to prevent the app from completely crashing - you should not ignore this problem`\n        );\n        // Log the error to server console\n        console.error(err);\n      }\n    });\n  }\n};\n","import React from 'react';\nimport { renderToString } from 'react-dom/server';\nimport { StaticRouter } from 'react-router-dom';\nimport { Provider as ReduxProvider } from 'react-redux';\nimport { matchRoutes } from 'react-router-config';\nimport { Helmet } from 'react-helmet';\nimport { ServerStyleSheet } from 'styled-components';\nimport serialize from 'serialize-javascript';\nimport minifyCssString from 'minify-css-string';\nimport mapJson from 'jsonpath-mapper';\nimport { Express, Request, Response } from 'express';\nimport { StaticRouterContext } from 'react-router';\nimport { ChunkExtractorManager } from '@loadable/server';\nimport { identity, noop } from 'lodash';\nimport cloneDeep from 'lodash/cloneDeep';\nimport { buildCleaner } from 'lodash-clean';\nimport { CookiesProvider } from 'react-cookie';\nimport Cookies from 'universal-cookie';\nimport cookiesMiddleware from 'universal-cookie-express';\n\nimport createStore from '~/redux/store/store';\nimport { history } from '~/redux/store/history';\nimport rootSaga from '~/redux/sagas';\n\nimport { setVersion, setVersionStatus } from '~/redux/actions/version';\nimport { setCurrentProject } from '~/routing/redux/actions';\nimport { selectCurrentSearch } from '~/routing/redux/selectors';\n\nimport { deliveryApi } from '~/util/ContensisDeliveryApi';\nimport pickProject from '~/util/pickProject';\nimport stringifyAttributes from './util/stringifyAttributes';\n\nimport { getCacheDuration } from './features/caching/cacheDuration.schema';\nimport handleResponse from './features/response-handler';\n\nimport {\n  getBundleData,\n  getBundleTags,\n  loadableChunkExtractors,\n} from './util/bundles';\nimport { addStandardHeaders } from './util/headers';\n\nimport { AppState, ServerConfig } from '~/models';\nimport { getVersionInfo } from './util/getVersionInfo';\nimport { unhandledExceptionHandler } from './util/handleExceptions';\nimport { SSRContextProvider } from '~/util/SSRContext';\n\nconst webApp = (\n  app: Express,\n  ReactApp: React.ComponentType<any>,\n  config: ServerConfig & {\n    allowedGroups?: string[];\n    globalGroups?: string[];\n    startupScriptFilename?: string;\n  }\n) => {\n  const {\n    stateType = 'immutable',\n    routes,\n    withReducers,\n    withSagas,\n    withEvents,\n    packagejson,\n    scripts = {},\n    staticFolderPath = 'static',\n    startupScriptFilename,\n    allowedGroups,\n    globalGroups,\n    disableSsrRedux,\n    enableSsrCookies,\n    handleResponses,\n    handleExceptions = true,\n  } = config;\n  const staticRoutePath = config.staticRoutePath || staticFolderPath;\n\n  const bundleData = getBundleData(config, staticRoutePath);\n\n  const attributes = stringifyAttributes(scripts.attributes);\n  scripts.startup = scripts.startup || startupScriptFilename;\n\n  const responseHandler =\n    typeof handleResponses === 'function' ? handleResponses : handleResponse;\n\n  if (handleExceptions !== false) unhandledExceptionHandler(handleExceptions); // Create `process.on` event handlers for unhandled exceptions (Node v15+)\n\n  const versionInfo = getVersionInfo(staticFolderPath);\n\n  app.get(\n    '/*',\n    cookiesMiddleware(),\n    async (\n      request: Request & {\n        universalCookies?: Cookies;\n      },\n      response: Response\n    ) => {\n      const url = encodeURI(request.url);\n\n      const matchedStaticRoute = () =>\n        matchRoutes(routes.StaticRoutes, request.path);\n      const isStaticRoute = () => matchedStaticRoute().length > 0;\n      const staticRoute = isStaticRoute() && matchedStaticRoute()[0];\n\n      // Allow certain routes to avoid SSR\n      const onlyDynamic = staticRoute && staticRoute.route.ssr === false;\n      const onlySSR = staticRoute && staticRoute.route.ssrOnly === true;\n\n      const normaliseQs = q => (q && q.toLowerCase() === 'true' ? true : false);\n\n      // Determine functional params from QueryString and set access methods\n      const accessMethod = mapJson<\n        any,\n        { DYNAMIC: boolean; REDUX: boolean; FRAGMENT: boolean; STATIC: boolean }\n      >(request.query, {\n        DYNAMIC: ({ dynamic }) => normaliseQs(dynamic) || onlyDynamic,\n        REDUX: ({ redux }) => normaliseQs(redux),\n        FRAGMENT: ({ fragment }) => normaliseQs(fragment),\n        STATIC: ({ static: value }) => normaliseQs(value) || onlySSR,\n      });\n\n      const context: StaticRouterContext = {};\n      // Track the current statusCode via the response object\n      response.status(200);\n\n      // Create a store (with a memory history) from our current url\n      const store = await createStore(\n        withReducers,\n        {} as AppState,\n        history({\n          initialEntries: [url],\n        }),\n        stateType\n      );\n\n      // dispatch any global and non-saga related actions before calling our JSX\n      const versionStatus = deliveryApi.getServerSideVersionStatus(request);\n\n      // In server-side blocks world, the hostname requested by the client resides in the x-orig-host header\n      // Because of this, we prioritize x-orig-host when setting our hostname\n      const hostname = (request.headers['x-orig-host'] ||\n        request.hostname) as string;\n\n      console.info(\n        `Request for ${request.path} hostname: ${hostname} versionStatus: ${versionStatus}`\n      );\n\n      store.dispatch(setVersionStatus(versionStatus));\n      store.dispatch(setVersion(versionInfo.commitRef, versionInfo.buildNo));\n\n      const project = pickProject(hostname, request.query);\n\n      const groups = allowedGroups && allowedGroups[project];\n      store.dispatch(setCurrentProject(project, groups, hostname));\n\n      const loadableExtractor = loadableChunkExtractors();\n\n      const ssrCookies = enableSsrCookies\n        ? // these cookies are managed by the cookiesMiddleware and contain listeners\n          // when cookies are read or written in ssr can be added to the `set-cookie` response header\n          request.universalCookies\n        : // this is a stub cookie collection so cookie methods can be used in code\n          new Cookies();\n\n      const jsx = (\n        <ChunkExtractorManager\n          extractor={loadableExtractor.commonLoadableExtractor}\n        >\n          <CookiesProvider cookies={ssrCookies}>\n            <ReduxProvider store={store}>\n              <StaticRouter context={context} location={url}>\n                <SSRContextProvider request={request} response={response}>\n                  <ReactApp routes={routes} withEvents={withEvents} />\n                </SSRContextProvider>\n              </StaticRouter>\n            </ReduxProvider>\n          </CookiesProvider>\n        </ChunkExtractorManager>\n      ) as React.ReactElement;\n\n      const {\n        templateHTML = '',\n        templateHTMLFragment = '',\n        templateHTMLStatic = '',\n      } = bundleData.default.templates || bundleData.legacy.templates || {};\n\n      // Serve a blank HTML page with client scripts to load the app in the browser\n      if (accessMethod.DYNAMIC) {\n        // Dynamic doesn't need sagas\n        renderToString(jsx);\n\n        // Dynamic page render has only the necessary bundles to start up the app\n        // and does not include any react-loadable code-split bundles\n        const bundleTags = getBundleTags(\n          loadableExtractor,\n          scripts,\n          staticRoutePath\n        );\n\n        const isDynamicHints = `<script ${attributes}>window.versionStatus = \"${versionStatus}\"; window.isDynamic = true;</script>`;\n\n        const responseHtmlDynamic = templateHTML\n          .replace('{{TITLE}}', '')\n          .replace('{{SEO_CRITICAL_METADATA}}', '')\n          .replace('{{CRITICAL_CSS}}', '')\n          .replace('{{APP}}', '')\n          .replace('{{LOADABLE_CHUNKS}}', bundleTags)\n          .replace('{{REDUX_DATA}}', isDynamicHints);\n        // Dynamic pages always return a 200 so we can run\n        // the app and serve up all errors inside the client\n        response.setHeader(\n          'Surrogate-Control',\n          `max-age=${getCacheDuration(200)}`\n        );\n        responseHandler(request, response, responseHtmlDynamic);\n      }\n\n      // Render the JSX server side and send response as per access method options\n      if (!accessMethod.DYNAMIC) {\n        store\n          .runSaga(rootSaga(withSagas))\n          .toPromise()\n          .then(() => {\n            const sheet = new ServerStyleSheet();\n\n            const html = renderToString(sheet.collectStyles(jsx) as React.ReactElement);\n\n            const helmet = Helmet.renderStatic();\n            Helmet.rewind();\n            const htmlAttributes = helmet.htmlAttributes.toString();\n            let title = helmet.title.toString();\n            const metadata = helmet.meta\n              .toString()\n              .concat(helmet.base.toString())\n              .concat(helmet.link.toString())\n              .concat(helmet.script.toString())\n              .concat(helmet.noscript.toString());\n\n            if (context.url) {\n              return response.redirect(context.statusCode || 302, context.url);\n            }\n\n            const reduxState = store.getState();\n\n            const styleTags = sheet.getStyleTags();\n\n            // After running rootSaga there should be an additional react-loadable\n            // code-split bundles for any page components as well as core app bundles\n            const bundleTags = getBundleTags(\n              loadableExtractor,\n              scripts,\n              staticRoutePath\n            );\n\n            let clonedState = buildCleaner({\n              isArray: identity,\n              isBoolean: identity,\n              isDate: identity,\n              isFunction: noop,\n              isNull: identity,\n              isPlainObject: identity,\n              isString: identity,\n              isUndefined: noop,\n            })(cloneDeep(reduxState));\n            // These keys are used for preparing server-side response headers only\n            // and are not required in the client at all except for debugging ssr\n            if (!selectCurrentSearch(reduxState)?.includes('includeApiCalls')) {\n              if (stateType === 'immutable')\n                clonedState = clonedState\n                  .deleteIn(['routing', 'apiCalls'])\n                  .deleteIn(['routing', 'surrogateKeys']);\n              else {\n                delete clonedState.routing.apiCalls;\n                delete clonedState.routing.surrogateKeys;\n              }\n            }\n            // Reset user state to prevent user details from being cached in SSR\n            if (stateType === 'immutable') {\n              clonedState = clonedState.delete('user');\n            } else delete clonedState.user;\n\n            let serialisedReduxData = serialize(clonedState);\n            if (context.statusCode !== 404) {\n              // For a request that returns a redux state object as a response\n              if (accessMethod.REDUX) {\n                addStandardHeaders(reduxState, response, packagejson, {\n                  allowedGroups,\n                  globalGroups,\n                });\n                responseHandler(request, response, serialisedReduxData, 'json');\n                return true;\n              }\n              if (!disableSsrRedux) {\n                // window.versionStatus is not strictly required here and is added to support cases\n                // where a consumer may not be using the contensisVersionStatus in redux and calling\n                // the `getClientSideVersionStatus()` method directly\n                serialisedReduxData = `<script ${attributes}>window.versionStatus = \"${versionStatus}\"; window.REDUX_DATA = ${serialisedReduxData}</script>`;\n              }\n            }\n            if ((context.statusCode || 200) >= 404) {\n              accessMethod.STATIC = true;\n            }\n\n            // Responses\n            let responseHTML = '';\n\n            if (context.statusCode === 404)\n              title = '<title>404 page not found</title>';\n\n            // Static page served as a fragment\n            if (accessMethod.FRAGMENT && accessMethod.STATIC) {\n              responseHTML = minifyCssString(styleTags) + html;\n            }\n\n            // Page fragment served with client scripts and redux data that hydrate the app client side\n            if (accessMethod.FRAGMENT && !accessMethod.STATIC) {\n              responseHTML = templateHTMLFragment\n                .replace('{{TITLE}}', title)\n                .replace('{{SEO_CRITICAL_METADATA}}', metadata)\n                .replace('{{CRITICAL_CSS}}', minifyCssString(styleTags))\n                .replace('{{APP}}', html)\n                .replace('{{LOADABLE_CHUNKS}}', bundleTags)\n                .replace('{{REDUX_DATA}}', serialisedReduxData);\n            }\n\n            // Full HTML page served statically\n            if (!accessMethod.FRAGMENT && accessMethod.STATIC) {\n              responseHTML = templateHTMLStatic\n                .replace('{{TITLE}}', title)\n                .replace('{{SEO_CRITICAL_METADATA}}', metadata)\n                .replace('{{CRITICAL_CSS}}', minifyCssString(styleTags))\n                .replace('{{APP}}', html)\n                .replace('{{LOADABLE_CHUNKS}}', '');\n            }\n\n            // Full HTML page served with client scripts and redux data that hydrate the app client side\n            if (!accessMethod.FRAGMENT && !accessMethod.STATIC) {\n              responseHTML = templateHTML\n                .replace('{{TITLE}}', title)\n                .replace('{{SEO_CRITICAL_METADATA}}', metadata)\n                .replace('{{CRITICAL_CSS}}', styleTags)\n                .replace('{{APP}}', html)\n                .replace('{{LOADABLE_CHUNKS}}', bundleTags)\n                .replace('{{REDUX_DATA}}', serialisedReduxData);\n            }\n\n            // Set response.status from React StaticRouter\n            if (typeof context.statusCode === 'number')\n              response.status(context.statusCode);\n\n            addStandardHeaders(reduxState, response, packagejson, {\n              allowedGroups,\n              globalGroups,\n            });\n            try {\n              // If react-helmet htmlAttributes are being used,\n              // replace the html tag with those attributes sepcified\n              // e.g. (lang, dir etc.)\n              if (htmlAttributes) {\n                responseHTML = responseHTML.replace(\n                  /<html?.+?>/,\n                  `<html ${htmlAttributes}>`\n                );\n              }\n              responseHandler(request, response, responseHTML);\n            } catch (err: any) {\n              console.info(err.message);\n            }\n          })\n          .catch(err => {\n            // Handle any error that occurred in any of the previous\n            // promises in the chain.\n            console.info(err);\n            response.status(500);\n            responseHandler(\n              request,\n              response,\n              `Error occurred: <br />${err.stack} <br />${JSON.stringify(err)}`\n            );\n          });\n        renderToString(jsx);\n\n        store.close();\n      }\n    }\n  );\n};\n\nexport default webApp;\n","import 'isomorphic-fetch';\nimport express, { Express } from 'express';\nimport http from 'http';\nimport React from 'react';\n\nimport ConfigureReverseProxies, {\n  deliveryProxy,\n} from './features/reverse-proxy';\nimport ServeStaticAssets from './features/static-assets';\nimport DisplayStartupConfiguration from './util/displayStartupConfiguration';\nimport ConfigureWebApp from './webApp';\n\nimport { ServerConfig } from '~/models';\n\ndeclare let global: typeof globalThis & {\n  DISABLE_SSR_REDUX: boolean | undefined;\n  PACKAGE_JSON: any;\n  PROXY_DELIVERY_API: boolean | undefined;\n  REVERSE_PROXY_PATHS: string[];\n};\n\nconst app = express();\n\nconst server = http.createServer(app);\n\nconst start = (\n  ReactApp: React.ComponentType<any>,\n  config: ServerConfig,\n  ServerFeatures: (app: Express) => void\n) => {\n  global.PACKAGE_JSON = config.packagejson;\n  global.DISABLE_SSR_REDUX = config.disableSsrRedux;\n  global.PROXY_DELIVERY_API = config.proxyDeliveryApi;\n  global.REVERSE_PROXY_PATHS = Object(config.reverseProxyPaths);\n\n  app.disable('x-powered-by');\n  // Output some information about the used build/startup configuration\n  DisplayStartupConfiguration(config);\n\n  ServerFeatures(app);\n  // Set-up local proxy for images from cms, and delivery api requests\n  // to save doing rewrites and extra code\n  ConfigureReverseProxies(app, config.reverseProxyPaths);\n  ServeStaticAssets(app, config);\n  ConfigureWebApp(app, ReactApp, config);\n\n  app.on('ready', async () => {\n    server.listen(3001, () => {\n      console.info(`HTTP server is listening @ port 3001`);\n      setTimeout(function () {\n        app.emit('app_started');\n      }, 500);\n    });\n    app.on('stop', () => {\n      server.close(function () {\n        console.info('GoodBye :(');\n        process.exit();\n      });\n    });\n  });\n};\n\ntype Exporting = {\n  app: Express;\n  apiProxy: typeof deliveryProxy;\n  server: http.Server;\n  start: (\n    ReactApp: React.ComponentType<any>,\n    config: ServerConfig,\n    ServerFeatures: (app: Express) => void\n  ) => void;\n};\n\nexport default { app, apiProxy: deliveryProxy, server, start } as Exporting;\n"],"names":["Util","GetIds","entries","fieldId","map","e","_e$fieldId","_e$fieldId2","Array","isArray","f","_f$sys","sys","id","flat","_e$sys","GetItems","result","GetResults","items","mergeResults","results","parentResults","replaceContentTypeIds","linkFieldId","r","some","c","contentTypeId","resolvedParent","find","_e$linkFieldId","l","_l$sys","entryTitle","entryDescription","originalSys","filter","searchQuery","assetTypes","contentTypeIds","customWhere","fields","filters","idFilters","sharedFilters","pageSize","pageIndex","orderBy","searchTerm","versionStatus","webpageTemplates","weightedSearchFields","expressions","exp","length","Op","or","query","Query","appendSearchQueryFilters","where","addRange","finalQuery","children","and","child","makeFilterExpressions","params","paramKey","filterConfig","Object","_params$paramKey","filterValues","split","push","key","values","fieldOperator","logicOperator","makeDerivedIdsFilterExpression","prevFieldId","ownIds","alwaysApplyFilter","previouslyDerivedIdsFilter","prevResultIds","resolveParentEntries","parentContentTypeIds","parentFieldId","debug","previousIdsFilter","JSON","parse","console","log","stringify","toJSON","substring","cachedSearch","searchUsingPost","Number","linkDepth","projectId","QueryLevelResults","constructor","level","linkFields","returnEntries","resolveFirstParent","parent","validatedLinks","firstQuery","firstResults","finalResults","AddChild","RunFirstQuery","runFirstQuery","fromEntries","vl","entryIds","join","linkFieldIds","RunFinalQuery","runFinalQuery","firstChild","_this$parent","_this$parent2","GetResultsEntries","_finalResults$items","totalCount","keys","fId","p","includes","term","LinkDepthSearchService","DoSearch","queryLevel","queryLevels","reverse","RunFinalQueries","finalQueryLevels","ql","_params$orderBy","derivedIds","derivedIdFilters","_l$parent","_ql$parent","_ql$parent2","entriesAtLevel","qc","reduce","accumulator","object","finalQueryResult","resolveParentLevels","resolveParents","_resolveParents$paren","_resolveParents$paren2","_this$queryLevels$fin","InitQueryLevels","createChildQueryLevels","parentQueryLevel","thisLevel","fKey","fVal","firstLevel","makeLinkDepthApi","app","middlewareConfig","uri","get","makeLinkDepthMiddleware","linkDepthMiddleware","req","res","setCachingHeaders","cacheControl","surrogateControl","k","v","toString","json","error","statusCode","errorMiddleware","servers","SERVERS","project","PROJECT","alias","ALIAS","deliveryApiHostname","url","api","assetProxy","httpProxy","createProxyServer","deliveryProxy","reverseProxies","reverseProxyPaths","deliveryApiProxy","all","target","hostname","indexOf","previewIis","iis","web","changeOrigin","on","path","apiProxy","CacheDuration","static","expressStatic","getCacheDuration","status","anyUpdateHeader","replaceStaticPath","str","staticFolderPath","replace","bundleManipulationMiddleware","appRootPath","maxage","staticRoutePath","next","filename","basename","encodeURI","modernBundle","endsWith","legacyBundle","startsWith","jsRuntimeLocation","resolve","jsRuntimeBundle","fs","readFileSync","modifiedBundle","set","type","send","readError","resolveStartupMiddleware","startupScriptFilename","startupFileLocation","startupFilePaths","startupFilePath","forEach","testPath","accessSync","ex","sendFile","sendFileError","staticAssets","appPath","scripts","staticRoutePaths","use","startup","express","maxAge","projects","PROJECTS","DisplayStartupConfiguration","config","attributes","value","idx","handleResponse","request","response","content","loadableBundleData","stats","templates","build","bundle","templateHTML","html","templateHTMLStatic","templateHTMLFragment","fragment","loadableChunkExtractors","commonLoadableExtractor","ChunkExtractor","modern","legacy","entrypoints","namespace","statsFile","info","addChunk","chunk","_modern","_legacy","_legacy2","assetsByChunkName","getBundleData","bundleData","default","getBundleTags","loadableExtractor","startupTag","stringifyAttributes","_loadableExtractor$le","_loadableExtractor$mo","legacyScriptTags","getScriptTags","nomodule","modernScriptTags","scriptTags","addStandardHeaders","state","packagejson","groups","routingSurrogateKeys","selectSurrogateKeys","apiCalls","selectSsrApiCalls","anyApiError","addAnyUpdateHeader","surrogateKeys","surrogateKeyHeader","name","setHeader","addVarnishAuthenticationHeaders","message","stateEntry","selectRouteEntry","selectCurrentProject","globalGroups","allowedGroups","allGroups","from","getIn","header","getVersionInfo","versionData","versionInfo","handleDefaultEvents","unhandledExceptionHandler","handleExceptions","exceptionTypes","process","err","Error","chalk","red","bold","gray","webApp","ReactApp","stateType","routes","withReducers","withSagas","withEvents","disableSsrRedux","enableSsrCookies","handleResponses","responseHandler","cookiesMiddleware","matchedStaticRoute","matchRoutes","StaticRoutes","isStaticRoute","staticRoute","onlyDynamic","route","ssr","onlySSR","ssrOnly","normaliseQs","q","toLowerCase","accessMethod","mapJson","DYNAMIC","dynamic","REDUX","redux","FRAGMENT","STATIC","context","store","createStore","history","initialEntries","deliveryApi","getServerSideVersionStatus","headers","dispatch","setVersionStatus","setVersion","commitRef","buildNo","pickProject","setCurrentProject","ssrCookies","universalCookies","Cookies","jsx","React","createElement","ChunkExtractorManager","extractor","CookiesProvider","cookies","ReduxProvider","StaticRouter","location","SSRContextProvider","renderToString","bundleTags","isDynamicHints","responseHtmlDynamic","runSaga","rootSaga","toPromise","then","_selectCurrentSearch","sheet","ServerStyleSheet","collectStyles","helmet","Helmet","renderStatic","rewind","htmlAttributes","title","metadata","meta","concat","base","link","script","noscript","redirect","reduxState","getState","styleTags","getStyleTags","clonedState","buildCleaner","identity","isBoolean","isDate","isFunction","noop","isNull","isPlainObject","isString","isUndefined","cloneDeep","selectCurrentSearch","deleteIn","routing","delete","user","serialisedReduxData","serialize","responseHTML","minifyCssString","catch","stack","close","server","http","createServer","start","ServerFeatures","global","PACKAGE_JSON","DISABLE_SSR_REDUX","PROXY_DELIVERY_API","proxyDeliveryApi","REVERSE_PROXY_PATHS","disable","ConfigureReverseProxies","ServeStaticAssets","ConfigureWebApp","listen","setTimeout","emit","exit"],"mappings":"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"}