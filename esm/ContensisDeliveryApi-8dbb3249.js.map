{"version":3,"file":"ContensisDeliveryApi-8dbb3249.js","sources":["../src/user/util/CookieConstants.ts","../src/util/LruCache.js","../src/util/CachedDeliveryApi.ts","../src/util/ContensisDeliveryApi.ts"],"sourcesContent":["export const LOGIN_COOKIE = 'ContensisCMSUserName';\nexport const REFRESH_TOKEN_COOKIE = 'RefreshToken';\n\nexport type CookieObject = { [name: string]: any };\n\nexport const findLoginCookies = (cookies: CookieObject | string) =>\n  typeof cookies === 'object'\n    ? Object.fromEntries(\n        Object.entries(cookies).filter(([name]) =>\n          [LOGIN_COOKIE, REFRESH_TOKEN_COOKIE].includes(name)\n        )\n      )\n    : cookies;\n","class CacheNode {\n  constructor(key, value) {\n    this.key = key;\n    this.value = value;\n    this.next = null;\n    this.prev = null;\n  }\n}\n\nexport class LruCache {\n  constructor(limit = 100) {\n    this.map = {};\n    this.head = null;\n    this.tail = null;\n    this.limit = limit || 100;\n    this.size = 0;\n  }\n\n  get(key) {\n    if (this.map[key]) {\n      let value = this.map[key].value;\n      let node = new CacheNode(key, value);\n      this.remove(key);\n      this.setHead(node);\n      return value;\n    }\n  }\n\n  set(key, value) {\n    let node = new CacheNode(key, value);\n    if (this.map[key]) {\n      this.remove(key);\n    } else {\n      if (this.size >= this.limit) {\n        delete this.map[this.tail.key];\n        this.size--;\n        this.tail = this.tail.prev;\n        this.tail.next = null;\n      }\n    }\n    this.setHead(node);\n  }\n\n  setHead(node) {\n    node.next = this.head;\n    node.prev = null;\n    if (this.head) {\n      this.head.prev = node;\n    }\n    this.head = node;\n    if (!this.tail) {\n      this.tail = node;\n    }\n    this.size++;\n    this.map[node.key] = node;\n  }\n\n  remove(key) {\n    let node = this.map[key];\n    if (!node) return; // This is sometimes null and crashes the container without this check\n\n    if (node.prev) {\n      node.prev.next = node.next;\n    } else {\n      this.head = node.next;\n    }\n    if (node.next) {\n      node.next.prev = node.prev;\n    } else {\n      this.tail = node.prev;\n    }\n    delete this.map[key];\n    this.size--;\n  }\n}\n","import { VersionStatus } from 'contensis-core-api';\nimport { Client, Query } from 'contensis-delivery-api';\nimport {\n  INodeOperations,\n  NodeGetRootOptions,\n} from 'contensis-delivery-api/lib/models';\n\nimport { DeliveryApi, getClientConfig } from './ContensisDeliveryApi';\nimport { LruCache } from './LruCache';\nimport { CookieObject } from '~/user/util/CookieConstants';\n\n// CachedSearch does not cache results in SSR by design\nclass CachedSearch {\n  cache = new LruCache();\n  cookies?: CookieObject;\n\n  constructor(cookies?: CookieObject) {\n    this.cookies = cookies;\n  }\n\n  getClient(...args: Parameters<DeliveryApi['getClient']>) {\n    return new DeliveryApi(this.cookies).getClient(...args);\n  }\n\n  search(query: Query, linkDepth = 0, project?: string) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(\n      `${project}+${JSON.stringify(query)}+${linkDepth}`,\n      () => client.entries.search(query, linkDepth)\n    );\n  }\n\n  searchUsingPost(query: Query, linkDepth = 0, project = '') {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(\n      `${project}+${JSON.stringify(query)}+${linkDepth}`,\n      () => (client.entries as any).searchUsingPost(query, linkDepth)\n    );\n  }\n\n  get(\n    id: string,\n    linkDepth = 0,\n    versionStatus: VersionStatus = 'published',\n    project?: string\n  ) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    client.clientConfig.versionStatus = versionStatus;\n    return this.request(id, () => client.entries.get({ id, linkDepth }));\n  }\n\n  getContentType(id: string, project?: string) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(`[CONTENT TYPE] ${id} ${project}`, () =>\n      client.contentTypes.get(id)\n    );\n  }\n\n  getRootNode(options: NodeGetRootOptions, project?: string) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(`${project} / ${JSON.stringify(options)}`, () =>\n      client.nodes.getRoot(options)\n    );\n  }\n\n  getNode(options: Parameters<INodeOperations['get']>[0], project?: string) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(\n      `${project} ${\n        options && typeof options !== 'string'\n          ? 'path' in options\n            ? options.path\n            : options.id\n          : options\n      } ${JSON.stringify(options)}`,\n      () => client.nodes.get(options)\n    );\n  }\n\n  getAncestors(\n    options: Parameters<INodeOperations['getAncestors']>[0],\n    project?: string\n  ) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(\n      `${project} [A] ${\n        (options && typeof options !== 'string' && options.id) || options\n      } ${JSON.stringify(options)}`,\n      () => client.nodes.getAncestors(options)\n    );\n  }\n\n  getChildren(\n    options: Parameters<INodeOperations['getChildren']>[0],\n    project?: string\n  ) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(\n      `${project} [C] ${\n        (options && typeof options !== 'string' && options.id) || options\n      } ${JSON.stringify(options)}`,\n      () => client.nodes.getChildren(options)\n    );\n  }\n\n  getSiblings(\n    options: Parameters<INodeOperations['getSiblings']>[0],\n    project?: string\n  ) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(\n      `${project} [S] ${\n        (options && typeof options !== 'string' && options.id) || options\n      } ${JSON.stringify(options)}`,\n      () => client.nodes.getSiblings(options)\n    );\n  }\n\n  request<T extends () => Promise<any>>(key: string, execute: T) {\n    // do not cache results in SSR\n    if (!this.cache.get(key) || typeof window == 'undefined') {\n      const promise = execute();\n      this.cache.set(key, promise);\n      promise.catch(() => {\n        this.cache.remove(key);\n      });\n    }\n    return this.cache.get(key) as ReturnType<T>;\n  }\n}\n\nexport const cachedSearch = new CachedSearch();\nexport const cachedSearchWithCookies = (cookies?: CookieObject) =>\n  new CachedSearch(cookies);\n","import { VersionStatus } from 'contensis-core-api';\nimport { Client, Query } from 'contensis-delivery-api';\nimport { Config } from 'contensis-delivery-api/lib/models';\nimport { parse } from 'query-string';\nimport { setSurrogateKeys } from '~/routing/redux/actions';\nimport { reduxStore } from '~/redux/store/store';\nimport {\n  selectCurrentHostname,\n  selectCurrentPath,\n  selectCurrentSearch,\n} from '~/routing/redux/selectors';\nimport { CookieObject, findLoginCookies } from '~/user/util/CookieConstants';\nimport { Request } from 'express';\nimport { IncomingHttpHeaders } from 'http';\n\nconst mapCookieHeader = (cookies: CookieObject | string) =>\n  typeof cookies === 'object'\n    ? Object.entries(cookies)\n        .map(([name, value]) => `${name}=${value}`)\n        .join('; ')\n    : cookies;\n\nconst getSsrReferer = () => {\n  if (typeof window === 'undefined') {\n    const state = reduxStore.getState();\n    const referer = `${selectCurrentHostname(state)}${selectCurrentPath(\n      state\n    )}${selectCurrentSearch(state)}`;\n\n    return referer;\n  }\n  return '';\n};\n\nconst storeSurrogateKeys = (response: any) => {\n  const keys = response.headers.get\n    ? response.headers.get('surrogate-key')\n    : response.headers.map['surrogate-key'];\n  if (keys) reduxStore?.dispatch(setSurrogateKeys(keys, response.url));\n};\n\nexport const getClientConfig = (project?: string, cookies?: CookieObject) => {\n  const config: Config = DELIVERY_API_CONFIG; /* global DELIVERY_API_CONFIG */\n  config.responseHandler = {};\n\n  if (project) {\n    config.projectId = project;\n  }\n\n  // we only want the surrogate key header in a server context\n  if (typeof window === 'undefined') {\n    config.defaultHeaders = Object.assign(config.defaultHeaders || {}, {\n      referer: getSsrReferer(),\n      'x-require-surrogate-key': true,\n      'x-crb-ssr': true, // add this for support tracing\n    });\n    config.responseHandler[200] = storeSurrogateKeys;\n  }\n\n  if (\n    typeof window !== 'undefined' &&\n    PROXY_DELIVERY_API /* global PROXY_DELIVERY_API */\n  ) {\n    // ensure a relative url is used to bypass the need for CORS (separate OPTIONS calls)\n    config.rootUrl = '';\n    config.responseHandler[404] = () => null;\n  }\n\n  if (cookies) {\n    const cookieHeader = mapCookieHeader(findLoginCookies(cookies));\n    if (cookieHeader) {\n      config.defaultHeaders = Object.assign(config.defaultHeaders || {}, {\n        Cookie: cookieHeader,\n      });\n    }\n  }\n\n  return config;\n};\n\n// export * from 'contensis-delivery-api';\n\ndeclare let window: Window &\n  typeof globalThis & {\n    versionStatus?: VersionStatus;\n  };\n\nexport class DeliveryApi {\n  cookies?: CookieObject;\n\n  constructor(cookies?: CookieObject) {\n    this.cookies = cookies;\n  }\n\n  getClientSideVersionStatus = () => {\n    if (typeof window !== 'undefined') {\n      // Allow overriding versionStatus with the querystring\n      const { versionStatus } = parse(window.location.search);\n      if (versionStatus) return versionStatus;\n      // Client-side we will have a global variable set if rendered by SSR in production\n      if (typeof window.versionStatus !== 'undefined')\n        return window.versionStatus;\n      // For localhost development we can only work out versionStatus from the current hostname\n      const currentHostname = window.location.hostname;\n      return this.getVersionStatusFromHostname(currentHostname);\n    }\n    return null;\n  };\n\n  getServerSideVersionStatus = (request: Request) =>\n    request.query.versionStatus ||\n    deliveryApi.getVersionStatusFromHeaders(request.headers) ||\n    deliveryApi.getVersionStatusFromHostname(request.hostname);\n\n  getVersionStatusFromHeaders = (headers: IncomingHttpHeaders) => {\n    const versionStatusHeader = headers['x-entry-versionstatus'];\n    if (typeof versionStatusHeader !== 'undefined') return versionStatusHeader;\n    return null;\n  };\n\n  getVersionStatusFromHostname = (currentHostname: string) => {\n    if (currentHostname.indexOf('localhost') > -1) return 'latest';\n\n    if (currentHostname.endsWith('contensis.cloud')) {\n      if (currentHostname.indexOf('preview.') > -1) {\n        return 'latest';\n      } else {\n        return 'published';\n      }\n    }\n\n    if (currentHostname.endsWith('cloud.contensis.com')) {\n      if (currentHostname.indexOf('preview-') > -1) {\n        return 'latest';\n      } else {\n        return 'published';\n      }\n    }\n\n    return 'published';\n  };\n\n  search = (query: Query, linkDepth = 0, project?: string) => {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return client.entries.search(\n      query,\n      typeof linkDepth !== 'undefined' ? linkDepth : 1\n    );\n  };\n\n  getClient = (versionStatus: VersionStatus = 'published', project) => {\n    const baseConfig = getClientConfig(project, this.cookies);\n    baseConfig.versionStatus = versionStatus;\n    return Client.create(baseConfig);\n  };\n\n  getEntry = (\n    id: string,\n    linkDepth = 0,\n    versionStatus: VersionStatus = 'published',\n    project?: string\n  ) => {\n    const baseConfig = getClientConfig(project, this.cookies);\n    baseConfig.versionStatus = versionStatus;\n    const client = Client.create(baseConfig);\n    // return client.entries.get(id, linkDepth);\n    return client.entries.get({ id, linkDepth });\n  };\n}\n\nexport const deliveryApi = new DeliveryApi();\n\nexport const deliveryApiWithCookies = (cookies?: CookieObject) =>\n  new DeliveryApi(cookies);\n\nexport * from './CachedDeliveryApi';\n"],"names":["LOGIN_COOKIE","REFRESH_TOKEN_COOKIE","findLoginCookies","cookies","Object","fromEntries","entries","filter","name","includes","CacheNode","constructor","key","value","next","prev","LruCache","limit","map","head","tail","size","get","node","remove","setHead","set","CachedSearch","cache","getClient","args","DeliveryApi","search","query","linkDepth","project","client","Client","create","getClientConfig","request","JSON","stringify","searchUsingPost","id","versionStatus","clientConfig","getContentType","contentTypes","getRootNode","options","nodes","getRoot","getNode","path","getAncestors","getChildren","getSiblings","execute","window","promise","catch","cachedSearch","mapCookieHeader","join","getSsrReferer","state","reduxStore","getState","referer","selectCurrentHostname","selectCurrentPath","selectCurrentSearch","storeSurrogateKeys","response","keys","headers","dispatch","setSurrogateKeys","url","config","DELIVERY_API_CONFIG","responseHandler","projectId","defaultHeaders","assign","PROXY_DELIVERY_API","rootUrl","cookieHeader","Cookie","getClientSideVersionStatus","parse","location","currentHostname","hostname","getVersionStatusFromHostname","getServerSideVersionStatus","deliveryApi","getVersionStatusFromHeaders","versionStatusHeader","indexOf","endsWith","baseConfig","getEntry"],"mappings":"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"}