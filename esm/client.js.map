{"version":3,"file":"client.js","sources":["../src/client/client.tsx"],"sourcesContent":["import 'isomorphic-fetch';\nimport React from 'react';\nimport { render, hydrate } from 'react-dom';\nimport { AppContainer } from 'react-hot-loader';\nimport { Provider as ReduxProvider } from 'react-redux';\nimport { Router } from 'react-router-dom';\nimport { loadableReady } from '@loadable/component';\nimport * as queryString from 'query-string';\nimport { CookiesProvider } from 'react-cookie';\n\nimport { setVersionStatus } from '~/redux/actions/version';\nimport rootSaga from '~/redux/sagas';\nimport { browserHistory as history } from '~/redux/store/history';\nimport createStore from '~/redux/store/store';\n\nimport { setCurrentProject } from '~/routing/redux/actions';\n\nimport { deliveryApi } from '~/util/ContensisDeliveryApi';\nimport pickProject from '~/util/pickProject';\n\nimport { AppConfig } from '~/config';\n\ndeclare let window: typeof globalThis & {\n  isDynamic;\n  REDUX_DATA;\n};\n\ntype ReactAppProps = { routes: any; withEvents: any };\n\nclass ClientApp {\n  constructor(ReactApp: React.ComponentType<ReactAppProps>, config: AppConfig) {\n    const documentRoot = document.getElementById('root');\n\n    const {\n      stateType = 'immutable',\n      routes,\n      withReducers,\n      withSagas,\n      withEvents,\n    } = config;\n\n    const GetClientJSX = store => {\n      const ClientJsx = (\n        <AppContainer>\n          <CookiesProvider>\n            <ReduxProvider store={store}>\n              <Router history={history}>\n                <ReactApp routes={routes} withEvents={withEvents} />\n              </Router>\n            </ReduxProvider>\n          </CookiesProvider>\n        </AppContainer>\n      );\n      return ClientJsx;\n    };\n\n    const isProduction = !(process.env.NODE_ENV !== 'production');\n\n    /**\n     * Webpack HMR Setup.\n     */\n    const HMRRenderer = Component => {\n      if (isProduction)\n        loadableReady(\n          () => {\n            hydrate(Component, documentRoot);\n          },\n          { namespace: 'modern' }\n        );\n      else render(Component, documentRoot);\n    };\n\n    const hmr = store => {\n      // webpack Hot Module Replacement API\n      if (module.hot) {\n        module.hot.accept(ReactApp as unknown as string, () => {\n          // if you are using harmony modules ({modules:false})\n          HMRRenderer(GetClientJSX(store));\n        });\n      }\n    };\n\n    const qs = queryString.parse(window.location.search);\n    const versionStatusFromHostname = deliveryApi.getClientSideVersionStatus();\n\n    if (\n      window.isDynamic ||\n      window.REDUX_DATA ||\n      process.env.NODE_ENV !== 'production'\n    ) {\n      createStore(withReducers, window.REDUX_DATA, history, stateType).then(\n        store => {\n          store.dispatch(\n            setVersionStatus(qs.versionStatus || versionStatusFromHostname)\n          );\n\n          /* eslint-disable no-console */\n          console.log('Hydrating from inline Redux');\n          /* eslint-enable no-console */\n          store.runSaga(rootSaga(withSagas));\n          store.dispatch(\n            setCurrentProject(\n              pickProject(window.location.hostname, qs),\n              [],\n              window.location.hostname\n            )\n          );\n\n          delete window.REDUX_DATA;\n          HMRRenderer(GetClientJSX(store));\n\n          hmr(store);\n        }\n      );\n    } else {\n      fetch(`${window.location.pathname}?redux=true`)\n        .then(response => response.json())\n        .then(data => {\n          const ssRedux = JSON.parse(data);\n          createStore(withReducers, ssRedux, history, stateType).then(store => {\n            store.dispatch(\n              setVersionStatus(qs.versionStatus || versionStatusFromHostname)\n            );\n\n            store.runSaga(rootSaga(withSagas));\n            store.dispatch(\n              setCurrentProject(\n                pickProject(\n                  window.location.hostname,\n                  queryString.parse(window.location.search)\n                ),\n                [],\n                window.location.hostname\n              )\n            );\n\n            HMRRenderer(GetClientJSX(store));\n\n            hmr(store);\n          });\n        });\n    }\n  }\n}\n\nexport default ClientApp;\n"],"names":["ClientApp","constructor","ReactApp","config","documentRoot","document","getElementById","stateType","routes","withReducers","withSagas","withEvents","GetClientJSX","store","ClientJsx","ReduxProvider","history","isProduction","process","env","NODE_ENV","HMRRenderer","Component","loadableReady","hydrate","namespace","render","hmr","module","hot","accept","qs","queryString","parse","window","location","search","versionStatusFromHostname","deliveryApi","getClientSideVersionStatus","isDynamic","REDUX_DATA","createStore","then","dispatch","setVersionStatus","versionStatus","console","log","runSaga","rootSaga","setCurrentProject","pickProject","hostname","fetch","pathname","response","json","data","ssRedux","JSON"],"mappings":"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"}