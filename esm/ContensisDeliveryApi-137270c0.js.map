{"version":3,"file":"ContensisDeliveryApi-137270c0.js","sources":["../src/util/ContensisDeliveryApi.js"],"sourcesContent":["import { Client } from 'contensis-delivery-api';\nimport { parse } from 'query-string';\nimport { setSurrogateKeys } from '../routing/redux/actions';\nimport { reduxStore } from '~/redux/store/store';\nimport { findLoginCookies } from '~/user/util/CookieConstants';\nimport { mapCookieHeader } from '~/user/util/CookieHelper.class';\n\nconst storeSurrogateKeys = response => {\n  const keys = response.headers.get\n    ? response.headers.get('surrogate-key')\n    : response.headers.map['surrogate-key'];\n  if (keys) reduxStore?.dispatch(setSurrogateKeys(keys, response.url));\n};\n\nexport const getClientConfig = (project, cookies) => {\n  let config = DELIVERY_API_CONFIG; /* global DELIVERY_API_CONFIG */\n  config.responseHandler = {};\n\n  if (project) {\n    config.projectId = project;\n  }\n\n  // we only want the surrogate key header in a server context\n  if (typeof window === 'undefined') {\n    config.defaultHeaders = Object.assign(config.defaultHeaders || {}, {\n      'x-require-surrogate-key': true,\n    });\n    config.responseHandler[200] = storeSurrogateKeys;\n  }\n\n  if (\n    typeof window !== 'undefined' &&\n    PROXY_DELIVERY_API /* global PROXY_DELIVERY_API */\n  ) {\n    // ensure a relative url is used to bypass the need for CORS (separate OPTIONS calls)\n    config.rootUrl = '';\n    config.responseHandler[404] = () => null;\n  }\n\n  if (cookies) {\n    const cookieHeader = mapCookieHeader(findLoginCookies(cookies));\n    if (cookieHeader) {\n      config.defaultHeaders = Object.assign(config.defaultHeaders || {}, {\n        Cookie: cookieHeader,\n      });\n      console.info(\n        `config.defaultHeaders: ${JSON.stringify(config.defaultHeaders)}`\n      );\n    }\n  }\n\n  return config;\n};\n\nexport * from 'contensis-delivery-api';\n\nclass DeliveryApi {\n  cookies;\n  constructor(cookies) {\n    this.cookies = cookies;\n  }\n\n  getClientSideVersionStatus = () => {\n    if (typeof window !== 'undefined') {\n      // Allow overriding versionStatus with the querystring\n      const { versionStatus } = parse(window.location.search);\n      if (versionStatus) return versionStatus;\n      // Client-side we will have a global variable set if rendered by SSR in production\n      if (typeof window.versionStatus !== 'undefined')\n        return window.versionStatus;\n      // For localhost development we can only work out versionStatus from the current hostname\n      const currentHostname = window.location.hostname;\n      return this.getVersionStatusFromHostname(currentHostname);\n    }\n    return null;\n  };\n  getServerSideVersionStatus = request =>\n    request.query.versionStatus ||\n    deliveryApi.getVersionStatusFromHeaders(request.headers) ||\n    deliveryApi.getVersionStatusFromHostname(request.hostname);\n  getVersionStatusFromHeaders = headers => {\n    const versionStatusHeader = headers['x-entry-versionstatus'];\n    if (typeof versionStatusHeader !== 'undefined') return versionStatusHeader;\n    return null;\n  };\n  getVersionStatusFromHostname = currentHostname => {\n    if (currentHostname.indexOf('localhost') > -1) return 'latest';\n\n    if (currentHostname.endsWith('contensis.cloud')) {\n      if (currentHostname.indexOf('preview.') > -1) {\n        return 'latest';\n      } else {\n        return 'published';\n      }\n    }\n\n    if (currentHostname.endsWith('cloud.contensis.com')) {\n      if (currentHostname.indexOf('preview-') > -1) {\n        return 'latest';\n      } else {\n        return 'published';\n      }\n    }\n\n    return 'published';\n  };\n  search = (query, linkDepth, project) => {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return client.entries.search(\n      query,\n      typeof linkDepth !== 'undefined' ? linkDepth : 1\n    );\n  };\n  getClient = (deliveryApiStatus = 'published', project) => {\n    const baseConfig = getClientConfig(project, this.cookies);\n    baseConfig.versionStatus = deliveryApiStatus;\n    return Client.create(baseConfig);\n  };\n  getEntry = (id, linkDepth = 0, deliveryApiStatus = 'published', project) => {\n    const baseConfig = getClientConfig(project, this.cookies);\n    baseConfig.versionStatus = deliveryApiStatus;\n    const client = Client.create(baseConfig);\n    // return client.entries.get(id, linkDepth);\n    return client.entries.get({ id, linkDepth });\n  };\n}\n\nexport const deliveryApi = new DeliveryApi();\nexport const deliveryApiWithCookies = cookies => new DeliveryApi(cookies);\n\nclass CacheNode {\n  constructor(key, value) {\n    this.key = key;\n    this.value = value;\n    this.next = null;\n    this.prev = null;\n  }\n}\n\nclass LruCache {\n  constructor(limit = 100) {\n    this.map = {};\n    this.head = null;\n    this.tail = null;\n    this.limit = limit || 100;\n    this.size = 0;\n  }\n\n  get(key) {\n    if (this.map[key]) {\n      let value = this.map[key].value;\n      let node = new CacheNode(key, value);\n      this.remove(key);\n      this.setHead(node);\n      return value;\n    }\n  }\n\n  set(key, value) {\n    let node = new CacheNode(key, value);\n    if (this.map[key]) {\n      this.remove(key);\n    } else {\n      if (this.size >= this.limit) {\n        delete this.map[this.tail.key];\n        this.size--;\n        this.tail = this.tail.prev;\n        this.tail.next = null;\n      }\n    }\n    this.setHead(node);\n  }\n\n  setHead(node) {\n    node.next = this.head;\n    node.prev = null;\n    if (this.head) {\n      this.head.prev = node;\n    }\n    this.head = node;\n    if (!this.tail) {\n      this.tail = node;\n    }\n    this.size++;\n    this.map[node.key] = node;\n  }\n\n  remove(key) {\n    let node = this.map[key];\n    if (!node) return; // This is sometimes null and crashes the container without this check\n\n    if (node.prev) {\n      node.prev.next = node.next;\n    } else {\n      this.head = node.next;\n    }\n    if (node.next) {\n      node.next.prev = node.prev;\n    } else {\n      this.tail = node.prev;\n    }\n    delete this.map[key];\n    this.size--;\n  }\n}\n\n// CachedSearch does not cache results in SSR by design\nclass CachedSearch {\n  cache = new LruCache();\n  cookies;\n  taxonomyLookup = {};\n\n  constructor(cookies) {\n    this.cookies = cookies;\n  }\n\n  getClient = new DeliveryApi(this.cookies).getClient;\n\n  search(query, linkDepth, project) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(\n      project + JSON.stringify(query) + linkDepth.toString(),\n      () => client.entries.search(query, linkDepth)\n    );\n  }\n\n  searchUsingPost(query, linkDepth = 0, project = '') {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(\n      project + JSON.stringify(query) + linkDepth.toString(),\n      () => client.entries.searchUsingPost(query, linkDepth)\n    );\n  }\n\n  get(id, linkDepth, versionStatus, project) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    client.clientConfig.versionStatus = versionStatus;\n    return this.request(id, () => client.entries.get({ id, linkDepth }));\n  }\n\n  getContentType(id, project) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(`[CONTENT TYPE] ${id} ${project}`, () =>\n      client.contentTypes.get(id)\n    );\n  }\n\n  getTaxonomyNode(key, project) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(`[TAXONOMY NODE] ${key}`, () =>\n      client.taxonomy\n        .resolveChildren(key)\n        .then(node => this.extendTaxonomyNode(node))\n    );\n  }\n\n  getRootNode(options, project) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(`${project} / ${JSON.stringify(options)}`, () =>\n      client.nodes.getRoot(options)\n    );\n  }\n\n  getNode(options, project) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(\n      `${project} ${(options && options.path) || options} ${JSON.stringify(\n        options\n      )}`,\n      () => client.nodes.get(options)\n    );\n  }\n\n  getAncestors(options, project) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(\n      `${project} [A] ${(options && options.id) || options} ${JSON.stringify(\n        options\n      )}`,\n      () => client.nodes.getAncestors(options)\n    );\n  }\n\n  getChildren(options, project) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(\n      `${project} [C] ${(options && options.id) || options} ${JSON.stringify(\n        options\n      )}`,\n      () => client.nodes.getChildren(options)\n    );\n  }\n\n  getSiblings(options, project) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(\n      `${project} [S] ${(options && options.id) || options} ${JSON.stringify(\n        options\n      )}`,\n      () => client.nodes.getSiblings(options)\n    );\n  }\n\n  request(key, execute) {\n    // do not cache results in SSR\n    if (!this.cache.get(key) || typeof window == 'undefined') {\n      let promise = execute();\n      this.cache.set(key, promise);\n      promise.catch(() => {\n        this.cache.remove(key);\n      });\n    }\n    return this.cache.get(key);\n  }\n}\n\nexport const cachedSearch = new CachedSearch();\nexport const cachedSearchWithCookies = cookies => new CachedSearch(cookies);\n"],"names":["storeSurrogateKeys","response","keys","headers","get","map","reduxStore","dispatch","setSurrogateKeys","url","getClientConfig","project","cookies","config","DELIVERY_API_CONFIG","responseHandler","projectId","window","defaultHeaders","Object","assign","PROXY_DELIVERY_API","rootUrl","cookieHeader","mapCookieHeader","findLoginCookies","Cookie","console","info","JSON","stringify","DeliveryApi","constructor","getClientSideVersionStatus","versionStatus","parse","location","search","currentHostname","hostname","getVersionStatusFromHostname","getServerSideVersionStatus","request","query","deliveryApi","getVersionStatusFromHeaders","versionStatusHeader","indexOf","endsWith","linkDepth","client","Client","create","entries","getClient","deliveryApiStatus","baseConfig","getEntry","id","deliveryApiWithCookies","CacheNode","key","value","next","prev","LruCache","limit","head","tail","size","node","remove","setHead","set","CachedSearch","cache","taxonomyLookup","toString","searchUsingPost","clientConfig","getContentType","contentTypes","getTaxonomyNode","taxonomy","resolveChildren","then","extendTaxonomyNode","getRootNode","options","nodes","getRoot","getNode","path","getAncestors","getChildren","getSiblings","execute","promise","catch","cachedSearch","cachedSearchWithCookies"],"mappings":"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"}