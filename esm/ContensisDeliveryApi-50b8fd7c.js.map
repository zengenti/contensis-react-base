{"version":3,"file":"ContensisDeliveryApi-50b8fd7c.js","sources":["../src/util/ContensisDeliveryApi.js"],"sourcesContent":["import { Client } from 'contensis-delivery-api';\nimport { parse } from 'query-string';\nimport { setSurrogateKeys } from '../routing/redux/actions';\nimport { reduxStore } from '~/redux/store/store';\nimport {\n  selectCurrentHostname,\n  selectCurrentPath,\n  selectCurrentSearch,\n} from '~/routing/redux/selectors';\nimport { findLoginCookies } from '~/user/util/CookieConstants';\nimport { mapCookieHeader } from '~/user/util/CookieHelper.class';\n\nconst getSsrReferer = () => {\n  if (typeof window === 'undefined') {\n    const state = reduxStore.getState();\n    const referer = `${selectCurrentHostname(state)}${selectCurrentPath(\n      state\n    )}${selectCurrentSearch(state)}`;\n\n    return referer;\n  }\n  return '';\n};\n\nconst storeSurrogateKeys = response => {\n  const keys = response.headers.get\n    ? response.headers.get('surrogate-key')\n    : response.headers.map['surrogate-key'];\n  if (keys) reduxStore?.dispatch(setSurrogateKeys(keys, response.url));\n};\n\nexport const getClientConfig = (project, cookies) => {\n  let config = DELIVERY_API_CONFIG; /* global DELIVERY_API_CONFIG */\n  config.responseHandler = {};\n\n  if (project) {\n    config.projectId = project;\n  }\n\n  // we only want the surrogate key header in a server context\n  if (typeof window === 'undefined') {\n    config.defaultHeaders = Object.assign(config.defaultHeaders || {}, {\n      referer: getSsrReferer(),\n      'x-require-surrogate-key': true,\n      'x-crb-ssr': true, // add this for support tracing\n    });\n    config.responseHandler[200] = storeSurrogateKeys;\n  }\n\n  if (\n    typeof window !== 'undefined' &&\n    PROXY_DELIVERY_API /* global PROXY_DELIVERY_API */\n  ) {\n    // ensure a relative url is used to bypass the need for CORS (separate OPTIONS calls)\n    config.rootUrl = '';\n    config.responseHandler[404] = () => null;\n  }\n\n  if (cookies) {\n    const cookieHeader = mapCookieHeader(findLoginCookies(cookies));\n    if (cookieHeader) {\n      config.defaultHeaders = Object.assign(config.defaultHeaders || {}, {\n        Cookie: cookieHeader,\n      });\n    }\n  }\n\n  return config;\n};\n\nexport * from 'contensis-delivery-api';\n\nclass DeliveryApi {\n  cookies;\n  constructor(cookies) {\n    this.cookies = cookies;\n  }\n\n  getClientSideVersionStatus = () => {\n    if (typeof window !== 'undefined') {\n      // Allow overriding versionStatus with the querystring\n      const { versionStatus } = parse(window.location.search);\n      if (versionStatus) return versionStatus;\n      // Client-side we will have a global variable set if rendered by SSR in production\n      if (typeof window.versionStatus !== 'undefined')\n        return window.versionStatus;\n      // For localhost development we can only work out versionStatus from the current hostname\n      const currentHostname = window.location.hostname;\n      return this.getVersionStatusFromHostname(currentHostname);\n    }\n    return null;\n  };\n  getServerSideVersionStatus = request =>\n    request.query.versionStatus ||\n    deliveryApi.getVersionStatusFromHeaders(request.headers) ||\n    deliveryApi.getVersionStatusFromHostname(request.hostname);\n  getVersionStatusFromHeaders = headers => {\n    const versionStatusHeader = headers['x-entry-versionstatus'];\n    if (typeof versionStatusHeader !== 'undefined') return versionStatusHeader;\n    return null;\n  };\n  getVersionStatusFromHostname = currentHostname => {\n    if (currentHostname.indexOf('localhost') > -1) return 'latest';\n\n    if (currentHostname.endsWith('contensis.cloud')) {\n      if (currentHostname.indexOf('preview.') > -1) {\n        return 'latest';\n      } else {\n        return 'published';\n      }\n    }\n\n    if (currentHostname.endsWith('cloud.contensis.com')) {\n      if (currentHostname.indexOf('preview-') > -1) {\n        return 'latest';\n      } else {\n        return 'published';\n      }\n    }\n\n    return 'published';\n  };\n  search = (query, linkDepth, project) => {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return client.entries.search(\n      query,\n      typeof linkDepth !== 'undefined' ? linkDepth : 1\n    );\n  };\n  getClient = (deliveryApiStatus = 'published', project) => {\n    const baseConfig = getClientConfig(project, this.cookies);\n    baseConfig.versionStatus = deliveryApiStatus;\n    return Client.create(baseConfig);\n  };\n  getEntry = (id, linkDepth = 0, deliveryApiStatus = 'published', project) => {\n    const baseConfig = getClientConfig(project, this.cookies);\n    baseConfig.versionStatus = deliveryApiStatus;\n    const client = Client.create(baseConfig);\n    // return client.entries.get(id, linkDepth);\n    return client.entries.get({ id, linkDepth });\n  };\n}\n\nexport const deliveryApi = new DeliveryApi();\nexport const deliveryApiWithCookies = cookies => new DeliveryApi(cookies);\n\nclass CacheNode {\n  constructor(key, value) {\n    this.key = key;\n    this.value = value;\n    this.next = null;\n    this.prev = null;\n  }\n}\n\nclass LruCache {\n  constructor(limit = 100) {\n    this.map = {};\n    this.head = null;\n    this.tail = null;\n    this.limit = limit || 100;\n    this.size = 0;\n  }\n\n  get(key) {\n    if (this.map[key]) {\n      let value = this.map[key].value;\n      let node = new CacheNode(key, value);\n      this.remove(key);\n      this.setHead(node);\n      return value;\n    }\n  }\n\n  set(key, value) {\n    let node = new CacheNode(key, value);\n    if (this.map[key]) {\n      this.remove(key);\n    } else {\n      if (this.size >= this.limit) {\n        delete this.map[this.tail.key];\n        this.size--;\n        this.tail = this.tail.prev;\n        this.tail.next = null;\n      }\n    }\n    this.setHead(node);\n  }\n\n  setHead(node) {\n    node.next = this.head;\n    node.prev = null;\n    if (this.head) {\n      this.head.prev = node;\n    }\n    this.head = node;\n    if (!this.tail) {\n      this.tail = node;\n    }\n    this.size++;\n    this.map[node.key] = node;\n  }\n\n  remove(key) {\n    let node = this.map[key];\n    if (!node) return; // This is sometimes null and crashes the container without this check\n\n    if (node.prev) {\n      node.prev.next = node.next;\n    } else {\n      this.head = node.next;\n    }\n    if (node.next) {\n      node.next.prev = node.prev;\n    } else {\n      this.tail = node.prev;\n    }\n    delete this.map[key];\n    this.size--;\n  }\n}\n\n// CachedSearch does not cache results in SSR by design\nclass CachedSearch {\n  cache = new LruCache();\n  cookies;\n  taxonomyLookup = {};\n\n  constructor(cookies) {\n    this.cookies = cookies;\n  }\n\n  getClient = new DeliveryApi(this.cookies).getClient;\n\n  search(query, linkDepth, project) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(\n      project + JSON.stringify(query) + linkDepth.toString(),\n      () => client.entries.search(query, linkDepth)\n    );\n  }\n\n  searchUsingPost(query, linkDepth = 0, project = '') {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(\n      project + JSON.stringify(query) + linkDepth.toString(),\n      () => client.entries.searchUsingPost(query, linkDepth)\n    );\n  }\n\n  get(id, linkDepth, versionStatus, project) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    client.clientConfig.versionStatus = versionStatus;\n    return this.request(id, () => client.entries.get({ id, linkDepth }));\n  }\n\n  getContentType(id, project) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(`[CONTENT TYPE] ${id} ${project}`, () =>\n      client.contentTypes.get(id)\n    );\n  }\n\n  getTaxonomyNode(key, project) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(`[TAXONOMY NODE] ${key}`, () =>\n      client.taxonomy\n        .resolveChildren(key)\n        .then(node => this.extendTaxonomyNode(node))\n    );\n  }\n\n  getRootNode(options, project) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(`${project} / ${JSON.stringify(options)}`, () =>\n      client.nodes.getRoot(options)\n    );\n  }\n\n  getNode(options, project) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(\n      `${project} ${(options && options.path) || options} ${JSON.stringify(\n        options\n      )}`,\n      () => client.nodes.get(options)\n    );\n  }\n\n  getAncestors(options, project) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(\n      `${project} [A] ${(options && options.id) || options} ${JSON.stringify(\n        options\n      )}`,\n      () => client.nodes.getAncestors(options)\n    );\n  }\n\n  getChildren(options, project) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(\n      `${project} [C] ${(options && options.id) || options} ${JSON.stringify(\n        options\n      )}`,\n      () => client.nodes.getChildren(options)\n    );\n  }\n\n  getSiblings(options, project) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(\n      `${project} [S] ${(options && options.id) || options} ${JSON.stringify(\n        options\n      )}`,\n      () => client.nodes.getSiblings(options)\n    );\n  }\n\n  request(key, execute) {\n    // do not cache results in SSR\n    if (!this.cache.get(key) || typeof window == 'undefined') {\n      let promise = execute();\n      this.cache.set(key, promise);\n      promise.catch(() => {\n        this.cache.remove(key);\n      });\n    }\n    return this.cache.get(key);\n  }\n}\n\nexport const cachedSearch = new CachedSearch();\nexport const cachedSearchWithCookies = cookies => new CachedSearch(cookies);\n"],"names":["getSsrReferer","window","state","reduxStore","getState","referer","selectCurrentHostname","selectCurrentPath","selectCurrentSearch","storeSurrogateKeys","response","keys","headers","get","map","dispatch","setSurrogateKeys","url","getClientConfig","project","cookies","config","DELIVERY_API_CONFIG","responseHandler","projectId","defaultHeaders","Object","assign","PROXY_DELIVERY_API","rootUrl","cookieHeader","mapCookieHeader","findLoginCookies","Cookie","DeliveryApi","constructor","getClientSideVersionStatus","versionStatus","parse","location","search","currentHostname","hostname","getVersionStatusFromHostname","getServerSideVersionStatus","request","query","deliveryApi","getVersionStatusFromHeaders","versionStatusHeader","indexOf","endsWith","linkDepth","client","Client","create","entries","getClient","deliveryApiStatus","baseConfig","getEntry","id","deliveryApiWithCookies","CacheNode","key","value","next","prev","LruCache","limit","head","tail","size","node","remove","setHead","set","CachedSearch","cache","taxonomyLookup","JSON","stringify","toString","searchUsingPost","clientConfig","getContentType","contentTypes","getTaxonomyNode","taxonomy","resolveChildren","then","extendTaxonomyNode","getRootNode","options","nodes","getRoot","getNode","path","getAncestors","getChildren","getSiblings","execute","promise","catch","cachedSearch","cachedSearchWithCookies"],"mappings":"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"}