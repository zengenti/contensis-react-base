{"version":3,"file":"util.js","sources":["../src/util/stringifyStrings.js","../src/util/urls.ts","../src/util/json-mapper.ts"],"sourcesContent":["const stringifyStrings = obj => {\n  const returnObj = Array.isArray(obj) ? [] : {};\n  Object.entries(obj).forEach(([key, value]) => {\n    switch (typeof value) {\n      case 'string':\n        returnObj[key] = JSON.stringify(value);\n        break;\n      case 'object':\n        returnObj[key] = stringifyStrings(value);\n        break;\n      default:\n        returnObj[key] = value;\n        break;\n    }\n  });\n  return returnObj;\n};\n\nmodule.exports = stringifyStrings;\n","const url = (alias: string, project: string) => {\n  const projectAndAlias =\n    project && project.toLowerCase() !== 'website'\n      ? `${project.toLowerCase()}-${alias}`\n      : alias;\n  return {\n    api: `https://api-${alias}.cloud.contensis.com`,\n    cms: `https://cms-${alias}.cloud.contensis.com`,\n    liveWeb: `https://live-${projectAndAlias}.cloud.contensis.com`,\n    previewWeb: `https://preview-${projectAndAlias}.cloud.contensis.com`,\n    iisWeb: `https://iis-live-${projectAndAlias}.cloud.contensis.com`,\n    iisPreviewWeb: `https://iis-preview-${projectAndAlias}.cloud.contensis.com`,\n  };\n};\n\nexport default url;\n","import { Entry } from 'contensis-delivery-api/lib/models';\nimport mapJson, { jpath } from 'jsonpath-mapper';\nimport MappingTemplate, {\n  PureJsFunction,\n} from 'jsonpath-mapper/dist/models/Template';\nimport { AppState } from '~/redux/appstate';\nimport { EntryMapper, RouteNode } from '~/routing/routes';\n\nexport { default as mapJson, jpath } from 'jsonpath-mapper';\n\ntype Mappers<S> = { [contentTypeId: string]: MappingTemplate<S> };\n\n/**\n *\n * @param {object} json The source object we wish to transform\n * @param {object} template The mapping template we wish to apply to the source\n * object to generate the intended target object\n */\nexport const useMapper = <T, S>(json: S, template: MappingTemplate<S>) => {\n  return template ? (mapJson((json || {}) as S, template) as T) : json;\n};\n\nconst chooseMapperByFieldValue = <S, T extends Mappers<S>>(\n  entry: S,\n  mappers: T,\n  field = 'sys.contentTypeId'\n) => {\n  const fieldValue = jpath(field, entry || {}) as string;\n  return (mappers[fieldValue] || mappers.default || {}) as T[keyof T];\n};\n\n/**\n * useEntriesMapper hook to take a list of entries from Delivery API along\n * with mappers for each contentTypeId and return an array of mapped objects\n * @param {any} entry The source entry we wish to transform\n * @param {object} mappers Object with keys containing mapper templates,\n * the key name matching sys.contentTypeId\n * @param {string} field Only include if we need to match content based on\n * a field other than sys.contentTypeId in the source data\n * @returns {object} Object transformed using a matched content type or\n * a default mapper template, returns an empty object if no mapper template\n * couild be applied.\n */\nexport const useEntriesMapper = <S, T extends Mappers<S>>(\n  entry: S,\n  mappers: T,\n  field = 'sys.contentTypeId'\n) => {\n  const mapper = chooseMapperByFieldValue(entry, mappers, field);\n  return useMapper(entry, mapper);\n};\n\n/**\n * Deprecated: due to misleading name, use the hook useEntriesMapper instead\n */\nexport const useEntryMapper = useEntriesMapper;\n\n/**\n * mapEntries mapping function to take a list of entries from Delivery API along\n * with mappers for each contentTypeId and return an array of mapped objects\n * @param {any} entry The source entry we wish to transform\n * @param {object} mappers Object with keys containing mapper templates,\n * the key name matching sys.contentTypeId\n * @param {string} field Only include if we need to match content based on\n * a field other than sys.contentTypeId in the source data\n * @returns {object} Object transformed using a matched content type or\n * a default mapper template, returns an empty object if no mapper template\n * couild be applied.\n */\nexport const mapEntries = <\n  S,\n  Mappers extends { [contentTypeId: string]: MappingTemplate<S> }\n>(\n  entries: S[],\n  mappers: Mappers,\n  field = 'sys.contentTypeId'\n) =>\n  entries.map(entry => {\n    const mapper = chooseMapperByFieldValue(entry, mappers, field);\n    return mapper ? mapJson((entry || {}) as S, mapper) : entry;\n  });\n\n/**\n * mapComposer mapping function to take a composer field from Delivery API along\n * with mappers for each Composer Item \"type\" and return an array of mapped components\n * @param {array} composer Composer field array of Composer Items\n * @param {object} mappers A keyed object with each key matching the Composer Item \"type\"\n * @returns {array} Array of mapped objects transformed using a matched Composer Item \"type\" mapping\n * or null. Injects a \"_type\" property into each transformed object in the array to indicate\n * where the mapping originated and for what component the mapped object is representing\n */\nexport const mapComposer = <\n  S extends { type: string; value: any },\n  T extends Mappers<S>\n>(\n  composer: S[],\n  mappers: T\n) =>\n  Array.isArray(composer)\n    ? composer.map((composerItem, index) => {\n        const itemValue = composerItem.value;\n        const mapper = mappers[composerItem.type] || mappers.default;\n        if (mapper) {\n          // Add some fields into the composer item mapper and return object\n          const addedFields = {\n            _type: composerItem.type,\n            _index: index,\n          };\n\n          // Add fields and $root item into the composer item source object\n          // for use inside each item mapping, for arrays we inject the added fields\n          // into the first array item. This is useful if we require any of\n          // composerItem.type, composerItem index/position and composer $root\n          // in scope to influence any composer item's mapping logic\n          const sourceObject =\n            itemValue && Array.isArray(itemValue)\n              ? itemValue.map((iv, idx) =>\n                  idx !== 0\n                    ? iv\n                    : typeof iv === 'object'\n                    ? { ...addedFields, ...iv, $root: composer }\n                    : iv\n                )\n              : typeof itemValue === 'object'\n              ? { ...addedFields, ...itemValue, $root: composer }\n              : itemValue || {};\n\n          // Apply the composer item mapping\n          const mappedFields = mapJson(sourceObject, mapper) as any;\n\n          // Add the extra fields in with the return object\n          return mappedFields && typeof mappedFields === 'object'\n            ? { ...mappedFields, ...addedFields }\n            : mappedFields;\n        } else return {};\n      })\n    : composer || [];\n\n/**\n * useComposerMapper hook to take a composer field from Delivery API along\n * with mappers for each Composer Item \"type\" and return an array of mapped components\n * @param {array} composer Composer field array of Composer Items\n * @param {object} mappers A keyed object with each key matching the Composer Item \"type\"\n * @returns {array} Array of mapped objects transformed using a matched Composer Item \"type\" mapping\n * or null. Injects a \"_type\" property into each transformed object in the array to indicate\n * where the mapping originated and for what component the mapped object is representing\n */\nexport const useComposerMapper = <\n  S extends { type: string; value: any },\n  T extends Mappers<S>\n>(\n  composer: S[] = [],\n  mappers: T\n) => mapComposer(composer, mappers);\n\n/**\n * entryMapper will return a function to satisfy an entryMapper when defining app route\n * this is essentially a shorthand function to prevent boilerplate repetition inside your routes file\n * you do not need to use this function should you wish to map your entry via raw JS functions\n * @param mapping the jsonpath-mapper mapping template to apply when the route is resolved\n * @returns {mappedEntry}\n */\nexport const entryMapper =\n  (\n    mapping:\n      | MappingTemplate<RouteNode & Entry & { state?: AppState }>\n      | PureJsFunction<RouteNode & Entry & { state?: AppState }>\n  ): EntryMapper =>\n  (node, state) =>\n    mapJson({ ...node, ...(node.entry || ({} as Entry)), state }, mapping);\n\nexport default mapJson;\n"],"names":["stringifyStrings","obj","returnObj","Array","isArray","Object","entries","forEach","key","value","JSON","stringify","module","url","alias","project","projectAndAlias","toLowerCase","api","cms","liveWeb","previewWeb","iisWeb","iisPreviewWeb","useMapper","json","template","mapJson","chooseMapperByFieldValue","entry","mappers","field","fieldValue","jpath","default","useEntriesMapper","mapper","useEntryMapper","mapEntries","map","mapComposer","composer","composerItem","index","itemValue","type","addedFields","_type","_index","sourceObject","iv","idx","$root","mappedFields","useComposerMapper","entryMapper","mapping","node","state"],"mappings":"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"}