{"version":3,"file":"ContensisDeliveryApi-fe57a037.js","sources":["../src/util/LruCache.js","../src/util/CachedDeliveryApi.ts","../src/util/ContensisDeliveryApi.ts"],"sourcesContent":["class CacheNode {\n  constructor(key, value) {\n    this.key = key;\n    this.value = value;\n    this.next = null;\n    this.prev = null;\n  }\n}\n\nexport class LruCache {\n  constructor(limit = 100) {\n    this.map = {};\n    this.head = null;\n    this.tail = null;\n    this.limit = limit || 100;\n    this.size = 0;\n  }\n\n  get(key) {\n    if (this.map[key]) {\n      let value = this.map[key].value;\n      let node = new CacheNode(key, value);\n      this.remove(key);\n      this.setHead(node);\n      return value;\n    }\n  }\n\n  set(key, value) {\n    let node = new CacheNode(key, value);\n    if (this.map[key]) {\n      this.remove(key);\n    } else {\n      if (this.size >= this.limit) {\n        delete this.map[this.tail.key];\n        this.size--;\n        this.tail = this.tail.prev;\n        this.tail.next = null;\n      }\n    }\n    this.setHead(node);\n  }\n\n  setHead(node) {\n    node.next = this.head;\n    node.prev = null;\n    if (this.head) {\n      this.head.prev = node;\n    }\n    this.head = node;\n    if (!this.tail) {\n      this.tail = node;\n    }\n    this.size++;\n    this.map[node.key] = node;\n  }\n\n  remove(key) {\n    let node = this.map[key];\n    if (!node) return; // This is sometimes null and crashes the container without this check\n\n    if (node.prev) {\n      node.prev.next = node.next;\n    } else {\n      this.head = node.next;\n    }\n    if (node.next) {\n      node.next.prev = node.prev;\n    } else {\n      this.tail = node.prev;\n    }\n    delete this.map[key];\n    this.size--;\n  }\n}\n","import { VersionStatus } from 'contensis-core-api';\nimport { Client, Query } from 'contensis-delivery-api';\nimport {\n  INodeOperations,\n  NodeGetRootOptions,\n} from 'contensis-delivery-api/lib/models';\n\nimport { DeliveryApi, getClientConfig } from './ContensisDeliveryApi';\nimport { LruCache } from './LruCache';\nimport { CookieObject } from '~/user/util/CookieConstants';\n\n// CachedSearch does not cache results in SSR by design\nclass CachedSearch {\n  cache = new LruCache();\n  cookies?: CookieObject;\n\n  constructor(cookies?: CookieObject) {\n    this.cookies = cookies;\n  }\n\n  getClient(...args: Parameters<DeliveryApi['getClient']>) {\n    return new DeliveryApi(this.cookies).getClient(...args);\n  }\n\n  search(query: Query, linkDepth = 0, project?: string) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(\n      `${project}+${JSON.stringify(query)}+${linkDepth}`,\n      () => client.entries.search(query, linkDepth)\n    );\n  }\n\n  searchUsingPost(query: Query, linkDepth = 0, project = '') {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(\n      `${project}+${JSON.stringify(query)}+${linkDepth}`,\n      () => (client.entries as any).searchUsingPost(query, linkDepth)\n    );\n  }\n\n  get(\n    id: string,\n    linkDepth = 0,\n    versionStatus: VersionStatus = 'published',\n    project?: string\n  ) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    client.clientConfig.versionStatus = versionStatus;\n    return this.request(id, () => client.entries.get({ id, linkDepth }));\n  }\n\n  getContentType(id: string, project?: string) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(`[CONTENT TYPE] ${id} ${project}`, () =>\n      client.contentTypes.get(id)\n    );\n  }\n\n  getRootNode(options: NodeGetRootOptions, project?: string) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(`${project} / ${JSON.stringify(options)}`, () =>\n      client.nodes.getRoot(options)\n    );\n  }\n\n  getNode(options: Parameters<INodeOperations['get']>[0], project?: string) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(\n      `${project} ${\n        options && typeof options !== 'string'\n          ? 'path' in options\n            ? options.path\n            : options.id\n          : options\n      } ${JSON.stringify(options)}`,\n      () => client.nodes.get(options)\n    );\n  }\n\n  getAncestors(\n    options: Parameters<INodeOperations['getAncestors']>[0],\n    project?: string\n  ) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(\n      `${project} [A] ${\n        (options && typeof options !== 'string' && options.id) || options\n      } ${JSON.stringify(options)}`,\n      () => client.nodes.getAncestors(options)\n    );\n  }\n\n  getChildren(\n    options: Parameters<INodeOperations['getChildren']>[0],\n    project?: string\n  ) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(\n      `${project} [C] ${\n        (options && typeof options !== 'string' && options.id) || options\n      } ${JSON.stringify(options)}`,\n      () => client.nodes.getChildren(options)\n    );\n  }\n\n  getSiblings(\n    options: Parameters<INodeOperations['getSiblings']>[0],\n    project?: string\n  ) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(\n      `${project} [S] ${\n        (options && typeof options !== 'string' && options.id) || options\n      } ${JSON.stringify(options)}`,\n      () => client.nodes.getSiblings(options)\n    );\n  }\n\n  request<T extends () => Promise<any>>(key: string, execute: T) {\n    // do not cache results in SSR\n    if (!this.cache.get(key) || typeof window == 'undefined') {\n      const promise = execute();\n      this.cache.set(key, promise);\n      promise.catch(() => {\n        this.cache.remove(key);\n      });\n    }\n    return this.cache.get(key) as ReturnType<T>;\n  }\n}\n\nexport const cachedSearch = new CachedSearch();\nexport const cachedSearchWithCookies = (cookies?: CookieObject) =>\n  new CachedSearch(cookies);\n","import { VersionStatus } from 'contensis-core-api';\nimport { Client, Query } from 'contensis-delivery-api';\nimport { Config } from 'contensis-delivery-api/lib/models';\nimport { parse } from 'query-string';\nimport { setSurrogateKeys } from '~/routing/redux/actions';\nimport { reduxStore } from '~/redux/store/store';\nimport {\n  selectCurrentHostname,\n  selectCurrentPath,\n  selectCurrentSearch,\n} from '~/routing/redux/selectors';\nimport { CookieObject, findLoginCookies } from '~/user/util/CookieConstants';\nimport { Request } from 'express';\nimport { IncomingHttpHeaders } from 'http';\n\nconst mapCookieHeader = (cookies: CookieObject | string) =>\n  typeof cookies === 'object'\n    ? Object.entries(cookies)\n        .map(([name, value]) => `${name}=${value}`)\n        .join('; ')\n    : cookies;\n\nconst getSsrReferer = () => {\n  if (typeof window === 'undefined') {\n    const state = reduxStore.getState();\n    const referer = `${selectCurrentHostname(state)}${selectCurrentPath(\n      state\n    )}${selectCurrentSearch(state)}`;\n\n    return referer;\n  }\n  return '';\n};\n\nconst storeSurrogateKeys = (response: any) => {\n  const keys = response.headers.get\n    ? response.headers.get('surrogate-key')\n    : response.headers.map['surrogate-key'];\n  if (keys) reduxStore?.dispatch(setSurrogateKeys(keys, response.url));\n};\n\nexport const getClientConfig = (project?: string, cookies?: CookieObject) => {\n  const config: Config = DELIVERY_API_CONFIG; /* global DELIVERY_API_CONFIG */\n  config.responseHandler = {};\n\n  if (project) {\n    config.projectId = project;\n  }\n\n  // we only want the surrogate key header in a server context\n  if (typeof window === 'undefined') {\n    config.defaultHeaders = Object.assign(config.defaultHeaders || {}, {\n      referer: getSsrReferer(),\n      'x-require-surrogate-key': true,\n      'x-crb-ssr': true, // add this for support tracing\n    });\n    config.responseHandler[200] = storeSurrogateKeys;\n  }\n\n  if (\n    typeof window !== 'undefined' &&\n    PROXY_DELIVERY_API /* global PROXY_DELIVERY_API */\n  ) {\n    // ensure a relative url is used to bypass the need for CORS (separate OPTIONS calls)\n    config.rootUrl = '';\n    config.responseHandler[404] = () => null;\n  }\n\n  if (cookies) {\n    const cookieHeader = mapCookieHeader(findLoginCookies(cookies));\n    if (cookieHeader) {\n      config.defaultHeaders = Object.assign(config.defaultHeaders || {}, {\n        Cookie: cookieHeader,\n      });\n    }\n  }\n\n  return config;\n};\n\n// export * from 'contensis-delivery-api';\n\ndeclare let window: Window &\n  typeof globalThis & {\n    versionStatus?: VersionStatus;\n  };\n\nexport class DeliveryApi {\n  cookies?: CookieObject;\n\n  constructor(cookies?: CookieObject) {\n    this.cookies = cookies;\n  }\n\n  getClientSideVersionStatus = () => {\n    if (typeof window !== 'undefined') {\n      // Allow overriding versionStatus with the querystring\n      const { versionStatus } = parse(window.location.search);\n      if (versionStatus) return versionStatus;\n      // Client-side we will have a global variable set if rendered by SSR in production\n      if (typeof window.versionStatus !== 'undefined')\n        return window.versionStatus;\n      // For localhost development we can only work out versionStatus from the current hostname\n      const currentHostname = window.location.hostname;\n      return this.getVersionStatusFromHostname(currentHostname);\n    }\n    return null;\n  };\n\n  getServerSideVersionStatus = (request: Request) =>\n    request.query.versionStatus ||\n    deliveryApi.getVersionStatusFromHeaders(request.headers) ||\n    deliveryApi.getVersionStatusFromHostname(request.hostname);\n\n  getVersionStatusFromHeaders = (headers: IncomingHttpHeaders) => {\n    const versionStatusHeader = headers['x-entry-versionstatus'];\n    if (typeof versionStatusHeader !== 'undefined') return versionStatusHeader;\n    return null;\n  };\n\n  getVersionStatusFromHostname = (currentHostname: string) => {\n    if (currentHostname.indexOf('localhost') > -1) return 'latest';\n\n    if (currentHostname.endsWith('contensis.cloud')) {\n      if (currentHostname.indexOf('preview.') > -1) {\n        return 'latest';\n      } else {\n        return 'published';\n      }\n    }\n\n    if (currentHostname.endsWith('cloud.contensis.com')) {\n      if (currentHostname.indexOf('preview-') > -1) {\n        return 'latest';\n      } else {\n        return 'published';\n      }\n    }\n\n    return 'published';\n  };\n\n  search = (query: Query, linkDepth = 0, project?: string) => {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return client.entries.search(\n      query,\n      typeof linkDepth !== 'undefined' ? linkDepth : 1\n    );\n  };\n\n  getClient = (versionStatus: VersionStatus = 'published', project) => {\n    const baseConfig = getClientConfig(project, this.cookies);\n    baseConfig.versionStatus = versionStatus;\n    return Client.create(baseConfig);\n  };\n\n  getEntry = (\n    id: string,\n    linkDepth = 0,\n    versionStatus: VersionStatus = 'published',\n    project?: string\n  ) => {\n    const baseConfig = getClientConfig(project, this.cookies);\n    baseConfig.versionStatus = versionStatus;\n    const client = Client.create(baseConfig);\n    // return client.entries.get(id, linkDepth);\n    return client.entries.get({ id, linkDepth });\n  };\n}\n\nexport const deliveryApi = new DeliveryApi();\n\nexport const deliveryApiWithCookies = (cookies?: CookieObject) =>\n  new DeliveryApi(cookies);\n\nexport * from './CachedDeliveryApi';\n"],"names":["CacheNode","constructor","key","value","next","prev","LruCache","limit","map","head","tail","size","get","node","remove","setHead","set","CachedSearch","cookies","cache","getClient","args","DeliveryApi","search","query","linkDepth","project","client","Client","create","getClientConfig","request","JSON","stringify","entries","searchUsingPost","id","versionStatus","clientConfig","getContentType","contentTypes","getRootNode","options","nodes","getRoot","getNode","path","getAncestors","getChildren","getSiblings","execute","window","promise","catch","cachedSearch","cachedSearchWithCookies","mapCookieHeader","Object","name","join","getSsrReferer","state","reduxStore","getState","referer","selectCurrentHostname","selectCurrentPath","selectCurrentSearch","storeSurrogateKeys","response","keys","headers","dispatch","setSurrogateKeys","url","config","DELIVERY_API_CONFIG","responseHandler","projectId","defaultHeaders","assign","PROXY_DELIVERY_API","rootUrl","cookieHeader","findLoginCookies","Cookie","getClientSideVersionStatus","parse","location","currentHostname","hostname","getVersionStatusFromHostname","getServerSideVersionStatus","deliveryApi","getVersionStatusFromHeaders","versionStatusHeader","indexOf","endsWith","baseConfig","getEntry","deliveryApiWithCookies"],"mappings":"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"}