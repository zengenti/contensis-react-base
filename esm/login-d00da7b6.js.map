{"version":3,"file":"login-d00da7b6.js","sources":["../src/routing/util/find-contenttype-mapping.ts","../src/user/transformations/mapClientCredentials.js","../src/user/util/ContensisManagementApi.js","../src/user/util/CookieHelper.class.js","../src/user/util/OidcUserManager.js","../src/user/util/LoginHelper.class.js","../src/user/redux/sagas/login.js"],"sourcesContent":["import { ContentTypeMapping } from '../routes';\r\n\r\nexport const findContentTypeMapping = (\r\n  ContentTypeMappings: ContentTypeMapping[],\r\n  contentTypeId: string\r\n) => ContentTypeMappings.find(ct => ct.contentTypeID === contentTypeId);\r\n","import { mapJson } from '~/util/json-mapper';\r\n\r\nconst clientCredentials = {\r\n  bearerToken: 'bearerToken',\r\n  bearerTokenExpiryDate: ({ bearerTokenExpiryDate }) =>\r\n    bearerTokenExpiryDate.toISOString(),\r\n  refreshToken: 'refreshToken',\r\n  refreshTokenExpiryDate: ({ refreshTokenExpiryDate }) =>\r\n    refreshTokenExpiryDate.toISOString(),\r\n  contensisClassicToken: 'contensisClassicToken',\r\n};\r\nexport default obj => mapJson(obj, clientCredentials);\r\n","// import { Client } from 'contensis-management-api';\r\n\r\nexport const getManagementApiClient = async ({\r\n  bearerToken,\r\n  bearerTokenExpiryDate,\r\n  refreshToken,\r\n  refreshTokenExpiryDate,\r\n  contensisClassicToken,\r\n  username,\r\n  password,\r\n}) => {\r\n  const rootUrl = SERVERS.api || SERVERS.cms; /* global SERVERS */\r\n  const projectId = PROJECTS[0].id; /* global PROJECTS */\r\n\r\n  let config = {};\r\n  if (refreshToken) {\r\n    config = {\r\n      clientType: 'contensis_classic_refresh_token',\r\n      clientDetails: {\r\n        refreshToken,\r\n      },\r\n    };\r\n  } else {\r\n    config = {\r\n      clientType: 'contensis_classic',\r\n      clientDetails: {\r\n        username,\r\n        password,\r\n      },\r\n    };\r\n  }\r\n  const { Client } = await import('contensis-management-api');\r\n\r\n  const client = Client.create({\r\n    ...config,\r\n    projectId,\r\n    rootUrl,\r\n  });\r\n\r\n  if (bearerToken) client.bearerToken = bearerToken;\r\n  if (bearerTokenExpiryDate)\r\n    client.bearerTokenExpiryDate = bearerTokenExpiryDate;\r\n  if (refreshToken) client.refreshToken = refreshToken;\r\n  if (refreshTokenExpiryDate)\r\n    client.refreshTokenExpiryDate = refreshTokenExpiryDate;\r\n  if (contensisClassicToken)\r\n    client.contensisClassicToken = contensisClassicToken;\r\n\r\n  return client;\r\n};\r\n","import Cookies from 'js-cookie';\r\n\r\nconst COOKIE_VALID_DAYS = 1; // 0 = Session cookie\r\n\r\n// Override the default js-cookie conversion / encoding\r\n// methods so the written values work with Contensis sites\r\nconst _cookie = Cookies.withConverter({\r\n  read: value => decodeURIComponent(value),\r\n  write: value => encodeURIComponent(value),\r\n});\r\n\r\nexport class CookieHelper {\r\n  static GetCookie(name) {\r\n    let cookie = _cookie.get(name);\r\n    if (typeof cookie == 'undefined') {\r\n      return null;\r\n    }\r\n    return cookie;\r\n  }\r\n\r\n  static SetCookie(name, value, maxAgeDays = COOKIE_VALID_DAYS) {\r\n    maxAgeDays === 0\r\n      ? _cookie.set(name, value)\r\n      : _cookie.set(name, value, { expires: maxAgeDays });\r\n  }\r\n\r\n  static DeleteCookie(name) {\r\n    _cookie.remove(name);\r\n  }\r\n}\r\n","const context = typeof window != 'undefined' ? window : global;\r\nconst requireOidc =\r\n  process.env.NODE_ENV === 'development'\r\n    ? WSFED_LOGIN === 'true' /* global WSFED_LOGIN */\r\n    : context.WSFED_LOGIN === 'true';\r\n\r\nconst servers = SERVERS; /* global SERVERS */\r\n\r\nexport const userManagerConfig =\r\n  typeof window !== 'undefined'\r\n    ? {\r\n        authority: `${servers.cms}/authenticate/`,\r\n        client_id: 'WebsiteAdfsClient',\r\n        redirect_uri: window.location.toString(),\r\n        post_logout_redirect_uri: window.location.toString(),\r\n        response_type: 'id_token',\r\n        scope: 'openid',\r\n        filterProtocolClaims: false,\r\n      }\r\n    : {};\r\n\r\nexport const createUserManager = async config => {\r\n  if (typeof window !== 'undefined' && requireOidc) {\r\n    try {\r\n      const { UserManager } = await import(\r\n        /* webpackChunkName: \"oidcclient\" */ 'oidc-client'\r\n      );\r\n      return new UserManager(config);\r\n    } catch (e) {\r\n      // eslint-disable-next-line no-console\r\n      console.log('Exception in createUserManager: ', e);\r\n    }\r\n  } else return {};\r\n};\r\n\r\n//const userManager = createUserManager(userManagerConfig);\r\n\r\n// export default userManager;\r\n","/* eslint-disable require-atomic-updates */\r\nimport { getManagementApiClient } from './ContensisManagementApi';\r\nimport { to } from 'await-to-js';\r\n\r\nimport { CookieHelper } from './CookieHelper.class';\r\n\r\nimport mapClientCredentials from '../transformations/mapClientCredentials';\r\nimport { createUserManager, userManagerConfig } from './OidcUserManager';\r\n\r\nexport const LOGIN_COOKIE = 'ContensisCMSUserName';\r\nexport const REFRESH_TOKEN_COOKIE = 'RefreshToken';\r\n\r\nconst context = typeof window != 'undefined' ? window : global;\r\n\r\nexport class LoginHelper {\r\n  static CMS_URL = SERVERS.cms /* global SERVERS */;\r\n  static WSFED_LOGIN =\r\n    process.env.NODE_ENV === 'development'\r\n      ? WSFED_LOGIN === 'true' /* global WSFED_LOGIN */\r\n      : context.WSFED_LOGIN === 'true';\r\n  static LOGIN_ROUTE = '/account/login';\r\n  static ACCESS_DENIED_ROUTE = '/account/access-denied';\r\n\r\n  static SetLoginCookies({ contensisClassicToken, refreshToken }) {\r\n    console.info(\r\n      'SetLoginCookies:',\r\n      LOGIN_COOKIE,\r\n      contensisClassicToken,\r\n      REFRESH_TOKEN_COOKIE,\r\n      refreshToken\r\n    );\r\n    if (contensisClassicToken)\r\n      CookieHelper.SetCookie(LOGIN_COOKIE, contensisClassicToken);\r\n    if (refreshToken)\r\n      CookieHelper.SetCookie(REFRESH_TOKEN_COOKIE, refreshToken);\r\n  }\r\n\r\n  static GetCachedCredentials() {\r\n    return {\r\n      bearerToken: null,\r\n      bearerTokenExpiryDate: null,\r\n      refreshToken: CookieHelper.GetCookie(REFRESH_TOKEN_COOKIE),\r\n      refreshTokenExpiryDate: null,\r\n      contensisClassicToken: CookieHelper.GetCookie(LOGIN_COOKIE),\r\n    };\r\n  }\r\n\r\n  static ClearCachedCredentials() {\r\n    CookieHelper.DeleteCookie(LOGIN_COOKIE);\r\n    CookieHelper.DeleteCookie(REFRESH_TOKEN_COOKIE);\r\n\r\n    if (LoginHelper.WSFED_LOGIN && typeof window !== 'undefined') {\r\n      // remove any oidc keys left over in localStorage\r\n      const { localStorage } = window;\r\n      const keys = [];\r\n      for (let i = 0; i < localStorage.length; i++) {\r\n        const key = localStorage.key(i);\r\n        if (typeof key === 'string' && key.startsWith('oidc.'))\r\n          keys.push(localStorage.key(i));\r\n      }\r\n      keys.forEach(key => localStorage.removeItem(key));\r\n    }\r\n  }\r\n\r\n  static async LoginUser({ username, password, clientCredentials }) {\r\n    let credentials = clientCredentials;\r\n    let authenticationState = {\r\n      clientCredentials: null,\r\n      isAuthenticated: false,\r\n      isAuthenticationError: false,\r\n      isError: false,\r\n    };\r\n    let transientClient;\r\n    let user;\r\n\r\n    if (username && password) {\r\n      // Get a management client with username and password\r\n      transientClient = await getManagementApiClient({\r\n        username,\r\n        password,\r\n      });\r\n\r\n      // Ensure the client has requested a bearer token\r\n      const [loginError, clientBearerToken] = await to(\r\n        transientClient.ensureBearerToken()\r\n      );\r\n\r\n      // Problem getting token with username and password\r\n      if (loginError) {\r\n        authenticationState = {\r\n          clientCredentials: null,\r\n          errorMessage: loginError.message || null,\r\n          isAuthenticated: false,\r\n          isAuthenticationError: loginError.name.includes(\r\n            'ContensisAuthenticationError'\r\n          ),\r\n          isError: true,\r\n        };\r\n        LoginHelper.ClearCachedCredentials();\r\n      }\r\n\r\n      // Got a token using username and password\r\n      if (clientBearerToken) {\r\n        // Set credentials so we can continue to GetUserDetails\r\n        credentials = mapClientCredentials(transientClient);\r\n        LoginHelper.SetLoginCookies(credentials);\r\n        authenticationState = {\r\n          clientCredentials: credentials,\r\n          isAuthenticated: true,\r\n          isAuthenticationError: false,\r\n          isError: false,\r\n        };\r\n      }\r\n    }\r\n\r\n    // If we have credentials supplied by a successful username and password login\r\n    // or clientCredentials supplied in the options argument we can continue to\r\n    // fetch the user's details\r\n    if (credentials) {\r\n      const client =\r\n        transientClient || (await getManagementApiClient(credentials));\r\n      const [error, userDetails] = await LoginHelper.GetUserDetails(client);\r\n\r\n      if (error) {\r\n        authenticationState = {\r\n          clientCredentials: null,\r\n          errorMessage: error.message,\r\n          isAuthenticated: false,\r\n          isAuthenticationError: false,\r\n          isError: true,\r\n        };\r\n        LoginHelper.ClearCachedCredentials();\r\n      } else {\r\n        // Ensure we get latest refreshToken and contensisClassicToken from the latest client\r\n        const latestCredentials = mapClientCredentials(client);\r\n        LoginHelper.SetLoginCookies(latestCredentials);\r\n\r\n        user = userDetails;\r\n        authenticationState = {\r\n          clientCredentials: latestCredentials,\r\n          isAuthenticated: true,\r\n          isAuthenticationError: false,\r\n          isError: false,\r\n        };\r\n      }\r\n    }\r\n\r\n    return { authenticationState, user };\r\n  }\r\n\r\n  static GetUserDetails = async client => {\r\n    let userError,\r\n      groupsError,\r\n      user = {},\r\n      groupsResult;\r\n\r\n    [userError, user] = await to(client.security.users.getCurrent());\r\n    if (user && user.id) {\r\n      [groupsError, groupsResult] = await to(\r\n        client.security.users.getUserGroups({\r\n          userId: user.id,\r\n          includeInherited: true,\r\n        })\r\n      );\r\n      // Set groups attribute in user object to be the items\r\n      // array from the getUserGroups result\r\n      if (groupsResult && groupsResult.items) user.groups = groupsResult.items;\r\n\r\n      //If groups call fails then log the error but allow the user to login still\r\n      // eslint-disable-next-line no-console\r\n      if (groupsError) console.log(groupsError);\r\n    }\r\n    return [userError, user];\r\n  };\r\n\r\n  static LogoutUser(redirectPath) {\r\n    LoginHelper.ClearCachedCredentials();\r\n    if (LoginHelper.WSFED_LOGIN) {\r\n      LoginHelper.WsFedLogout(redirectPath);\r\n    } else {\r\n      if (redirectPath) LoginHelper.ClientRedirectToPath(redirectPath);\r\n      else LoginHelper.ClientRedirectToSignInPage();\r\n    }\r\n  }\r\n\r\n  static ClientRedirectToHome(location) {\r\n    if (typeof window != 'undefined') {\r\n      let url = '/';\r\n      if (location) {\r\n        const { search, hash } = location;\r\n        url = search ? `${url}${search}` : url;\r\n        url = hash ? `${url}${hash}` : url;\r\n      }\r\n      window.location.href = url;\r\n    }\r\n  }\r\n\r\n  static async ClientRedirectToSignInPage(redirectPath) {\r\n    if (LoginHelper.WSFED_LOGIN) {\r\n      await LoginHelper.WsFedLogout();\r\n      await LoginHelper.WsFedLogin();\r\n    } else {\r\n      // Standard Contensis Login\r\n      let url = LoginHelper.LOGIN_ROUTE;\r\n      if (typeof redirectPath === 'string')\r\n        url = `${url}?redirect_uri=${redirectPath}`;\r\n      if (\r\n        typeof location !== 'undefined' &&\r\n        redirectPath !== LoginHelper.LOGIN_ROUTE\r\n      )\r\n        location.replace(url);\r\n    }\r\n  }\r\n\r\n  static ClientRedirectToAccessDeniedPage(originalPath) {\r\n    let url = LoginHelper.ACCESS_DENIED_ROUTE;\r\n    if (originalPath === url) return;\r\n\r\n    if (typeof originalPath === 'string')\r\n      url = `${url}?original_uri=${originalPath}`;\r\n    if (typeof location !== 'undefined') location.href = url;\r\n  }\r\n\r\n  static ClientRedirectToPath(redirectPath) {\r\n    if (typeof redirectPath === 'string') {\r\n      if (typeof location !== 'undefined') window.location.href = redirectPath;\r\n    } else LoginHelper.ClientRedirectToHome();\r\n  }\r\n\r\n  static async WsFedLogin(redirectUri) {\r\n    const userManager = await createUserManager(userManagerConfig);\r\n    userManager.signinRedirect({\r\n      scope: 'openid',\r\n      response_type: 'id_token',\r\n      redirect_uri: redirectUri || window.location.toString(),\r\n    });\r\n  }\r\n\r\n  static RemoveSecurityTokenQuery() {\r\n    const params = new URLSearchParams(window.location.search);\r\n    if (params.has('securitytoken') || params.has('securityToken')) {\r\n      params.delete('securitytoken');\r\n      params.delete('securityToken');\r\n      window.location = `${window.location.pathname}${\r\n        params.toString() ? `?${params}` : ''\r\n      }`;\r\n    }\r\n  }\r\n\r\n  static async WsFedLogout(redirectPath) {\r\n    await fetch(\r\n      `${LoginHelper.CMS_URL}/authenticate/logout?jsonResponseRequired=true`,\r\n      {\r\n        credentials: 'include',\r\n      }\r\n    );\r\n    if (redirectPath) {\r\n      window.location = redirectPath;\r\n    } else {\r\n      // Explicitly check and remove any stale\r\n      // security token that may be in the query string\r\n      LoginHelper.RemoveSecurityTokenQuery();\r\n    }\r\n  }\r\n\r\n  static async GetCredentialsForSecurityToken(securityToken) {\r\n    const [error, response] = await to(\r\n      fetch(`${LoginHelper.CMS_URL}/REST/Contensis/Security/IsAuthenticated`, {\r\n        method: 'POST',\r\n        headers: {\r\n          Accept: 'application/json',\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          securityToken: encodeURIComponent(securityToken),\r\n        }),\r\n      })\r\n    );\r\n    if (error) return [{ message: 'Failed to fetch credentials' }];\r\n    if (response.ok) {\r\n      const [parseError, body] = await to(response.json());\r\n      if (parseError) return [parseError];\r\n\r\n      const { LogonResult, ApplicationData = [] } = body;\r\n      if (LogonResult !== 0) {\r\n        return [\r\n          { message: 'Security token is invalid', data: ApplicationData },\r\n        ];\r\n      }\r\n      if (ApplicationData.length > 0) {\r\n        let refreshToken;\r\n        ApplicationData.forEach(item => {\r\n          if (item.Key === 'ContensisSecurityRefreshToken')\r\n            refreshToken = item.Value;\r\n        });\r\n        if (!refreshToken) {\r\n          return [\r\n            {\r\n              message:\r\n                'Fetch credentials: Unable to find ContensisSecurityRefreshToken',\r\n            },\r\n          ];\r\n        }\r\n        return [undefined, refreshToken];\r\n      } else {\r\n        return [\r\n          {\r\n            message:\r\n              'Fetch credentials: Unable to find ContensisSecurityRefreshToken',\r\n          },\r\n        ];\r\n      }\r\n    } else {\r\n      return [\r\n        {\r\n          message: `Fetch credentials error: ${response.status} ${response.statusText}`,\r\n        },\r\n      ];\r\n    }\r\n  }\r\n\r\n  static isZengentiStaff(email) {\r\n    const emailRefs = ['@zengenti', '@contensis'];\r\n\r\n    return emailRefs.some(emailRef => {\r\n      if (email.includes(emailRef)) {\r\n        return true;\r\n      }\r\n    });\r\n  }\r\n}\r\n","import { takeEvery, select, put, call } from 'redux-saga/effects';\r\nimport {\r\n  SET_AUTHENTICATION_STATE,\r\n  LOGIN_USER,\r\n  LOGOUT_USER,\r\n  VALIDATE_USER,\r\n} from '../types';\r\nimport {\r\n  selectUserIsAuthenticated,\r\n  selectClientCredentials,\r\n  selectUserGroups,\r\n} from '../selectors';\r\n\r\nimport { setRoute } from '~/routing/redux/actions';\r\nimport { selectCurrentSearch } from '~/routing/redux/selectors';\r\nimport { findContentTypeMapping } from '~/routing/util/find-contenttype-mapping';\r\n\r\nimport mapClientCredentials from '~/user/transformations/mapClientCredentials';\r\n\r\nimport { getManagementApiClient } from '~/user/util/ContensisManagementApi';\r\nimport { LoginHelper } from '~/user/util/LoginHelper.class';\r\nimport { matchUserGroup } from '~/user/util/matchGroups';\r\nimport { queryParams } from '~/util/navigation';\r\n\r\nexport const loginSagas = [\r\n  takeEvery(LOGIN_USER, loginUserSaga),\r\n  takeEvery(LOGOUT_USER, logoutUserSaga),\r\n  takeEvery(VALIDATE_USER, validateUserSaga),\r\n  takeEvery(SET_AUTHENTICATION_STATE, redirectAfterSuccessfulLoginSaga),\r\n];\r\n\r\nexport function* handleRequiresLoginSaga(action) {\r\n  const {\r\n    entry,\r\n    requireLogin,\r\n    routes: { ContentTypeMappings },\r\n    staticRoute,\r\n  } = action;\r\n  let userLoggedIn = yield select(selectUserIsAuthenticated);\r\n\r\n  // Check for a securityToken in querystring\r\n  const currentQs = queryParams(yield select(selectCurrentSearch));\r\n  const securityToken = currentQs.securityToken || currentQs.securitytoken;\r\n\r\n  // Check if any of the defined routes have \"requireLogin\" attribute\r\n  const { requireLogin: authRoute } = (staticRoute && staticRoute.route) || {};\r\n  const { requireLogin: authContentType } =\r\n    (entry &&\r\n      findContentTypeMapping(ContentTypeMappings, entry?.sys?.contentTypeId)) ||\r\n    {};\r\n\r\n  // If requireLogin, authRoute or authContentType has been specified as an\r\n  // array of groups we can merge all the arrays and match on any group supplied\r\n  const routeRequiresGroups = [\r\n    ...((Array.isArray(authContentType) && authContentType) || []),\r\n    ...((Array.isArray(authRoute) && authRoute) || []),\r\n    ...((Array.isArray(requireLogin) && requireLogin) || []),\r\n  ];\r\n  const routeRequiresLogin = !!authContentType || !!authRoute || !!requireLogin;\r\n\r\n  if (!userLoggedIn) {\r\n    // If cookies or securityToken are found on any route change\r\n    // always validate and login the user\r\n    if (routeRequiresLogin) {\r\n      // If routeRequiresLogin do a blocking call that returns userLoggedIn\r\n      userLoggedIn = yield call(validateUserSaga, { securityToken });\r\n    }\r\n    // otherwise do a non blocking put to handle validation in the background\r\n    else yield put({ type: VALIDATE_USER, securityToken });\r\n  }\r\n\r\n  if (routeRequiresLogin) {\r\n    // If a security token is in the querystring and we are not already\r\n    // logged in something is wrong and we won't bother going on another redirect loop\r\n    if (!userLoggedIn && !securityToken) {\r\n      LoginHelper.ClientRedirectToSignInPage(action.location.pathname);\r\n    } else if (routeRequiresGroups.length > 0) {\r\n      const userGroups = yield select(selectUserGroups, 'js');\r\n      const groupMatch = matchUserGroup(userGroups, routeRequiresGroups);\r\n\r\n      if (!groupMatch)\r\n        LoginHelper.ClientRedirectToAccessDeniedPage(action.location.pathname);\r\n    }\r\n  }\r\n}\r\n\r\nfunction* validateUserSaga({ securityToken }) {\r\n  // Check for refreshToken in cookies\r\n  let clientCredentials = LoginHelper.GetCachedCredentials();\r\n\r\n  if (securityToken || clientCredentials.refreshToken) {\r\n    // We only attempt to validate the user if one of the stored\r\n    // tokens are found, in this case we set loading state manually\r\n    // so we don't need to set and unset loading if there are no stored\r\n    yield put({\r\n      type: SET_AUTHENTICATION_STATE,\r\n      authenticationState: {\r\n        isLoading: true,\r\n      },\r\n    });\r\n    // If we have just a security token we will call a CMS endpoint\r\n    // and provide us with a RefreshToken cookie we can use during login\r\n    const [error, refreshToken] =\r\n      yield LoginHelper.GetCredentialsForSecurityToken(securityToken);\r\n    if (refreshToken) {\r\n      // Set cookies and reload values\r\n      LoginHelper.SetLoginCookies({\r\n        contensisClassicToken: securityToken,\r\n        refreshToken,\r\n      });\r\n      clientCredentials = LoginHelper.GetCachedCredentials();\r\n    }\r\n\r\n    // Log the user in if a refreshToken is found\r\n    if (clientCredentials.refreshToken)\r\n      yield call(loginUserSaga, { clientCredentials });\r\n    else if (error)\r\n      yield put({\r\n        type: SET_AUTHENTICATION_STATE,\r\n        authenticationState: {\r\n          isError: true,\r\n          errorMessage:\r\n            error?.message ||\r\n            (error && 'toString' in error && error.toString()),\r\n        },\r\n      });\r\n  }\r\n\r\n  // Tell any callers have we successfully logged in?\r\n  return yield select(selectUserIsAuthenticated);\r\n}\r\n\r\nfunction* loginUserSaga(action = {}) {\r\n  const { username, password, clientCredentials } = action;\r\n\r\n  // If a WSFED_LOGIN site has dispatched the loginUser action\r\n  // just redirect them to the Identity Provider sign in\r\n  if (action.type === LOGIN_USER && LoginHelper.WSFED_LOGIN)\r\n    LoginHelper.ClientRedirectToSignInPage();\r\n\r\n  const { authenticationState, user } = yield LoginHelper.LoginUser({\r\n    username,\r\n    password,\r\n    clientCredentials,\r\n  });\r\n\r\n  yield put({\r\n    type: SET_AUTHENTICATION_STATE,\r\n    authenticationState,\r\n    user,\r\n  });\r\n}\r\nconst removeHostnamePart = path => {\r\n  // eslint-disable-next-line no-console\r\n  console.log(path);\r\n  const relativePath = '/' + path.split('/').splice(3).join('/');\r\n  // eslint-disable-next-line no-console\r\n  console.log(relativePath);\r\n  return relativePath;\r\n};\r\n\r\nfunction* redirectAfterSuccessfulLoginSaga() {\r\n  const isLoggedIn = yield select(selectUserIsAuthenticated);\r\n  const { redirect_uri: redirectPath, ReturnURL: assetRedirectPath } =\r\n    queryParams(yield select(selectCurrentSearch));\r\n\r\n  if (isLoggedIn && assetRedirectPath && typeof window != 'undefined') {\r\n    const path = removeHostnamePart(assetRedirectPath);\r\n    // This has to be a hard href to get the app to\r\n    // leave React and hit the server for the IIS hosted assets\r\n    window.location.href = path;\r\n    // yield put(setRoute(path)); // does not work in this scenario\r\n  } else if (isLoggedIn && redirectPath) {\r\n    yield put(setRoute(redirectPath));\r\n  }\r\n}\r\n\r\nfunction* logoutUserSaga({ redirectPath }) {\r\n  yield put({\r\n    type: SET_AUTHENTICATION_STATE,\r\n    user: null,\r\n  });\r\n  yield LoginHelper.LogoutUser(redirectPath);\r\n}\r\n\r\nexport function* refreshSecurityToken() {\r\n  const clientCredentials = yield select(selectClientCredentials, 'js');\r\n  if (Object.keys(clientCredentials).length > 0) {\r\n    const client = yield getManagementApiClient(clientCredentials);\r\n    yield client.authenticate();\r\n\r\n    yield put({\r\n      type: SET_AUTHENTICATION_STATE,\r\n      authenticationState: {\r\n        clientCredentials: mapClientCredentials(client),\r\n      },\r\n    });\r\n  }\r\n}\r\n"],"names":["findContentTypeMapping","ContentTypeMappings","contentTypeId","find","ct","contentTypeID","clientCredentials","bearerToken","bearerTokenExpiryDate","toISOString","refreshToken","refreshTokenExpiryDate","contensisClassicToken","obj","mapJson","getManagementApiClient","username","password","rootUrl","SERVERS","api","cms","projectId","PROJECTS","id","config","clientType","clientDetails","Client","client","create","COOKIE_VALID_DAYS","_cookie","Cookies","withConverter","read","value","decodeURIComponent","write","encodeURIComponent","CookieHelper","GetCookie","name","cookie","get","SetCookie","maxAgeDays","set","expires","DeleteCookie","remove","context","window","global","requireOidc","process","env","NODE_ENV","WSFED_LOGIN","servers","userManagerConfig","authority","client_id","redirect_uri","location","toString","post_logout_redirect_uri","response_type","scope","filterProtocolClaims","createUserManager","UserManager","e","console","log","LOGIN_COOKIE","REFRESH_TOKEN_COOKIE","LoginHelper","SetLoginCookies","info","GetCachedCredentials","ClearCachedCredentials","localStorage","keys","i","length","key","startsWith","push","forEach","removeItem","LoginUser","credentials","authenticationState","isAuthenticated","isAuthenticationError","isError","transientClient","user","loginError","clientBearerToken","to","ensureBearerToken","errorMessage","message","includes","mapClientCredentials","error","userDetails","GetUserDetails","latestCredentials","LogoutUser","redirectPath","WsFedLogout","ClientRedirectToPath","ClientRedirectToSignInPage","ClientRedirectToHome","url","search","hash","href","WsFedLogin","LOGIN_ROUTE","replace","ClientRedirectToAccessDeniedPage","originalPath","ACCESS_DENIED_ROUTE","redirectUri","userManager","signinRedirect","RemoveSecurityTokenQuery","params","URLSearchParams","has","delete","pathname","fetch","CMS_URL","GetCredentialsForSecurityToken","securityToken","response","method","headers","Accept","body","JSON","stringify","ok","parseError","json","LogonResult","ApplicationData","data","item","Key","Value","undefined","status","statusText","isZengentiStaff","email","emailRefs","some","emailRef","userError","groupsError","groupsResult","security","users","getCurrent","getUserGroups","userId","includeInherited","items","groups","loginSagas","takeEvery","LOGIN_USER","loginUserSaga","LOGOUT_USER","logoutUserSaga","VALIDATE_USER","validateUserSaga","SET_AUTHENTICATION_STATE","redirectAfterSuccessfulLoginSaga","handleRequiresLoginSaga","action","entry","requireLogin","routes","staticRoute","userLoggedIn","select","selectUserIsAuthenticated","currentQs","queryParams","selectCurrentSearch","securitytoken","authRoute","route","authContentType","sys","routeRequiresGroups","Array","isArray","routeRequiresLogin","call","put","type","userGroups","selectUserGroups","groupMatch","matchUserGroup","isLoading","removeHostnamePart","path","relativePath","split","splice","join","isLoggedIn","ReturnURL","assetRedirectPath","setRoute","refreshSecurityToken","selectClientCredentials","Object","authenticate"],"mappings":";;;;;;;;;MAEaA,sBAAsB,GAAG,CACpCC,mBADoC,EAEpCC,aAFoC,KAGjCD,mBAAmB,CAACE,IAApB,CAAyBC,EAAE,IAAIA,EAAE,CAACC,aAAH,KAAqBH,aAApD;;ACHL,MAAMI,iBAAiB,GAAG;AACxBC,EAAAA,WAAW,EAAE,aADW;AAExBC,EAAAA,qBAAqB,EAAE,CAAC;AAAEA,IAAAA,qBAAAA;AAAF,GAAD,KACrBA,qBAAqB,CAACC,WAAtB,EAHsB;AAIxBC,EAAAA,YAAY,EAAE,cAJU;AAKxBC,EAAAA,sBAAsB,EAAE,CAAC;AAAEA,IAAAA,sBAAAA;AAAF,GAAD,KACtBA,sBAAsB,CAACF,WAAvB,EANsB;AAOxBG,EAAAA,qBAAqB,EAAE,uBAAA;AAPC,CAA1B,CAAA;AASA,2BAAA,CAAeC,GAAG,IAAIC,OAAO,CAACD,GAAD,EAAMP,iBAAN,CAA7B;;ACXA;AAEO,MAAMS,sBAAsB,GAAG,OAAO;EAC3CR,WAD2C;EAE3CC,qBAF2C;EAG3CE,YAH2C;EAI3CC,sBAJ2C;EAK3CC,qBAL2C;EAM3CI,QAN2C;AAO3CC,EAAAA,QAAAA;AAP2C,CAAP,KAQhC;EACJ,MAAMC,OAAO,GAAGC,OAAO,CAACC,GAAR,IAAeD,OAAO,CAACE,GAAvC,CAAA;AAA4C;;AAC5C,EAAA,MAAMC,SAAS,GAAGC,QAAQ,CAAC,CAAD,CAAR,CAAYC,EAA9B,CAAA;AAAkC;;EAElC,IAAIC,MAAM,GAAG,EAAb,CAAA;;AACA,EAAA,IAAIf,YAAJ,EAAkB;AAChBe,IAAAA,MAAM,GAAG;AACPC,MAAAA,UAAU,EAAE,iCADL;AAEPC,MAAAA,aAAa,EAAE;AACbjB,QAAAA,YAAAA;AADa,OAAA;KAFjB,CAAA;AAMD,GAPD,MAOO;AACLe,IAAAA,MAAM,GAAG;AACPC,MAAAA,UAAU,EAAE,mBADL;AAEPC,MAAAA,aAAa,EAAE;QACbX,QADa;AAEbC,QAAAA,QAAAA;AAFa,OAAA;KAFjB,CAAA;AAOD,GAAA;;EACD,MAAM;AAAEW,IAAAA,MAAAA;GAAW,GAAA,MAAM,OAAO,0BAAP,CAAzB,CAAA;EAEA,MAAMC,MAAM,GAAGD,MAAM,CAACE,MAAP,CAAc,EAC3B,GAAGL,MADwB;IAE3BH,SAF2B;AAG3BJ,IAAAA,OAAAA;AAH2B,GAAd,CAAf,CAAA;AAMA,EAAA,IAAIX,WAAJ,EAAiBsB,MAAM,CAACtB,WAAP,GAAqBA,WAArB,CAAA;AACjB,EAAA,IAAIC,qBAAJ,EACEqB,MAAM,CAACrB,qBAAP,GAA+BA,qBAA/B,CAAA;AACF,EAAA,IAAIE,YAAJ,EAAkBmB,MAAM,CAACnB,YAAP,GAAsBA,YAAtB,CAAA;AAClB,EAAA,IAAIC,sBAAJ,EACEkB,MAAM,CAAClB,sBAAP,GAAgCA,sBAAhC,CAAA;AACF,EAAA,IAAIC,qBAAJ,EACEiB,MAAM,CAACjB,qBAAP,GAA+BA,qBAA/B,CAAA;AAEF,EAAA,OAAOiB,MAAP,CAAA;AACD;;AC/CD,MAAME,iBAAiB,GAAG,CAA1B;AAEA;AACA;;AACA,MAAMC,OAAO,GAAGC,OAAO,CAACC,aAAR,CAAsB;AACpCC,EAAAA,IAAI,EAAEC,KAAK,IAAIC,kBAAkB,CAACD,KAAD,CADG;AAEpCE,EAAAA,KAAK,EAAEF,KAAK,IAAIG,kBAAkB,CAACH,KAAD,CAAA;AAFE,CAAtB,CAAhB,CAAA;;AAKO,MAAMI,YAAN,CAAmB;EACR,OAATC,SAAS,CAACC,IAAD,EAAO;AACrB,IAAA,IAAIC,MAAM,GAAGX,OAAO,CAACY,GAAR,CAAYF,IAAZ,CAAb,CAAA;;AACA,IAAA,IAAI,OAAOC,MAAP,IAAiB,WAArB,EAAkC;AAChC,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAA,OAAOA,MAAP,CAAA;AACD,GAAA;;EAEe,OAATE,SAAS,CAACH,IAAD,EAAON,KAAP,EAAcU,UAAU,GAAGf,iBAA3B,EAA8C;AAC5De,IAAAA,UAAU,KAAK,CAAf,GACId,OAAO,CAACe,GAAR,CAAYL,IAAZ,EAAkBN,KAAlB,CADJ,GAEIJ,OAAO,CAACe,GAAR,CAAYL,IAAZ,EAAkBN,KAAlB,EAAyB;AAAEY,MAAAA,OAAO,EAAEF,UAAAA;AAAX,KAAzB,CAFJ,CAAA;AAGD,GAAA;;EAEkB,OAAZG,YAAY,CAACP,IAAD,EAAO;IACxBV,OAAO,CAACkB,MAAR,CAAeR,IAAf,CAAA,CAAA;AACD,GAAA;;AAjBuB;;ACX1B,MAAMS,SAAO,GAAG,OAAOC,MAAP,IAAiB,WAAjB,GAA+BA,MAA/B,GAAwCC,MAAxD,CAAA;AACA,MAAMC,WAAW,GACfC,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,aAAzB,GACIC,WAAW,KAAK,MAAA;AAAO;AAD3B,EAEIP,SAAO,CAACO,WAAR,KAAwB,MAH9B,CAAA;AAKA,MAAMC,OAAO,GAAGxC,OAAhB,CAAA;AAAyB;;AAElB,MAAMyC,iBAAiB,GAC5B,OAAOR,MAAP,KAAkB,WAAlB,GACI;AACES,EAAAA,SAAS,EAAG,CAAA,EAAEF,OAAO,CAACtC,GAAI,CAD5B,cAAA,CAAA;AAEEyC,EAAAA,SAAS,EAAE,mBAFb;AAGEC,EAAAA,YAAY,EAAEX,MAAM,CAACY,QAAP,CAAgBC,QAAhB,EAHhB;AAIEC,EAAAA,wBAAwB,EAAEd,MAAM,CAACY,QAAP,CAAgBC,QAAhB,EAJ5B;AAKEE,EAAAA,aAAa,EAAE,UALjB;AAMEC,EAAAA,KAAK,EAAE,QANT;AAOEC,EAAAA,oBAAoB,EAAE,KAAA;AAPxB,CADJ,GAUI,EAXC,CAAA;AAaA,MAAMC,iBAAiB,GAAG,MAAM7C,MAAN,IAAgB;AAC/C,EAAA,IAAI,OAAO2B,MAAP,KAAkB,WAAlB,IAAiCE,WAArC,EAAkD;IAChD,IAAI;MACF,MAAM;AAAEiB,QAAAA,WAAAA;AAAF,OAAA,GAAkB,MAAM;AAC5B;AAAqC,MAAA,aADT,CAA9B,CAAA;AAGA,MAAA,OAAO,IAAIA,WAAJ,CAAgB9C,MAAhB,CAAP,CAAA;KAJF,CAKE,OAAO+C,CAAP,EAAU;AACV;AACAC,MAAAA,OAAO,CAACC,GAAR,CAAY,kCAAZ,EAAgDF,CAAhD,CAAA,CAAA;AACD,KAAA;GATH,MAUO,OAAO,EAAP,CAAA;AACR,CAZM;AAgBP;;ACrCA;AASO,MAAMG,YAAY,GAAG,sBAArB,CAAA;AACA,MAAMC,oBAAoB,GAAG,cAA7B,CAAA;AAEP,MAAMzB,OAAO,GAAG,OAAOC,MAAP,IAAiB,WAAjB,GAA+BA,MAA/B,GAAwCC,MAAxD,CAAA;AAEO,MAAMwB,WAAN,CAAkB;AASD,EAAA,OAAfC,eAAe,CAAC;IAAElE,qBAAF;AAAyBF,IAAAA,YAAAA;AAAzB,GAAD,EAA0C;IAC9D+D,OAAO,CAACM,IAAR,CACE,kBADF,EAEEJ,YAFF,EAGE/D,qBAHF,EAIEgE,oBAJF,EAKElE,YALF,CAAA,CAAA;IAOA,IAAIE,qBAAJ,EACE4B,YAAY,CAACK,SAAb,CAAuB8B,YAAvB,EAAqC/D,qBAArC,CAAA,CAAA;IACF,IAAIF,YAAJ,EACE8B,YAAY,CAACK,SAAb,CAAuB+B,oBAAvB,EAA6ClE,YAA7C,CAAA,CAAA;AACH,GAAA;;AAE0B,EAAA,OAApBsE,oBAAoB,GAAG;IAC5B,OAAO;AACLzE,MAAAA,WAAW,EAAE,IADR;AAELC,MAAAA,qBAAqB,EAAE,IAFlB;AAGLE,MAAAA,YAAY,EAAE8B,YAAY,CAACC,SAAb,CAAuBmC,oBAAvB,CAHT;AAILjE,MAAAA,sBAAsB,EAAE,IAJnB;AAKLC,MAAAA,qBAAqB,EAAE4B,YAAY,CAACC,SAAb,CAAuBkC,YAAvB,CAAA;KALzB,CAAA;AAOD,GAAA;;AAE4B,EAAA,OAAtBM,sBAAsB,GAAG;IAC9BzC,YAAY,CAACS,YAAb,CAA0B0B,YAA1B,CAAA,CAAA;IACAnC,YAAY,CAACS,YAAb,CAA0B2B,oBAA1B,CAAA,CAAA;;IAEA,IAAIC,WAAW,CAACnB,WAAZ,IAA2B,OAAON,MAAP,KAAkB,WAAjD,EAA8D;AAC5D;MACA,MAAM;AAAE8B,QAAAA,YAAAA;AAAF,OAAA,GAAmB9B,MAAzB,CAAA;MACA,MAAM+B,IAAI,GAAG,EAAb,CAAA;;AACA,MAAA,KAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,YAAY,CAACG,MAAjC,EAAyCD,CAAC,EAA1C,EAA8C;AAC5C,QAAA,MAAME,GAAG,GAAGJ,YAAY,CAACI,GAAb,CAAiBF,CAAjB,CAAZ,CAAA;QACA,IAAI,OAAOE,GAAP,KAAe,QAAf,IAA2BA,GAAG,CAACC,UAAJ,CAAe,OAAf,CAA/B,EACEJ,IAAI,CAACK,IAAL,CAAUN,YAAY,CAACI,GAAb,CAAiBF,CAAjB,CAAV,CAAA,CAAA;AACH,OAAA;;MACDD,IAAI,CAACM,OAAL,CAAaH,GAAG,IAAIJ,YAAY,CAACQ,UAAb,CAAwBJ,GAAxB,CAApB,CAAA,CAAA;AACD,KAAA;AACF,GAAA;;AAEqB,EAAA,aAATK,SAAS,CAAC;IAAE3E,QAAF;IAAYC,QAAZ;AAAsBX,IAAAA,iBAAAA;AAAtB,GAAD,EAA4C;IAChE,IAAIsF,WAAW,GAAGtF,iBAAlB,CAAA;AACA,IAAA,IAAIuF,mBAAmB,GAAG;AACxBvF,MAAAA,iBAAiB,EAAE,IADK;AAExBwF,MAAAA,eAAe,EAAE,KAFO;AAGxBC,MAAAA,qBAAqB,EAAE,KAHC;AAIxBC,MAAAA,OAAO,EAAE,KAAA;KAJX,CAAA;AAMA,IAAA,IAAIC,eAAJ,CAAA;AACA,IAAA,IAAIC,IAAJ,CAAA;;IAEA,IAAIlF,QAAQ,IAAIC,QAAhB,EAA0B;AACxB;MACAgF,eAAe,GAAG,MAAMlF,sBAAsB,CAAC;QAC7CC,QAD6C;AAE7CC,QAAAA,QAAAA;OAF4C,CAA9C,CAFwB;;AAQxB,MAAA,MAAM,CAACkF,UAAD,EAAaC,iBAAb,IAAkC,MAAMC,EAAE,CAC9CJ,eAAe,CAACK,iBAAhB,EAD8C,CAAhD,CARwB;;AAaxB,MAAA,IAAIH,UAAJ,EAAgB;AACdN,QAAAA,mBAAmB,GAAG;AACpBvF,UAAAA,iBAAiB,EAAE,IADC;AAEpBiG,UAAAA,YAAY,EAAEJ,UAAU,CAACK,OAAX,IAAsB,IAFhB;AAGpBV,UAAAA,eAAe,EAAE,KAHG;UAIpBC,qBAAqB,EAAEI,UAAU,CAACzD,IAAX,CAAgB+D,QAAhB,CACrB,8BADqB,CAJH;AAOpBT,UAAAA,OAAO,EAAE,IAAA;SAPX,CAAA;AASAnB,QAAAA,WAAW,CAACI,sBAAZ,EAAA,CAAA;AACD,OAxBuB;;;AA2BxB,MAAA,IAAImB,iBAAJ,EAAuB;AACrB;AACAR,QAAAA,WAAW,GAAGc,oBAAoB,CAACT,eAAD,CAAlC,CAAA;QACApB,WAAW,CAACC,eAAZ,CAA4Bc,WAA5B,CAAA,CAAA;AACAC,QAAAA,mBAAmB,GAAG;AACpBvF,UAAAA,iBAAiB,EAAEsF,WADC;AAEpBE,UAAAA,eAAe,EAAE,IAFG;AAGpBC,UAAAA,qBAAqB,EAAE,KAHH;AAIpBC,UAAAA,OAAO,EAAE,KAAA;SAJX,CAAA;AAMD,OAAA;AACF,KAjD+D;AAoDhE;AACA;;;AACA,IAAA,IAAIJ,WAAJ,EAAiB;MACf,MAAM/D,MAAM,GACVoE,eAAe,KAAK,MAAMlF,sBAAsB,CAAC6E,WAAD,CAAjC,CADjB,CAAA;MAEA,MAAM,CAACe,KAAD,EAAQC,WAAR,CAAA,GAAuB,MAAM/B,WAAW,CAACgC,cAAZ,CAA2BhF,MAA3B,CAAnC,CAAA;;AAEA,MAAA,IAAI8E,KAAJ,EAAW;AACTd,QAAAA,mBAAmB,GAAG;AACpBvF,UAAAA,iBAAiB,EAAE,IADC;UAEpBiG,YAAY,EAAEI,KAAK,CAACH,OAFA;AAGpBV,UAAAA,eAAe,EAAE,KAHG;AAIpBC,UAAAA,qBAAqB,EAAE,KAJH;AAKpBC,UAAAA,OAAO,EAAE,IAAA;SALX,CAAA;AAOAnB,QAAAA,WAAW,CAACI,sBAAZ,EAAA,CAAA;AACD,OATD,MASO;AACL;AACA,QAAA,MAAM6B,iBAAiB,GAAGJ,oBAAoB,CAAC7E,MAAD,CAA9C,CAAA;QACAgD,WAAW,CAACC,eAAZ,CAA4BgC,iBAA5B,CAAA,CAAA;AAEAZ,QAAAA,IAAI,GAAGU,WAAP,CAAA;AACAf,QAAAA,mBAAmB,GAAG;AACpBvF,UAAAA,iBAAiB,EAAEwG,iBADC;AAEpBhB,UAAAA,eAAe,EAAE,IAFG;AAGpBC,UAAAA,qBAAqB,EAAE,KAHH;AAIpBC,UAAAA,OAAO,EAAE,KAAA;SAJX,CAAA;AAMD,OAAA;AACF,KAAA;;IAED,OAAO;MAAEH,mBAAF;AAAuBK,MAAAA,IAAAA;KAA9B,CAAA;AACD,GAAA;;EA2BgB,OAAVa,UAAU,CAACC,YAAD,EAAe;AAC9BnC,IAAAA,WAAW,CAACI,sBAAZ,EAAA,CAAA;;IACA,IAAIJ,WAAW,CAACnB,WAAhB,EAA6B;MAC3BmB,WAAW,CAACoC,WAAZ,CAAwBD,YAAxB,CAAA,CAAA;AACD,KAFD,MAEO;MACL,IAAIA,YAAJ,EAAkBnC,WAAW,CAACqC,oBAAZ,CAAiCF,YAAjC,CAAlB,CAAA,KACKnC,WAAW,CAACsC,0BAAZ,EAAA,CAAA;AACN,KAAA;AACF,GAAA;;EAE0B,OAApBC,oBAAoB,CAACpD,QAAD,EAAW;AACpC,IAAA,IAAI,OAAOZ,MAAP,IAAiB,WAArB,EAAkC;MAChC,IAAIiE,GAAG,GAAG,GAAV,CAAA;;AACA,MAAA,IAAIrD,QAAJ,EAAc;QACZ,MAAM;UAAEsD,MAAF;AAAUC,UAAAA,IAAAA;AAAV,SAAA,GAAmBvD,QAAzB,CAAA;QACAqD,GAAG,GAAGC,MAAM,GAAI,CAAA,EAAED,GAAI,CAAEC,EAAAA,MAAO,CAAnB,CAAA,GAAuBD,GAAnC,CAAA;QACAA,GAAG,GAAGE,IAAI,GAAI,CAAA,EAAEF,GAAI,CAAEE,EAAAA,IAAK,CAAjB,CAAA,GAAqBF,GAA/B,CAAA;AACD,OAAA;;AACDjE,MAAAA,MAAM,CAACY,QAAP,CAAgBwD,IAAhB,GAAuBH,GAAvB,CAAA;AACD,KAAA;AACF,GAAA;;EAEsC,aAA1BF,0BAA0B,CAACH,YAAD,EAAe;IACpD,IAAInC,WAAW,CAACnB,WAAhB,EAA6B;MAC3B,MAAMmB,WAAW,CAACoC,WAAZ,EAAN,CAAA;MACA,MAAMpC,WAAW,CAAC4C,UAAZ,EAAN,CAAA;AACD,KAHD,MAGO;AACL;AACA,MAAA,IAAIJ,GAAG,GAAGxC,WAAW,CAAC6C,WAAtB,CAAA;MACA,IAAI,OAAOV,YAAP,KAAwB,QAA5B,EACEK,GAAG,GAAI,CAAEA,EAAAA,GAAI,CAAgBL,cAAAA,EAAAA,YAAa,CAA1C,CAAA,CAAA;AACF,MAAA,IACE,OAAOhD,QAAP,KAAoB,WAApB,IACAgD,YAAY,KAAKnC,WAAW,CAAC6C,WAF/B,EAIE1D,QAAQ,CAAC2D,OAAT,CAAiBN,GAAjB,CAAA,CAAA;AACH,KAAA;AACF,GAAA;;EAEsC,OAAhCO,gCAAgC,CAACC,YAAD,EAAe;AACpD,IAAA,IAAIR,GAAG,GAAGxC,WAAW,CAACiD,mBAAtB,CAAA;IACA,IAAID,YAAY,KAAKR,GAArB,EAA0B,OAAA;IAE1B,IAAI,OAAOQ,YAAP,KAAwB,QAA5B,EACER,GAAG,GAAI,CAAEA,EAAAA,GAAI,CAAgBQ,cAAAA,EAAAA,YAAa,CAA1C,CAAA,CAAA;IACF,IAAI,OAAO7D,QAAP,KAAoB,WAAxB,EAAqCA,QAAQ,CAACwD,IAAT,GAAgBH,GAAhB,CAAA;AACtC,GAAA;;EAE0B,OAApBH,oBAAoB,CAACF,YAAD,EAAe;AACxC,IAAA,IAAI,OAAOA,YAAP,KAAwB,QAA5B,EAAsC;MACpC,IAAI,OAAOhD,QAAP,KAAoB,WAAxB,EAAqCZ,MAAM,CAACY,QAAP,CAAgBwD,IAAhB,GAAuBR,YAAvB,CAAA;KADvC,MAEOnC,WAAW,CAACuC,oBAAZ,EAAA,CAAA;AACR,GAAA;;EAEsB,aAAVK,UAAU,CAACM,WAAD,EAAc;AACnC,IAAA,MAAMC,WAAW,GAAG,MAAM1D,iBAAiB,CAACV,iBAAD,CAA3C,CAAA;IACAoE,WAAW,CAACC,cAAZ,CAA2B;AACzB7D,MAAAA,KAAK,EAAE,QADkB;AAEzBD,MAAAA,aAAa,EAAE,UAFU;AAGzBJ,MAAAA,YAAY,EAAEgE,WAAW,IAAI3E,MAAM,CAACY,QAAP,CAAgBC,QAAhB,EAAA;KAH/B,CAAA,CAAA;AAKD,GAAA;;AAE8B,EAAA,OAAxBiE,wBAAwB,GAAG;IAChC,MAAMC,MAAM,GAAG,IAAIC,eAAJ,CAAoBhF,MAAM,CAACY,QAAP,CAAgBsD,MAApC,CAAf,CAAA;;AACA,IAAA,IAAIa,MAAM,CAACE,GAAP,CAAW,eAAX,CAAA,IAA+BF,MAAM,CAACE,GAAP,CAAW,eAAX,CAAnC,EAAgE;MAC9DF,MAAM,CAACG,MAAP,CAAc,eAAd,CAAA,CAAA;MACAH,MAAM,CAACG,MAAP,CAAc,eAAd,CAAA,CAAA;AACAlF,MAAAA,MAAM,CAACY,QAAP,GAAmB,GAAEZ,MAAM,CAACY,QAAP,CAAgBuE,QAAS,GAC5CJ,MAAM,CAAClE,QAAP,EAAqB,GAAA,CAAA,CAAA,EAAGkE,MAAO,CAA/B,CAAA,GAAmC,EACpC,CAFD,CAAA,CAAA;AAGD,KAAA;AACF,GAAA;;EAEuB,aAAXlB,WAAW,CAACD,YAAD,EAAe;AACrC,IAAA,MAAMwB,KAAK,CACR,CAAA,EAAE3D,WAAW,CAAC4D,OAAQ,gDADd,EAET;AACE7C,MAAAA,WAAW,EAAE,SAAA;AADf,KAFS,CAAX,CAAA;;AAMA,IAAA,IAAIoB,YAAJ,EAAkB;MAChB5D,MAAM,CAACY,QAAP,GAAkBgD,YAAlB,CAAA;AACD,KAFD,MAEO;AACL;AACA;AACAnC,MAAAA,WAAW,CAACqD,wBAAZ,EAAA,CAAA;AACD,KAAA;AACF,GAAA;;EAE0C,aAA9BQ,8BAA8B,CAACC,aAAD,EAAgB;AACzD,IAAA,MAAM,CAAChC,KAAD,EAAQiC,QAAR,IAAoB,MAAMvC,EAAE,CAChCmC,KAAK,CAAE,CAAE3D,EAAAA,WAAW,CAAC4D,OAAQ,0CAAxB,EAAmE;AACtEI,MAAAA,MAAM,EAAE,MAD8D;AAEtEC,MAAAA,OAAO,EAAE;AACPC,QAAAA,MAAM,EAAE,kBADD;QAEP,cAAgB,EAAA,kBAAA;OAJoD;AAMtEC,MAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAe;QACnBP,aAAa,EAAEpG,kBAAkB,CAACoG,aAAD,CAAA;OAD7B,CAAA;AANgE,KAAnE,CAD2B,CAAlC,CAAA;IAYA,IAAIhC,KAAJ,EAAW,OAAO,CAAC;AAAEH,MAAAA,OAAO,EAAE,6BAAA;AAAX,KAAD,CAAP,CAAA;;IACX,IAAIoC,QAAQ,CAACO,EAAb,EAAiB;AACf,MAAA,MAAM,CAACC,UAAD,EAAaJ,IAAb,CAAqB,GAAA,MAAM3C,EAAE,CAACuC,QAAQ,CAACS,IAAT,EAAD,CAAnC,CAAA;AACA,MAAA,IAAID,UAAJ,EAAgB,OAAO,CAACA,UAAD,CAAP,CAAA;MAEhB,MAAM;QAAEE,WAAF;AAAeC,QAAAA,eAAe,GAAG,EAAA;AAAjC,OAAA,GAAwCP,IAA9C,CAAA;;MACA,IAAIM,WAAW,KAAK,CAApB,EAAuB;AACrB,QAAA,OAAO,CACL;AAAE9C,UAAAA,OAAO,EAAE,2BAAX;AAAwCgD,UAAAA,IAAI,EAAED,eAAAA;AAA9C,SADK,CAAP,CAAA;AAGD,OAAA;;AACD,MAAA,IAAIA,eAAe,CAAClE,MAAhB,GAAyB,CAA7B,EAAgC;AAC9B,QAAA,IAAI3E,YAAJ,CAAA;AACA6I,QAAAA,eAAe,CAAC9D,OAAhB,CAAwBgE,IAAI,IAAI;UAC9B,IAAIA,IAAI,CAACC,GAAL,KAAa,+BAAjB,EACEhJ,YAAY,GAAG+I,IAAI,CAACE,KAApB,CAAA;SAFJ,CAAA,CAAA;;QAIA,IAAI,CAACjJ,YAAL,EAAmB;AACjB,UAAA,OAAO,CACL;AACE8F,YAAAA,OAAO,EACL,iEAAA;AAFJ,WADK,CAAP,CAAA;AAMD,SAAA;;AACD,QAAA,OAAO,CAACoD,SAAD,EAAYlJ,YAAZ,CAAP,CAAA;AACD,OAfD,MAeO;AACL,QAAA,OAAO,CACL;AACE8F,UAAAA,OAAO,EACL,iEAAA;AAFJ,SADK,CAAP,CAAA;AAMD,OAAA;AACF,KAjCD,MAiCO;AACL,MAAA,OAAO,CACL;QACEA,OAAO,EAAG,4BAA2BoC,QAAQ,CAACiB,MAAO,CAAGjB,CAAAA,EAAAA,QAAQ,CAACkB,UAAW,CAAA,CAAA;AAD9E,OADK,CAAP,CAAA;AAKD,KAAA;AACF,GAAA;;EAEqB,OAAfC,eAAe,CAACC,KAAD,EAAQ;AAC5B,IAAA,MAAMC,SAAS,GAAG,CAAC,WAAD,EAAc,YAAd,CAAlB,CAAA;AAEA,IAAA,OAAOA,SAAS,CAACC,IAAV,CAAeC,QAAQ,IAAI;AAChC,MAAA,IAAIH,KAAK,CAACvD,QAAN,CAAe0D,QAAf,CAAJ,EAA8B;AAC5B,QAAA,OAAO,IAAP,CAAA;AACD,OAAA;AACF,KAJM,CAAP,CAAA;AAKD,GAAA;;AA3TsB,CAAA;AAAZtF,YACJ4D,UAAUtH,OAAO,CAACE,GAAAA;AAAI;;AADlBwD,YAEJnB,cACLH,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,aAAzB,GACIC,WAAW,KAAK,MAAA;AAAO;AAD3B,EAEIP,OAAO,CAACO,WAAR,KAAwB;AALnBmB,YAMJ6C,cAAc;AANV7C,YAOJiD,sBAAsB;;AAPlBjD,YAwIJgC,iBAAiB,MAAMhF,MAAN,IAAgB;AACtC,EAAA,IAAIuI,SAAJ;AAAA,MACEC,WADF;MAEEnE,IAAI,GAAG,EAFT;AAAA,MAGEoE,YAHF,CAAA;AAKA,EAAA,CAACF,SAAD,EAAYlE,IAAZ,CAAA,GAAoB,MAAMG,EAAE,CAACxE,MAAM,CAAC0I,QAAP,CAAgBC,KAAhB,CAAsBC,UAAtB,EAAD,CAA5B,CAAA;;AACA,EAAA,IAAIvE,IAAI,IAAIA,IAAI,CAAC1E,EAAjB,EAAqB;AACnB,IAAA,CAAC6I,WAAD,EAAcC,YAAd,CAAA,GAA8B,MAAMjE,EAAE,CACpCxE,MAAM,CAAC0I,QAAP,CAAgBC,KAAhB,CAAsBE,aAAtB,CAAoC;MAClCC,MAAM,EAAEzE,IAAI,CAAC1E,EADqB;AAElCoJ,MAAAA,gBAAgB,EAAE,IAAA;KAFpB,CADoC,CAAtC,CADmB;AAQnB;;AACA,IAAA,IAAIN,YAAY,IAAIA,YAAY,CAACO,KAAjC,EAAwC3E,IAAI,CAAC4E,MAAL,GAAcR,YAAY,CAACO,KAA3B,CATrB;AAYnB;;AACA,IAAA,IAAIR,WAAJ,EAAiB5F,OAAO,CAACC,GAAR,CAAY2F,WAAZ,CAAA,CAAA;AAClB,GAAA;;AACD,EAAA,OAAO,CAACD,SAAD,EAAYlE,IAAZ,CAAP,CAAA;AACD;;ACrJU6E,MAAAA,UAAU,GAAG,CACxBC,SAAS,CAACC,UAAD,EAAaC,aAAb,CADe,EAExBF,SAAS,CAACG,WAAD,EAAcC,cAAd,CAFe,EAGxBJ,SAAS,CAACK,aAAD,EAAgBC,gBAAhB,CAHe,EAIxBN,SAAS,CAACO,wBAAD,EAA2BC,gCAA3B,CAJe,EAAnB;AAOA,UAAUC,uBAAV,CAAkCC,MAAlC,EAA0C;AAAA,EAAA,IAAA,UAAA,CAAA;;EAC/C,MAAM;IACJC,KADI;IAEJC,YAFI;AAGJC,IAAAA,MAAM,EAAE;AAAE5L,MAAAA,mBAAAA;KAHN;AAIJ6L,IAAAA,WAAAA;AAJI,GAAA,GAKFJ,MALJ,CAAA;EAMA,IAAIK,YAAY,GAAG,MAAMC,MAAM,CAACC,yBAAD,CAA/B,CAP+C;;EAU/C,MAAMC,SAAS,GAAGC,WAAW,CAAC,MAAMH,MAAM,CAACI,mBAAD,CAAb,CAA7B,CAAA;EACA,MAAMzD,aAAa,GAAGuD,SAAS,CAACvD,aAAV,IAA2BuD,SAAS,CAACG,aAA3D,CAX+C;;EAc/C,MAAM;AAAET,IAAAA,YAAY,EAAEU,SAAAA;AAAhB,GAAA,GAA+BR,WAAW,IAAIA,WAAW,CAACS,KAA5B,IAAsC,EAA1E,CAAA;EACA,MAAM;AAAEX,IAAAA,YAAY,EAAEY,eAAAA;GACnBb,GAAAA,KAAK,IACJ3L,sBAAsB,CAACC,mBAAD,EAAsB0L,KAAtB,aAAsBA,KAAtB,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,CAAA,UAAA,GAAsBA,KAAK,CAAEc,GAA7B,+CAAsB,UAAYvM,CAAAA,aAAlC,CADxB,IAEA,EAHF,CAf+C;AAqB/C;;AACA,EAAA,MAAMwM,mBAAmB,GAAG,CAC1B,IAAKC,KAAK,CAACC,OAAN,CAAcJ,eAAd,CAAA,IAAkCA,eAAnC,IAAuD,EAA3D,CAD0B,EAE1B,IAAKG,KAAK,CAACC,OAAN,CAAcN,SAAd,KAA4BA,SAA7B,IAA2C,EAA/C,CAF0B,EAG1B,IAAKK,KAAK,CAACC,OAAN,CAAchB,YAAd,CAAA,IAA+BA,YAAhC,IAAiD,EAArD,CAH0B,CAA5B,CAAA;AAKA,EAAA,MAAMiB,kBAAkB,GAAG,CAAC,CAACL,eAAF,IAAqB,CAAC,CAACF,SAAvB,IAAoC,CAAC,CAACV,YAAjE,CAAA;;EAEA,IAAI,CAACG,YAAL,EAAmB;AACjB;AACA;AACA,IAAA,IAAIc,kBAAJ,EAAwB;AACtB;AACAd,MAAAA,YAAY,GAAG,MAAMe,IAAI,CAACxB,gBAAD,EAAmB;AAAE3C,QAAAA,aAAAA;AAAF,OAAnB,CAAzB,CAAA;AACD,KAHD;SAKK,MAAMoE,GAAG,CAAC;AAAEC,MAAAA,IAAI,EAAE3B,aAAR;AAAuB1C,MAAAA,aAAAA;AAAvB,KAAD,CAAT,CAAA;AACN,GAAA;;AAED,EAAA,IAAIkE,kBAAJ,EAAwB;AACtB;AACA;AACA,IAAA,IAAI,CAACd,YAAD,IAAiB,CAACpD,aAAtB,EAAqC;AACnC9D,MAAAA,WAAW,CAACsC,0BAAZ,CAAuCuE,MAAM,CAAC1H,QAAP,CAAgBuE,QAAvD,CAAA,CAAA;AACD,KAFD,MAEO,IAAImE,mBAAmB,CAACrH,MAApB,GAA6B,CAAjC,EAAoC;MACzC,MAAM4H,UAAU,GAAG,MAAMjB,MAAM,CAACkB,gBAAD,EAAmB,IAAnB,CAA/B,CAAA;AACA,MAAA,MAAMC,UAAU,GAAGC,cAAc,CAACH,UAAD,EAAaP,mBAAb,CAAjC,CAAA;MAEA,IAAI,CAACS,UAAL,EACEtI,WAAW,CAAC+C,gCAAZ,CAA6C8D,MAAM,CAAC1H,QAAP,CAAgBuE,QAA7D,CAAA,CAAA;AACH,KAAA;AACF,GAAA;AACF,CAAA;;AAED,UAAU+C,gBAAV,CAA2B;AAAE3C,EAAAA,aAAAA;AAAF,CAA3B,EAA8C;AAC5C;AACA,EAAA,IAAIrI,iBAAiB,GAAGuE,WAAW,CAACG,oBAAZ,EAAxB,CAAA;;AAEA,EAAA,IAAI2D,aAAa,IAAIrI,iBAAiB,CAACI,YAAvC,EAAqD;AACnD;AACA;AACA;AACA,IAAA,MAAMqM,GAAG,CAAC;AACRC,MAAAA,IAAI,EAAEzB,wBADE;AAER1F,MAAAA,mBAAmB,EAAE;AACnBwH,QAAAA,SAAS,EAAE,IAAA;AADQ,OAAA;KAFd,CAAT,CAJmD;AAWnD;;IACA,MAAM,CAAC1G,KAAD,EAAQjG,YAAR,CAAA,GACJ,MAAMmE,WAAW,CAAC6D,8BAAZ,CAA2CC,aAA3C,CADR,CAAA;;AAEA,IAAA,IAAIjI,YAAJ,EAAkB;AAChB;MACAmE,WAAW,CAACC,eAAZ,CAA4B;AAC1BlE,QAAAA,qBAAqB,EAAE+H,aADG;AAE1BjI,QAAAA,YAAAA;OAFF,CAAA,CAAA;AAIAJ,MAAAA,iBAAiB,GAAGuE,WAAW,CAACG,oBAAZ,EAApB,CAAA;AACD,KArBkD;;;IAwBnD,IAAI1E,iBAAiB,CAACI,YAAtB,EACE,MAAMoM,IAAI,CAAC5B,aAAD,EAAgB;AAAE5K,MAAAA,iBAAAA;KAAlB,CAAV,CADF,KAEK,IAAIqG,KAAJ,EACH,MAAMoG,GAAG,CAAC;AACRC,MAAAA,IAAI,EAAEzB,wBADE;AAER1F,MAAAA,mBAAmB,EAAE;AACnBG,QAAAA,OAAO,EAAE,IADU;AAEnBO,QAAAA,YAAY,EACV,CAAAI,KAAK,SAAL,IAAAA,KAAK,WAAL,GAAAA,KAAAA,CAAAA,GAAAA,KAAK,CAAEH,OAAP,KACCG,KAAK,IAAI,UAAA,IAAcA,KAAvB,IAAgCA,KAAK,CAAC1C,QAAN,EAAA;AAJhB,OAAA;AAFb,KAAD,CAAT,CAAA;AASH,GAxC2C;;;AA2C5C,EAAA,OAAO,MAAM+H,MAAM,CAACC,yBAAD,CAAnB,CAAA;AACD,CAAA;;AAED,UAAUf,aAAV,CAAwBQ,MAAM,GAAG,EAAjC,EAAqC;EACnC,MAAM;IAAE1K,QAAF;IAAYC,QAAZ;AAAsBX,IAAAA,iBAAAA;GAAsBoL,GAAAA,MAAlD,CADmC;AAInC;;AACA,EAAA,IAAIA,MAAM,CAACsB,IAAP,KAAgB/B,UAAhB,IAA8BpG,WAAW,CAACnB,WAA9C,EACEmB,WAAW,CAACsC,0BAAZ,EAAA,CAAA;EAEF,MAAM;IAAEtB,mBAAF;AAAuBK,IAAAA,IAAAA;AAAvB,GAAA,GAAgC,MAAMrB,WAAW,CAACc,SAAZ,CAAsB;IAChE3E,QADgE;IAEhEC,QAFgE;AAGhEX,IAAAA,iBAAAA;AAHgE,GAAtB,CAA5C,CAAA;AAMA,EAAA,MAAMyM,GAAG,CAAC;AACRC,IAAAA,IAAI,EAAEzB,wBADE;IAER1F,mBAFQ;AAGRK,IAAAA,IAAAA;AAHQ,GAAD,CAAT,CAAA;AAKD,CAAA;;AACD,MAAMoH,kBAAkB,GAAGC,IAAI,IAAI;AACjC;EACA9I,OAAO,CAACC,GAAR,CAAY6I,IAAZ,CAAA,CAAA;AACA,EAAA,MAAMC,YAAY,GAAG,GAAA,GAAMD,IAAI,CAACE,KAAL,CAAW,GAAX,CAAA,CAAgBC,MAAhB,CAAuB,CAAvB,CAA0BC,CAAAA,IAA1B,CAA+B,GAA/B,CAA3B,CAHiC;;EAKjClJ,OAAO,CAACC,GAAR,CAAY8I,YAAZ,CAAA,CAAA;AACA,EAAA,OAAOA,YAAP,CAAA;AACD,CAPD,CAAA;;AASA,UAAUhC,gCAAV,GAA6C;AAC3C,EAAA,MAAMoC,UAAU,GAAG,MAAM5B,MAAM,CAACC,yBAAD,CAA/B,CAAA;EACA,MAAM;AAAElI,IAAAA,YAAY,EAAEiD,YAAhB;AAA8B6G,IAAAA,SAAS,EAAEC,iBAAAA;AAAzC,GAAA,GACJ3B,WAAW,CAAC,MAAMH,MAAM,CAACI,mBAAD,CAAb,CADb,CAAA;;EAGA,IAAIwB,UAAU,IAAIE,iBAAd,IAAmC,OAAO1K,MAAP,IAAiB,WAAxD,EAAqE;AACnE,IAAA,MAAMmK,IAAI,GAAGD,kBAAkB,CAACQ,iBAAD,CAA/B,CADmE;AAGnE;;AACA1K,IAAAA,MAAM,CAACY,QAAP,CAAgBwD,IAAhB,GAAuB+F,IAAvB,CAJmE;AAMpE,GAND,MAMO,IAAIK,UAAU,IAAI5G,YAAlB,EAAgC;AACrC,IAAA,MAAM+F,GAAG,CAACgB,QAAQ,CAAC/G,YAAD,CAAT,CAAT,CAAA;AACD,GAAA;AACF,CAAA;;AAED,UAAUoE,cAAV,CAAyB;AAAEpE,EAAAA,YAAAA;AAAF,CAAzB,EAA2C;AACzC,EAAA,MAAM+F,GAAG,CAAC;AACRC,IAAAA,IAAI,EAAEzB,wBADE;AAERrF,IAAAA,IAAI,EAAE,IAAA;AAFE,GAAD,CAAT,CAAA;AAIA,EAAA,MAAMrB,WAAW,CAACkC,UAAZ,CAAuBC,YAAvB,CAAN,CAAA;AACD,CAAA;;AAEM,UAAUgH,oBAAV,GAAiC;EACtC,MAAM1N,iBAAiB,GAAG,MAAM0L,MAAM,CAACiC,uBAAD,EAA0B,IAA1B,CAAtC,CAAA;;EACA,IAAIC,MAAM,CAAC/I,IAAP,CAAY7E,iBAAZ,CAA+B+E,CAAAA,MAA/B,GAAwC,CAA5C,EAA+C;AAC7C,IAAA,MAAMxD,MAAM,GAAG,MAAMd,sBAAsB,CAACT,iBAAD,CAA3C,CAAA;IACA,MAAMuB,MAAM,CAACsM,YAAP,EAAN,CAAA;AAEA,IAAA,MAAMpB,GAAG,CAAC;AACRC,MAAAA,IAAI,EAAEzB,wBADE;AAER1F,MAAAA,mBAAmB,EAAE;QACnBvF,iBAAiB,EAAEoG,oBAAoB,CAAC7E,MAAD,CAAA;AADpB,OAAA;AAFb,KAAD,CAAT,CAAA;AAMD,GAAA;AACF;;;;"}