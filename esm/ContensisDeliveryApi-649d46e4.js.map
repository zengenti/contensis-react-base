{"version":3,"file":"ContensisDeliveryApi-649d46e4.js","sources":["../src/util/LruCache.js","../src/util/CachedDeliveryApi.ts","../src/util/ContensisDeliveryApi.ts"],"sourcesContent":["class CacheNode {\n  constructor(key, value) {\n    this.key = key;\n    this.value = value;\n    this.next = null;\n    this.prev = null;\n  }\n}\n\nexport class LruCache {\n  constructor(limit = 100) {\n    this.map = {};\n    this.head = null;\n    this.tail = null;\n    this.limit = limit || 100;\n    this.size = 0;\n  }\n\n  get(key) {\n    if (this.map[key]) {\n      let value = this.map[key].value;\n      let node = new CacheNode(key, value);\n      this.remove(key);\n      this.setHead(node);\n      return value;\n    }\n  }\n\n  set(key, value) {\n    let node = new CacheNode(key, value);\n    if (this.map[key]) {\n      this.remove(key);\n    } else {\n      if (this.size >= this.limit) {\n        delete this.map[this.tail.key];\n        this.size--;\n        this.tail = this.tail.prev;\n        this.tail.next = null;\n      }\n    }\n    this.setHead(node);\n  }\n\n  setHead(node) {\n    node.next = this.head;\n    node.prev = null;\n    if (this.head) {\n      this.head.prev = node;\n    }\n    this.head = node;\n    if (!this.tail) {\n      this.tail = node;\n    }\n    this.size++;\n    this.map[node.key] = node;\n  }\n\n  remove(key) {\n    let node = this.map[key];\n    if (!node) return; // This is sometimes null and crashes the container without this check\n\n    if (node.prev) {\n      node.prev.next = node.next;\n    } else {\n      this.head = node.next;\n    }\n    if (node.next) {\n      node.next.prev = node.prev;\n    } else {\n      this.tail = node.prev;\n    }\n    delete this.map[key];\n    this.size--;\n  }\n}\n","import { VersionStatus } from 'contensis-core-api';\nimport { Client, Query } from 'contensis-delivery-api';\nimport {\n  INodeOperations,\n  NodeGetRootOptions,\n} from 'contensis-delivery-api/lib/models';\n\nimport { DeliveryApi, getClientConfig } from './ContensisDeliveryApi';\nimport { LruCache } from './LruCache';\nimport { CookieObject } from '~/user/util/CookieConstants';\n\n// CachedSearch does not cache results in SSR by design\nclass CachedSearch {\n  cache = new LruCache();\n  cookies?: CookieObject;\n\n  constructor(cookies?: CookieObject) {\n    this.cookies = cookies;\n  }\n\n  getClient(...args: Parameters<DeliveryApi['getClient']>) {\n    return new DeliveryApi(this.cookies).getClient(...args);\n  }\n\n  search(query: Query, linkDepth = 0, project?: string) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(\n      `${project}+${JSON.stringify(query)}+${linkDepth}`,\n      () => client.entries.search(query, linkDepth)\n    );\n  }\n\n  searchUsingPost(query: Query, linkDepth = 0, project = '') {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(\n      `${project}+${JSON.stringify(query)}+${linkDepth}`,\n      () => (client.entries as any).searchUsingPost(query, linkDepth)\n    );\n  }\n\n  get(\n    id: string,\n    linkDepth = 0,\n    versionStatus: VersionStatus = 'published',\n    project?: string\n  ) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    client.clientConfig.versionStatus = versionStatus;\n    return this.request(id, () => client.entries.get({ id, linkDepth }));\n  }\n\n  getContentType(id: string, project?: string) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(`[CONTENT TYPE] ${id} ${project}`, () =>\n      client.contentTypes.get(id)\n    );\n  }\n\n  getRootNode(options: NodeGetRootOptions, project?: string) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(`${project} / ${JSON.stringify(options)}`, () =>\n      client.nodes.getRoot(options)\n    );\n  }\n\n  getNode(options: Parameters<INodeOperations['get']>[0], project?: string) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(\n      `${project} ${\n        options && typeof options !== 'string'\n          ? 'path' in options\n            ? options.path\n            : options.id\n          : options\n      } ${JSON.stringify(options)}`,\n      () => client.nodes.get(options)\n    );\n  }\n\n  getAncestors(\n    options: Parameters<INodeOperations['getAncestors']>[0],\n    project?: string\n  ) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(\n      `${project} [A] ${\n        (options && typeof options !== 'string' && options.id) || options\n      } ${JSON.stringify(options)}`,\n      () => client.nodes.getAncestors(options)\n    );\n  }\n\n  getChildren(\n    options: Parameters<INodeOperations['getChildren']>[0],\n    project?: string\n  ) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(\n      `${project} [C] ${\n        (options && typeof options !== 'string' && options.id) || options\n      } ${JSON.stringify(options)}`,\n      () => client.nodes.getChildren(options)\n    );\n  }\n\n  getSiblings(\n    options: Parameters<INodeOperations['getSiblings']>[0],\n    project?: string\n  ) {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return this.request(\n      `${project} [S] ${\n        (options && typeof options !== 'string' && options.id) || options\n      } ${JSON.stringify(options)}`,\n      () => client.nodes.getSiblings(options)\n    );\n  }\n\n  request<T extends () => Promise<any>>(key: string, execute: T) {\n    // do not cache results in SSR\n    if (!this.cache.get(key) || typeof window == 'undefined') {\n      const promise = execute();\n      this.cache.set(key, promise);\n      promise.catch(() => {\n        this.cache.remove(key);\n      });\n    }\n    return this.cache.get(key) as ReturnType<T>;\n  }\n}\n\nexport const cachedSearch = new CachedSearch();\nexport const cachedSearchWithCookies = (cookies?: CookieObject) =>\n  new CachedSearch(cookies);\n","import { VersionStatus } from 'contensis-core-api';\nimport { Client, Query } from 'contensis-delivery-api';\nimport { Config } from 'contensis-delivery-api/lib/models';\nimport { parse } from 'query-string';\nimport { setSurrogateKeys } from '~/routing/redux/actions';\nimport { reduxStore } from '~/redux/store/store';\nimport {\n  selectCurrentHostname,\n  selectCurrentPath,\n  selectCurrentSearch,\n} from '~/routing/redux/selectors';\nimport { CookieObject, findLoginCookies } from '~/user/util/CookieConstants';\nimport { Request } from 'express';\nimport { IncomingHttpHeaders } from 'http';\n\nconst mapCookieHeader = (cookies: CookieObject | string) =>\n  typeof cookies === 'object'\n    ? Object.entries(cookies)\n        .map(([name, value]) => `${name}=${value}`)\n        .join('; ')\n    : cookies;\n\nconst getSsrReferer = () => {\n  if (typeof window === 'undefined') {\n    const state = reduxStore.getState();\n    const referer = `${selectCurrentHostname(state)}${selectCurrentPath(\n      state\n    )}${selectCurrentSearch(state)}`;\n\n    return referer;\n  }\n  return '';\n};\n\nconst storeSurrogateKeys = (response: any) => {\n  let keys = '';\n  if (response.status === 200) {\n    keys = response.headers.get\n      ? response.headers.get('surrogate-key')\n      : response.headers.map['surrogate-key'];\n    if (!keys) console.info(`[storeSurrogateKeys] No keys in ${response.url}`);\n  }\n  reduxStore?.dispatch(setSurrogateKeys(keys, response.url, response.status));\n};\n\nexport const getClientConfig = (project?: string, cookies?: CookieObject) => {\n  const config: Config = DELIVERY_API_CONFIG; /* global DELIVERY_API_CONFIG */\n  config.responseHandler = {}; // TODO: this needs moving to be scoped at server level\n\n  if (project) {\n    config.projectId = project;\n  }\n\n  // we only want the surrogate key header in a server context\n  // TODO: this needs moving to be scoped at server level\n  if (typeof window === 'undefined') {\n    config.defaultHeaders = Object.assign(config.defaultHeaders || {}, {\n      referer: getSsrReferer(),\n      'x-require-surrogate-key': true,\n      'x-crb-ssr': true, // add this for support tracing\n    });\n    // config.responseHandler[200] = storeSurrogateKeys;\n    config.responseHandler['*'] = storeSurrogateKeys;\n  }\n\n  if (\n    typeof window !== 'undefined' &&\n    PROXY_DELIVERY_API /* global PROXY_DELIVERY_API */\n  ) {\n    // ensure a relative url is used to bypass the need for CORS (separate OPTIONS calls)\n    config.rootUrl = '';\n    config.responseHandler[404] = () => null;\n  }\n\n  if (cookies) {\n    const cookieHeader = mapCookieHeader(findLoginCookies(cookies));\n    if (cookieHeader) {\n      config.defaultHeaders = Object.assign(config.defaultHeaders || {}, {\n        Cookie: cookieHeader,\n      });\n    }\n  }\n\n  return config;\n};\n\n// export * from 'contensis-delivery-api';\n\ndeclare let window: Window &\n  typeof globalThis & {\n    versionStatus?: VersionStatus;\n  };\n\nexport class DeliveryApi {\n  cookies?: CookieObject;\n\n  constructor(cookies?: CookieObject) {\n    this.cookies = cookies;\n  }\n\n  getClientSideVersionStatus = () => {\n    if (typeof window !== 'undefined') {\n      // Allow overriding versionStatus with the querystring\n      const { versionStatus } = parse(window.location.search);\n      if (versionStatus) return versionStatus;\n      // Client-side we will have a global variable set if rendered by SSR in production\n      if (typeof window.versionStatus !== 'undefined')\n        return window.versionStatus;\n      // For localhost development we can only work out versionStatus from the current hostname\n      const currentHostname = window.location.hostname;\n      return this.getVersionStatusFromHostname(currentHostname);\n    }\n    return null;\n  };\n\n  getServerSideVersionStatus = (request: Request) =>\n    request.query.versionStatus ||\n    deliveryApi.getVersionStatusFromHeaders(request.headers) ||\n    deliveryApi.getVersionStatusFromHostname(request.hostname);\n\n  getVersionStatusFromHeaders = (headers: IncomingHttpHeaders) => {\n    const versionStatusHeader = headers['x-entry-versionstatus'];\n    if (typeof versionStatusHeader !== 'undefined') return versionStatusHeader;\n    return null;\n  };\n\n  getVersionStatusFromHostname = (currentHostname: string) => {\n    if (currentHostname.indexOf('localhost') > -1) return 'latest';\n\n    if (currentHostname.endsWith('contensis.cloud')) {\n      if (currentHostname.indexOf('preview.') > -1) {\n        return 'latest';\n      } else {\n        return 'published';\n      }\n    }\n\n    if (currentHostname.endsWith('cloud.contensis.com')) {\n      if (currentHostname.indexOf('preview-') > -1) {\n        return 'latest';\n      } else {\n        return 'published';\n      }\n    }\n\n    return 'published';\n  };\n\n  search = (query: Query, linkDepth = 0, project?: string) => {\n    const client = Client.create(getClientConfig(project, this.cookies));\n    return client.entries.search(\n      query,\n      typeof linkDepth !== 'undefined' ? linkDepth : 1\n    );\n  };\n\n  getClient = (versionStatus: VersionStatus = 'published', project) => {\n    const baseConfig = getClientConfig(project, this.cookies);\n    baseConfig.versionStatus = versionStatus;\n    return Client.create(baseConfig);\n  };\n\n  getEntry = (\n    id: string,\n    linkDepth = 0,\n    versionStatus: VersionStatus = 'published',\n    project?: string\n  ) => {\n    const baseConfig = getClientConfig(project, this.cookies);\n    baseConfig.versionStatus = versionStatus;\n    const client = Client.create(baseConfig);\n    // return client.entries.get(id, linkDepth);\n    return client.entries.get({ id, linkDepth });\n  };\n}\n\nexport const deliveryApi = new DeliveryApi();\n\nexport const deliveryApiWithCookies = (cookies?: CookieObject) =>\n  new DeliveryApi(cookies);\n\nexport * from './CachedDeliveryApi';\n"],"names":["CacheNode","constructor","key","value","next","prev","LruCache","limit","map","head","tail","size","get","node","remove","setHead","set","CachedSearch","cookies","cache","getClient","args","DeliveryApi","search","query","linkDepth","project","client","Client","create","getClientConfig","request","JSON","stringify","entries","searchUsingPost","id","versionStatus","clientConfig","getContentType","contentTypes","getRootNode","options","nodes","getRoot","getNode","path","getAncestors","getChildren","getSiblings","execute","window","promise","catch","cachedSearch","cachedSearchWithCookies","mapCookieHeader","Object","name","join","getSsrReferer","state","reduxStore","getState","referer","selectCurrentHostname","selectCurrentPath","selectCurrentSearch","storeSurrogateKeys","response","keys","status","headers","console","info","url","dispatch","setSurrogateKeys","config","DELIVERY_API_CONFIG","responseHandler","projectId","defaultHeaders","assign","PROXY_DELIVERY_API","rootUrl","cookieHeader","findLoginCookies","Cookie","getClientSideVersionStatus","parse","location","currentHostname","hostname","getVersionStatusFromHostname","getServerSideVersionStatus","deliveryApi","getVersionStatusFromHeaders","versionStatusHeader","indexOf","endsWith","baseConfig","getEntry","deliveryApiWithCookies"],"mappings":"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"}